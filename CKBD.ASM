;	CKB?.ASM 2.13L ̹ģ
;	1998.8.16
DATE	EQU	"1999.11.17"

SEG_A		SEGMENT
		ASSUME	CS:SEG_A, DS:SEG_A

D_PATH	EQU	82H    ;32 DUP (0)		;2.13װ̼·

; 100H BYTE ʾʽ
; 101H BYTE ʵʾʽ
; 102H BYTE =1ֱд

		ORG	100H
START:		JMP	BEGIN
		DW	0CDEFH			;CKBD־	[103H]

K_DISP		DB	2,1,5,39H		;ʾ	[105H]
		DB	0
D_TUX1		DB	1EH			;ʾַɫ1	[10AH]
D_TUX2		DB	1AH			;ʾַɫ2
D_QTS1		DB	4EH			;ʾϢɫ1
D_QTS2		DB	4AH			;ʾϢɫ2
		DB	0
K_SHIFT 	DB	2			;ܼSHIFT
K_CF7		DB	64H			;/ʾ [110H]
K_AF1		DB	68H			;λ
K_AF2		DB	69H			;β
K_AF3		DB	6AH			;ƴ
K_AF4		DB	6BH			;˫ƴ
K_CF9		DB	66H			;/ȡ
K_AF6		DB	6DH			;ASCII
K_AF5		DB	6CH			;
K_AF10		DB	71H			;籨
K_F12		DB	86H			;Ԥѡ
K_F11		DB	85H			;
K_CF5		DB	62H			;ϵͳ
K_AF9		DB	70H			;˫ƴ
K_CF10		DB	67H			;ôӡ
		DB	0,0
K_FCC		DB	'Y'                     ;³Ǽ     [120H]
K_SPKZ		DB	'1'                     ;˫ƴչС
K_PY		DB	'Y'                     ;װƴ
K_SW		DB	'N'                     ;װβ
K_DB		DB	'N'                     ;װ籨

D_INT16 	DD	0			;INT16	  [0119H]
D_INT9		DD	0			;INT9
D_INKEY 	DB	0			;ִINT9־
D_KBDBUF	DW	0			;̻ɴַ
K_DEL		DB	0			;ܼ(=0FFH)

D_PY		DW	0, 0			;ƴסβַ
D_SW		DW	0, 0			;βסβַ
D_2BD6		DW	0			;
D_2BD8		DW	0			;β

D_2BAD		DW	0			;ָ
D_2BAF		DW	0			;ָ
D_9646		DW	0			;ָ

D_2BB0		DB	0			;
D_2BB1		DB	10 DUP(0)		;(10ֽ)
D_2CC1		DB	10 DUP(0)		;(10ֽ)
D_2CC0		DB	0			;ƴ־0FFH
D_2BCF		DB	11			;ĩҳ
D_2BC0		DW	0			;дָ
	;--------------------------------------------------------------------+
D_2BBA		DW	0			;(ɴ11)	     |
D_2BBC		DW	9 DUP (0)		;			     |
D_2BCE		DW	0			;ĩ		     |
	;--------------------------------------------------------------------+
D_2BD0		DB	11			;
D_2BD2		DB	0			;
D_9597		DW	0			;

D_959B		DB	0FFH			;̬
D_95D5		DB	0			;ָ
D_95D6		DB	0			;..
D_2BD4		DB	0			;˫ƴƫ
D_2BAA		DW	0			;ָ
D_2BAC		DB	0			;ı־

D_2BB9		DB	0			;״̬־
	;=1һƵ,  =2Ƶ		=8˫ƴ
	;=10H,=20Hʣ,=40HԤѡ־ =80Hֱִ־
D_963A		DB	0			;뷽ʽ
	;=1λ,      =2β,	   =4ƴ,    =8˫ƴ
	;	      =20H,	      =80H籨
D_963B		DB	0			;ֵ䷽ʽ

D_2B98		DW	0			;
D_2B9A		DW	0			;ʱָ
D_2B9C		DW	0			;ʱָ
D_2B9E		DW	0			;ʱָ
D_2BA0		DW	0			;ʱָ
D_2BA2		DW	0			;ʱָ
D_2BA5		DB	0			;ʱ(0=,FF=)
D_9669		DW	0			;ѡдڴʱַ
D_966B		DB	0			;ѡд볤
	;--------------------------------------------------------------------+
D_9648		DW	0			;(ɴ11)	     |
D_964A		DB	0
D_964B		DB	0			;0ʾ˫ƴִʵڶλ

F_SPCZ		DB	'SPCZ.DAT',0    ;9      ;17
F_YX		DB	'YX0.DAT',0     ;8
F_INI		DB	'213L.INI',0    ;9      ;23
F_SWMB		DB	'SWMB',0        ;5
F_PYMB		DB	'PYMB',0        ;5
F_DBMB		DB	'DBMB',0        ;5
	;--------------------------------------------------------------------+
D_9650		DB	0			;ʴʻ
D_9668		DB	56			;ʾд
D_966C		DB	0			;ⲿ=0,=1
D_9639		DB	0			;뿪
D_966D		DB	0			;־(FFH)
D_966F		DB	0			;˫ƴ鴦־

D_AH		DB	0			;ǰAHֵ

D_AH20		DW	OFFSET L_AH20		;<װԤѡ>
		DW	OFFSET L_AH21		;<ģ⹦ܼ>
		DW	OFFSET L_AH22		;<ȡ˫ƴ>
		DW	OFFSET L_INT16		;<ӳ>
		DW	OFFSET L_INT16		;<˳ֹܿ>
		DW	OFFSET L_AH25		;<ʾ汾Ϣ>
		DW	OFFSET L_INT16		;<ʱ>
		DW	OFFSET L_AH27		;<ȡú뷽ʽ>
		DW	OFFSET L_INT16		;<֧ΰ¼>
		DW	OFFSET L_AH29		;<ʾ>
		DW	OFFSET L_AH2A		;<ģַ>
		DW	OFFSET L_AH2B		;<ROM BIOS>
		DW	OFFSET L_INT16		;AH=2CH
		DW	OFFSET L_INT16		;AH=2DH
		DW	OFFSET L_INT16		;AH=2EH
		DW	OFFSET L_AH2F		;<ȡģж>

D_213L		DB	'2.13L ϵͳ    199911    Ȩ   Ȩ:',0

D_9680		DW	0, 0, 0 		;ⲿ	 [DI]
D_9686		DW	0, 0, 0 		;	 [DI+6]
D_INTWB 	DW	0, 0, 0 		;ģƫ, [DI+12]
D_SPCZ		DW	0, 0, 0 		;˫ƴ,ַ [DI+18]

D_YX		DW	0			;Ԥѡֱǰַ
D_YXH		DB	1			;ǰк
D_DB		DW	0			;籨ַ

;---̹ж---------------------------------
INT_16		PROC	FAR
		CLD
		STI
		PUSH	DS
		PUSH	ES
		PUSH	BX
		PUSH	CX
		PUSH	DX
		PUSH	DI
		PUSH	SI
		PUSH	BP
		PUSH	CS
		POP	DS
		MOV	D_AH,AH

		CMP	AH,4			;<չ״̬>
		JNZ	L_02
		XOR	DX,DX
		MOV	DS,DX
		MOV	DS:[417H],AL
		JMP	L_RET
L_02:
		CMP	AH,1			;<ȡ״̬>
		JNZ	L_04
L_03:
		JMP	L_AH01
L_04:
		CMP	AH,11H
		JZ	L_03

		CMP	AH,20H
		JB	L_INT16
		CMP	AH,2FH
		JA	L_INT16
		PUSH	AX
		MOV	AL,AH
		SUB	AL,20H
		CBW
		MOV	DI,AX
		POP	AX
		SHL	DI,1
		JMP	D_AH20[DI]		;ִй20H-2FH
L_INT16:
		POP	BP			;زִԭINT16
		POP	SI
		POP	DI
		POP	DX
		POP	CX
		POP	BX
		POP	ES
		POP	DS
		JMP	CS:D_INT16

;AH=1 *** ȡ״̬ ***
L_AH01:
		CLI
		CALL	S_INT16_1		;мַ̻
		JNZ	L_0010
		CMP	D_95D5,0		;зַ?
		JZ	L_0010
		MOV	AX,40H
		MOV	ES,AX
		MOV	SI,D_2BAA		;ָ
		CALL	S_XBUF1 		;д̻
		CALL	S_INT16_1		;
L_0010:
		STI
		POP	BP
		POP	SI
		POP	DI
		POP	DX
		POP	CX
		POP	BX
		POP	ES
		POP	DS
		RET	2			;־Ĵ

;AH=25H *** ʾ汾Ϣ BL=ʾ
L_AH25:
		CALL	S_XSBB
		JMP	SHORT L_RET

;AH=29H *** ʾ
L_AH29:
		CALL	S_CXTUX
		JMP	SHORT L_RET

;AH=2FH *** ȡģжBP:SIʲַBP:DI2.13װ·BP:DX
L_AH2F:
		MOV	SI,OFFSET INT_16	;ģж
		MOV	DI,OFFSET D_9680	;ʲַ
		MOV	DX,D_PATH		;2.13װ·
		MOV	BP,CS
		MOV	AX,44H			;CKBD
		POP	CX
		POP	CX
		POP	CX
		POP	CX
		JMP	SHORT L_RET2

;AH=22H *** ȡ˫ƴ DX=,AL=˫ƴһ,AH=˫ƴڶ
L_AH22:
		MOV	AX,DX
		XCHG	AH,AL
		CALL	S_A9A0
		JMP	SHORT L_RET

;AH=21H *** ģ⹦ܼ AL=չASC
L_AH21:
		MOV	AH,AL
		XOR	AL,AL
		PUSH	AX
		CALL	S_JRCL
		POP	AX
		MOV	D_95D5,0
		JMP	SHORT L_RET

;AH=20H *** װ AL=0ⲿ,=1,=2,3˫ƴ
;		    ȡַ:  AL=4ⲿ,=5,=6,=7˫ƴ
L_AH20:
		MOV	BL,AL			;
		AND	AL,3			;ת0-3
		MOV	AH,6			;ÿ6ֽ
		MUL	AH
		ADD	AX,OFFSET D_9680	;
		MOV	DI,AX			;

		CMP	BL,3			;װ?
		JBE	L_2000
		MOV	BP,[DI] 		;ȡ
		MOV	DX,[DI+2]		;ȡ
		POP	SI
		POP	SI
		POP	DI
		POP	CX
		JMP	SHORT L_RET2
L_2000:
		MOV	[DI],BP 		;
		MOV	[DI+2],DX		;
		MOV	[DI+4],CX		;
L_RET:
		POP	BP			;
		POP	SI
L_RET1:
		POP	DI
		POP	DX
L_RET2:
		POP	CX
		POP	BX
		POP	ES
		POP	DS
		IRET

;AH=2BH *** ROM BIOS AL=AHֵ
L_AH2B:
		MOV	AH,AL
		CALL	L_INT16_1		;ROM BIOS INT16
		JMP	SHORT L_RET

;AH=2AH *** ģַBP:SI AL=0:д,=1ȡ
L_AH2A:
		OR	AL,AL
		JNZ	L_2A01
		MOV	D_HELP,SI		;д
		MOV	D_HELP+2,BP
		JMP	SHORT L_RET
L_2A01:
		MOV	SI,D_HELP		;ȡ
		MOV	BP,D_HELP+2
		POP	DI
		POP	DI
		JMP	SHORT L_RET1

;AH=27H *** ȡú뷽ʽ AL=0ȡ,=1:DL=뷽ʽ
L_AH27:
		OR	AL,AL
		JZ	L_2701
		MOV	D_963A,DL		;
		JMP	SHORT L_RET
L_2701:
		MOV	DL,D_963A		;ȡ
		POP	CX
		POP	CX
		POP	CX
		POP	CX
		JMP	SHORT L_RET2

INT_16		ENDP

D_KX		DB	'ͻ'                   ;
		DB	' '
		DB	'ͼ'
D_MSG		DB	'2.13L   ϵ ͳ',0
D_MSG1		DB	'    :      199911 '

;ӳ:ʾ汾Ϣ BL=ʾ
S_XSBB		PROC	NEAR
		XOR	BH,BH
		MOV	DX,15
		MOV	SI,OFFSET D_KX		;
		CALL	S_XSYH			;ʾϱ
		INC	DH
L_2501:
		PUSH	SI
		CALL	S_XSYH			;ʾ
		POP	SI
		INC	DH
		CMP	DH,6
		JNZ	L_2501

		ADD	SI,3
		CALL	S_XSYH			;ʾ

		PUSH	CS
		POP	ES
		MOV	SI,OFFSET D_MSG
		MOV	DX,217H
		MOV	AX,140FH		;ӿʾ
		INT	10H
		XOR	BH,BH
		MOV	DX,417H
		MOV	BP,OFFSET D_MSG1	;ȨϢ
		MOV	CX,34
		MOV	AX,1300H		;ʾһ
		INT	10H

		MOV	DX,700H
		MOV	AH,2
		INT	10H
		RET
;ӳ:ʾһ
S_XSYH:
		PUSH	DX
		LODSB
		CALL	S_DWXS			;ʾ
		MOV	CL,48
		LODSB
		CALL	S_DWXS0 		;ʾм
		LODSB
		CALL	S_DWXS			;ʾҶ
		POP	DX
		RET
S_DWXS:
		MOV	CX,1
S_DWXS0:
		PUSH	AX
		MOV	AH,2
		INT	10H
		POP	AX
		MOV	AH,9
		INT	10H
		ADD	DX,CX
		RET
S_XSBB		ENDP

;---Ӳж-----------------------------------
INT_9		PROC	FAR
		CLD
		PUSHF
		CALL	CS:D_INT9		;ִԭINT9

		PUSH	DS
		PUSH	ES
		PUSH	AX
		PUSH	BX
		PUSH	CX
		PUSH	DX
		PUSH	SI
		PUSH	DI
		PUSH	BP
		PUSH	CS
		POP	DS
		MOV	AX,40H
		MOV	ES,AX

		MOV	AX,ES:[17H]
		MOV	BL,K_SHIFT		;=1,=2,=10H-SCROLL LOCK
		CMP	BL,10H
		JZ	L_9001
		TEST	AL,BL			;SHIFT?
		JZ	L_9010
		JMP	SHORT L_9002
L_9001:
		TEST	AH,BL
		JZ	L_9010
L_9002:
		XOR	K_DEL,0FFH		;ת
		JZ	L_9003
		CALL	L_1404			;ʾ
		JMP	SHORT L_9030
L_9003:
		CALL	S_CXTUX 		;ʾ
		JMP	SHORT L_9030
L_9010:
		AND	AL,0FH
		CMP	AL,0FH			;CTRL+ALT+˫SHIFT?
		JNZ	L_9020
		MOV	AX,4CFFH		;DOS
		INT	21H
L_9020:
		CMP	D_INKEY,0		;?
		JNZ	L_9030

		MOV	BX,ES:[1AH]		;ַ̻
		CMP	BX,ES:[1CH]		;=̻β?
		JNZ	L_9040
L_9030:
		MOV	AL,20H
		OUT	20H,AL
		POP	BP
		POP	DI
		POP	SI
		POP	DX
		POP	CX
		POP	BX
		POP	AX
		POP	ES
		POP	DS
		IRET
L_9040:
		MOV	D_INKEY,1		;ñ־
		MOV	AX,ES:[BX]		;ȡַ
		CMP	AL,80H			;ַASCII>80H?
		JB	L_9042
		OR	AH,AH			;дĺ?
		JZ	L_9042
		MOV	D_AH,0
		CALL	S_101K			;101չ
L_9042:
		STI
		CALL	S_JRCL			;ַ
		CLI

		MOV	BX,40H
		MOV	ES,BX
		CMP	D_95D5,0		;޷ؼ?
		JNZ	L_9048
		MOV	DI,ES:[1CH]		;̻βַ
		MOV	ES:[1AH],DI		;=ַ̻
L_9044:
		MOV	D_95D5,0
L_9046:
		MOV	D_INKEY,0		;־
		JMP	SHORT L_9030
L_9048:
		CMP	D_95D5,1		;1?
		JZ	L_9044
		CALL	S_XBUF			;д̻
		JMP	SHORT L_9046
INT_9		ENDP

;ӳ:д̻ ES=40H
S_XBUF		PROC	NEAR
		MOV	SI,OFFSET D_959D	;
S_XBUF1:
		MOV	DI,ES:[1CH]		;̻βַ 	8.7
		MOV	ES:[1AH],DI		;=ַ̻
		MOV	CL,D_95D5		;
		XOR	CH,CH
		XOR	BX,BX
		CMP	CX,D_KBDBUF		;ȼ̻?
		JB	L_XB1
		MOV	CX,D_KBDBUF
		DEC	CX
		INC	BX
L_XB1:
		SUB	D_95D5,CL
L_XB2:
		LODSB
		MOV	AH,0
		STOSW
		CMP	DI,ES:[82H]		;=̻β?
		JNZ	L_XB3
		MOV	DI,ES:[80H]		;ָ
L_XB3:
		LOOP	L_XB2
		MOV	ES:[1CH],DI		;̻β

		OR	BX,BX
		JZ	L_XB4
		MOV	D_2BAA,SI
L_XB4:
		RET
S_XBUF		ENDP

;ӳ:101չ<AH , >AH
S_101K		PROC	NEAR
		CMP	K_FCC,'Y'               ;з³Ǽ?
		JNZ	L_101K3
		XOR	SI,SI
L_101K1:
		CMP	AH,D_KZJB[SI]		;м?
		JZ	L_101K2
		INC	SI
		CMP	SI,6			;?
		JB	L_101K1
		JMP	SHORT L_101K3
L_101K2:
		MOV	AH,K_AF1[SI]		;AX
		XOR	AL,AL
L_101K3:
		CMP	D_AH,10H
		JZ	L_101K4
		XOR	AL,AL
L_101K4:
		RET
S_101K		ENDP

D_KZJB		DB	52H, 47H, 49H, 53H, 4FH, 51H
	;		Ins  Home PgUp Del  End  PgDn	רù

D_GNJB		DW	OFFSET L_QW		;λ(ALT+F1)
		DW	OFFSET L_SW		;β(ALT+F2)
		DW	OFFSET L_PY		;ƴ(ALT+F3)
		DW	OFFSET L_SP		;˫ƴ(ALT+F4)
		DW	OFFSET L_CF9		;/ȡ(CTRL+F9)
		DW	OFFSET L_ASC		;ASCII(ALT+F6)
		DW	OFFSET L_WBZX		;(ALT+F5)
		DW	OFFSET L_DB		;籨(ALT+F10)
		DW	OFFSET L_YX		;Ԥѡֱ(F12)
		DW	OFFSET L_HELP		;(F11)
		DW	OFFSET L_XTK1		;ϵͳ(CTRL+F5)
		DW	OFFSET L_AF9		;˫ƴ(ALT+F9)
		DW	OFFSET L_CF10		;ôӡ(CTRL+F10)

;ӳ:ַ-----------------------------
S_JRCL		PROC	NEAR
		CMP	K_DEL,0 		;ܼЧ?
		JZ	L_J20
		JMP	L_9BB9			;Ч
L_J20:
		CMP	AH,K_CF7		;ʾл:CTRL+F7
		JNZ	L_J30
		JMP	SHORT L_J40
L_J30:
		JMP	L_J100
L_J40:
		MOV	AX,DS:[101H]		;AL:ǰʾʽ,AH=1:ֱд
		CMP	AL,4			;?
		JB	L_J50
		CMP	AL,7
		JZ	L_J50
		MOV	AX,1805H		;ʾʽת
		INT	10H
		MOV	AX,180AH		;رֱд
		INT	10H
		MOV	AX,3			;ʾʽ
		INT	10H
		JMP	SHORT L_J80
L_J50:
		OR	AH,AH			;=0:ֱд
		JNZ	L_J60
		MOV	AL,DS:[100H]		;ʾʽ
		JMP	SHORT L_J70
L_J60:
		MOV	AX,180BH		;ֱд
		INT	10H
		MOV	AX,3
L_J70:
		INT	10H
L_J80:
		MOV	AX,1C0DH		;س
		MOV	BX,40H
		MOV	ES,BX
		MOV	BX,ES:[1AH]
		MOV	ES:[BX],AX		;ػس
L_J90:
		JMP	L_9BB9			;һ
L_J100:
		MOV	DX,CS:[100H]		;DL=ַʽ,DH=ǰʽ
		CMP	DH,DL			;Ƿʾʽ?
		JNZ	L_J90
		OR	AL,AL			;йܼ
		JNZ	L_J130

		CMP	AH,0A1H 		;ALT+PGDN*,ʾ2.13L
		JNZ	L_J110
		MOV	BL,D_0A1H		;ɫ
		CALL	S_XSBB			;ʾ
		INC	D_0A1H			;ɫ+1
		JMP	L_9BB9
D_0A1H		DB	1EH

;ҹܼ
L_J110:
		MOV	SI,OFFSET K_AF1 	;ܼ
L_J120:
		CMP	AH,[SI] 		;йܼ?
		JZ	L_J140
		INC	SI
		CMP	BYTE PTR [SI],0 	;β?
		JNZ	L_J120
L_J130:
		JMP	L_9C86			;ַ.ԭΪ9C90	12.10
L_J140:
		SUB	SI,OFFSET K_AF1
		SHL	SI,1
		JMP	D_GNJB[SI]		;תģ

D_DX0		DW	0			;ʼλ
D_AF9		DB	0
;˫ƴ顿
L_AF9:
		MOV	D_AF9,AH
		JMP	CF1_0
AF9_A:
		MOV	SI,OFFSET D_BUF
		MOV	DI,30H			;ݴ
		PUSH	CS
		POP	ES
		XOR	CX,CX
AF9_B:
		LODSW				;ȡһλ
		MOV	DX,AX
		MOV	AH,2			;궨λ
		INT	10H
		MOV	AH,8			;ȡ괦ַ
		INT	10H
		STOSB				;дݴ
		INC	CX
		CMP	SI,A_BUF		;λβ?
		JNZ	AF9_B

		TEST	WORD PTR [DI-2],8080H	;ĩ?
		JNZ	AF9_C
AF9_ERR:
		MOV	AX,0E07H
		INT	10H
		RET
AF9_C:
		MOV	SI,30H			;ݴ
		MOV	DX,CX
		CMP	CL,6			;?		10.16
		JBE	AF9_D
		MOV	CL,6			;ȡǰ
AF9_D:
		LODSB				;ȡǰ
		CMP	AL,0A0H 		;к?
		JBE	AF9_ERR
		LOOP	AF9_D
		MOV	CX,DX

		MOV	ES,D_SPCZ		;˫ƴ
		MOV	AX,ES:[6]		;ԭչβ
		MOV	DI,AX
		MOV	SI,30H
		ADD	AX,CX			;+
		INC	AX			;+
		CMP	AX,ES:[8]		;˫ƴβ?
		JA	AF9_ERR
		MOV	ES:[6],AX
		REP	MOVSB			;д´
		MOV	AL,','
		STOSB
		XOR	AX,AX
		STOSW				;־
		RET
CF1_0:
		XOR	BH,BH
		MOV	AH,3			;ȡλ
		INT	10H
		MOV	D_DX0,DX
		MOV	A_BUF,OFFSET D_BUF
CF1_1:
		MOV	AX,1408H		;DXַɫ
		INT	10H
		MOV	SI,A_BUF
		MOV	[SI],DX 		;
		ADD	SI,2
		INC	DX
		CMP	SI,OFFSET D_BUF+510
		JZ	CF1_2
		MOV	A_BUF,SI
CF1_2:
		MOV	AH,2			;궨λ
		INT	10H
		CALL	S_INT16 		;
		CMP	AH,48H			;
		JNZ	CF1_3
		OR	DH,DH
		JZ	CF1_2
		DEC	DH
		JMP	SHORT CF1_2
CF1_3:
		CMP	AH,50H			;
		JNZ	CF1_3A
		CMP	DH,24
		JAE	CF1_2
		INC	DH
		JMP	SHORT CF1_2
CF1_3A:
		CMP	AH,4BH			;
		JNZ	CF1_3B
		OR	DL,DL
		JZ	CF1_2
		DEC	DL
		JMP	SHORT CF1_2
CF1_3B:
		CMP	AH,4DH			;
		JNZ	CF1_3C
		CMP	DL,79
		JAE	CF1_2
		INC	DL
		JMP	SHORT CF1_2
CF1_3C:
		CMP	AH,D_AF9		;ALT_F9
		JZ	CF1_1
CF1_5:
		CMP	AL,1BH			;ESC
		JNZ	CF1_6
S_CF1_5:					;ָ
		MOV	SI,OFFSET D_BUF
CF1_5A:
		CMP	SI,A_BUF
		JZ	CF1_5B
		LODSW
		MOV	DX,AX
		MOV	AX,1408H
		INT	10H
		JMP	SHORT CF1_5A
CF1_5B:
		MOV	DX,D_DX0
		MOV	AH,2			;ָԭ
		INT	10H
		RET
CF1_6:
		CMP	AL,8			;˸?
		JNZ	CF1_7
		MOV	SI,A_BUF
		CMP	SI,OFFSET D_BUF 	;?
		JZ	CF1_6A
		MOV	DX,[SI-2]
		MOV	AX,1408H
		INT	10H
		SUB	A_BUF,2
CF1_6A:
		JMP	CF1_2
CF1_7:
		CMP	AL,0DH			;س?
		JNZ	CF1_6A
		CALL	S_CF1_5 		;ָ
		CMP	D_AF9,0
		JZ	CF1_8
		JMP	AF9_A
CF1_8:
		MOV	SI,OFFSET D_BUF 	;
CF1_A:
		CMP	SI,A_BUF		;н?
		JZ	CF1_B
		LODSW				;ȡ
		MOV	DX,AX
		MOV	AH,2			;궨λ
		INT	10H
		MOV	AH,8			;ȡ괦ַ
		INT	10H
		XOR	AH,AH
		MOV	[SI-2],AX		;д
		JMP	SHORT CF1_A
CF1_B:
		RET

D_DYCS		DB	'ӡ',0
D_DYCS1 	DB	' 1- 2-о 3- 4- '
		DB	'5-˫ 6-ش 7- 8-Ĵӡ 9-',0
D_C101		DB	'(A-x):',0
D_C102		DB	'о(1-255):',0
D_C103		DB	'߿(0-2000):',0
D_INPUT 	DB	'`',7 DUP(0)
;ôӡ
L_CF10:
		MOV	AH,6			;ȡӡ
		INT	17H
		CMP	AH,6			;ģ?
		JNZ	L_C100
		JMP	L_9DC0
L_C100:
		MOV	SI,OFFSET D_DYCS
		CALL	S_QTXS			;ʾвʾ
		MOV	SI,OFFSET D_DYCS1
		MOV	BL,1EH
		CALL	S_A24A			;ʾ˵
		CALL	S_INT16 		;ѡ
		PUSH	AX
		CALL	S_1400
		POP	AX
		MOV	BL,1EH
		MOV	DI,OFFSET D_INPUT+1	;뻺

		CMP	AL,'1'                  ;
		JNZ	L_C102
		MOV	SI,OFFSET D_C101
		CALL	S_A24A			;ʾʾϢ
		MOV	BYTE PTR [DI],'@'
		CALL	S_INT16 		;
		CMP	AL,'A'
		JB	L_C10ERR
		CMP	AL,'z'
		JA	L_C10ERR
		MOV	AH,'`'
		MOV	[DI+1],AX
		MOV	BYTE PTR [DI+3],0
		MOV	SI,OFFSET D_INPUT
L_C101:
		XOR	AH,AH
		XOR	DX,DX
L_C101A:
		LODSB
		OR	AL,AL
		JZ	L_C101B
		INT	17H
		JMP	SHORT L_C101A
L_C101B:
		JMP	SHORT L_CF10
L_C10ERR:
		MOV	DL,7
		CALL	S_1403			;
		JMP	SHORT L_CF10
L_C102:
		CMP	AL,'2'                  ;о
		JNZ	L_C103
		MOV	SI,OFFSET D_C102
		CALL	S_A24A			;ʾʾϢ
		MOV	BYTE PTR [DI],'&'
		CALL	S_INPUT 		;
		JB	L_C10ERR
		JMP	SHORT L_C101
L_C103:
		CMP	AL,'3'                  ;߿
		JNZ	L_C104
		MOV	SI,OFFSET D_C103
		CALL	S_A24A
		MOV	BYTE PTR [DI],'['
		CALL	S_INPUT 		;
		JB	L_C10ERR
		JMP	SHORT L_C101
L_C104:
		CMP	AL,'4'                  ;ӡ
		JNZ	L_C105
		MOV	AL,'>'
L_C104A:
		MOV	[DI],AL
		MOV	WORD PTR [DI+1],60H
		JMP	SHORT L_C101
L_C105:
		CMP	AL,'5'                  ;˫ӡ
		JNZ	L_C106
		MOV	AL,'<'
		JMP	SHORT L_C104A
L_C106:
		CMP	AL,'6'                  ;ӡ
		JNZ	L_C107
L_C106A:
		SUB	AL,'6'
		MOV	AH,4			;
		INT	17H
		JMP	S_1404
L_C107:
		CMP	AL,'7'                  ;ӡ
		JZ	L_C106A

		CMP	AL,'8'                  ;Ĵӡ
		JNZ	L_C109
L_C108:
		SUB	AL,'8'
		MOV	AH,3			;
		INT	17H
		JMP	S_1404
L_C109:
		CMP	AL,'9'                  ;ִӡ
		JZ	L_C108
		JMP	S_1404

;ӳ:
S_INPUT 	PROC	NEAR
		INC	DI			;뻺
L_IN1:
		CALL	S_INT16 		;
		CMP	AL,0DH			;س?
		JZ	L_IN6
		CMP	AL,8			;˸?
		JNZ	L_IN5
		CMP	DI,OFFSET D_INPUT+2	;ָ?
		JBE	L_IN1
		DEC	DI			;λ-1
L_IN4:
		CALL	S_1403A 		;˸
		JMP	SHORT L_IN1
L_IN5:
		CMP	AL,'0'                  ;?
		JB	L_IN1
		CMP	AL,'9'
		JA	L_IN1
		MOV	[DI],AL 		;д
		INC	DI
		JMP	SHORT L_IN4
L_IN6:
		CMP	DI,OFFSET D_INPUT+2	;ָ?
		JZ	L_IN9
		MOV	BYTE PTR [DI],0
		MOV	SI,OFFSET D_INPUT
		CLC
		RET
L_IN9:
		STC
		RET
S_INPUT 	ENDP

;Ԥѡֱ
L_YX:
		MOV	AX,D_YX 		;Ԥѡֱַ
		OR	AX,AX
		JZ	L_YX3
		MOV	D_2BB9,40H		;Ԥѡ־
L_YX1:
		CALL	S_1400			;ʾ
		MOV	BL,D_TUX1		;ɫ:׻
		MOV	DL,' '
		CALL	S_1403
		MOV	SI,D_YX 		;Ԥѡֱǰеַ
		MOV	DL,'A'                  ;
L_YX2:
		PUSH	DX
		CALL	S_1403			;ʾ
		LODSB				;ǰֽ
		CALL	S_1403A
		LODSB				;ֽ
		CALL	S_1403A
		POP	DX
		INC	DX			;żһ
		CMP	DL,'Z'
		JBE	L_YX2			;δ
		CALL	S_A24E			;
L_YX3:
		RET

D_HELP		DW	0,0			;ģַ
;
L_HELP:
		CMP	D_HELP+2,0		;ѹҽӰģ?
		JZ	L_HELP1
		CALL	DWORD PTR D_HELP	;ִа
L_HELP1:
		RET

D_CZW		DB	' '                     ;ʾ־
;/ȡġ
L_CF9:
		MOV	AL,7FH
		XOR	D_2BAC,0FFH		;ķʽ
		JNZ	L_CF9_1
		MOV	AL,' '
L_CF9_1:
		MOV	D_CZW,AL		;־

;ӳ:ʾ
S_CXTUX:
		MOV	AL,D_963A
		MOV	SI,OFFSET D_QWXS	;λ
		TEST	AL,1
		JNZ	L_CT1
		MOV	SI,OFFSET D_SWXS	;β
		TEST	AL,2
		JNZ	L_CT1
		MOV	SI,OFFSET D_PYXS	;ƴ
		TEST	AL,4
		JNZ	L_CT1
		MOV	SI,OFFSET D_SPXS	;˫ƴ
		TEST	AL,8
		JNZ	L_CT1
		MOV	SI,OFFSET D_WBZX	;
		TEST	AL,20H
		JNZ	L_CT1
		MOV	SI,OFFSET D_DBXS	;籨
		TEST	AL,80H
		JNZ	L_CT1
		MOV	SI,OFFSET D_YWXS	;Ӣ
L_CT1:
		CALL	S_QTXSC 		;ʾвʾ뷽ʽı־
		MOV	SI,OFFSET D_213L	;ʾаȨ־
		MOV	BL,D_TUX1
		MOV	DL,10
		CALL	S_A249			;ʾַ
		RET

;----------------------------------------------------------------------------
D_XTK1		DB	'תڶҳ  꿪  ִ  л  '
		DB	'˳  ³Ǽ  뿪  ֱд',0
;ϵͳ-һҳ
L_XTK1:
		MOV	SI,OFFSET D_XTK1	;һҳ˵
		MOV	CX,800H
		CALL	S_CDKZ			;ʾв˵
		CMP	AL,1BH			;<ESC>
		JNZ	L_XTK1A
		RET

K_GBKG		DB	0FFH			;꿪
L_XTK1A:
		CMP	AL,2			;<꿪>
		JNZ	L_XTK1B
		NOT	K_GBKG
		MOV	AH,17H
		MOV	AL,K_GBKG
		INT	10H
		RET

D_TXZF		DB	'ַ:',0
L_XTK1B:
		CMP	AL,3			;<ִ>
		JNZ	L_XTK1C
		PUSH	CS
		POP	ES
		MOV	SI,OFFSET D_TXZF
		CALL	S_QTXS			;ʾвʾ
		MOV	DI,030H 		;CS:30HΪַ
		MOV	SI,DI			;
		MOV	AL,14			;
		STOSB
L_XTK1B1:
		CALL	S_INT16 		;ȡַ
		CMP	AL,8			;˸?
		JNZ	L_XTK1B3
		CMP	SI,DI
		JZ	L_XTK1B1
		DEC	DI
L_XTK1B2:
		MOV	BL,D_TUX1		;ɫ:׻
		CALL	S_1403A 		;ʾ˸
		JMP	SHORT L_XTK1B1
L_XTK1B3:
		CMP	AL,1BH			;<ESC>?
		JZ	L_XTK1B6
		CMP	AL,0DH			;س?
		JZ	L_XTK1B4
		STOSB				;
		JMP	SHORT L_XTK1B2
L_XTK1B4:
		MOV	AL,']'                  ;
		STOSB
L_XTK1B5:
		CMP	SI,DI			;?
		JZ	L_XTK1B6
		LODSB				;ȡһַ
		MOV	CX,1
		MOV	AH,9
		INT	10H			;
		JMP	SHORT L_XTK1B5
L_XTK1B6:
		JMP	S_1404			;رʾ

D_JF		DB	18			;򷱱־
L_XTK1C:
		CMP	AL,4			;<л>
K_JFQH	EQU	$
		JNZ	L_XTK1D
		MOV	AL,18
		CMP	AL,D_JF
		JNZ	L_XTK1C1
		DEC	AX
L_XTK1C1:
		MOV	D_JF,AL
		MOV	AH,18H			;AL=17,=18
		INT	10H
		MOV	AX,1813H		;Ļ
		INT	10H
		RET

D_QR		DB	'ٴȷ(Y/N)',7,0
L_XTK1D:
		CMP	AL,5			;<˳>
K_TCHZ	EQU	$
		JNZ	L_XTK1E
		MOV	SI,OFFSET D_QR
		CALL	S_QTXS			;ʾʾϢ
		CALL	S_INT16 		;
		AND	AL,5FH
		CMP	AL,'Y'                  ;?
		JZ	L_XTK1D1
		JMP	S_CXTUX 		;ʾ
L_XTK1D1:
		XOR	SI,SI
		MOV	AX,4A06H		;ڴ
		INT	2FH
		MOV	AX,4CFFH		;˳
		INT	21H

D_FCCJ		DB	'³Ǽ',0, '׼',0
D_JHJB		DB	68H, 69H, 6AH, 6BH, 66H, 6DH	;³ǽ
	;		A-F1 A-F2 A-F3 A-F4 C-F9 A-F6	;³ʱ[0D2H]
L_XTK1E:
		CMP	AL,6			;<³Ǽ>
		JNZ	L_XTK1F
		MOV	DI,OFFSET K_AF1 	;λ
		MOV	CX,6			;޸
		MOV	BX,OFFSET D_JHJB	;³ǽ
		MOV	SI,OFFSET D_FCCJ	;ʾ
		MOV	AL,'Y'
		CMP	K_FCC,AL		;³Ǽ?
		JNZ	L_XTK1E1
		MOV	AL,'N'
		ADD	SI,9
L_XTK1E1:
		MOV	K_FCC,AL		;任
L_XTK1E2:
		MOV	AL,[BX]
		XCHG	AL,[DI] 		;
		MOV	[BX],AL
		INC	BX
		INC	DI
		LOOP	L_XTK1E2
		JMP	S_QTXS			;ʾ

L_XTK1F:
		CMP	AL,7			;<뿪>
		JNZ	L_XTK1G
		NOT	D_9639			;־
		CMP	D_9639,0
		JZ	L_XTK1F1
		MOV	SI,OFFSET D_9A60
		JMP	S_QTXS			;ʾ״̬
L_XTK1F1:
		RET

L_XTK1G:
		CMP	AL,8			;<ֱд>
K_ZJXP	EQU	$
		JNZ	L_XTK1H
		MOV	AL,11			;ֱд
		CMP	BYTE PTR CS:[102H],0	;еǰֱд?	9.11
		JZ	L_AH18
		MOV	AL,10			;ȡֱд
L_AH18:
		MOV	AH,18H			;
		INT	10H
		RET
L_XTK1H:
		JMP	SHORT L_XTK2

;----------------------------------------------------------------------------
D_XTK2		DB	'תһҳ  ӡַ  ʾ  Ļ  '
		DB	'ƴ  ֵ䷽ʽ  ʾ  ʾ',0
D_DK		DB	'',0
D_GB		DB	'ر',0
D_DYZF		DB	'ӡַ:',0
;ϵͳ-ڶҳ
L_XTK2:
		MOV	SI,OFFSET D_XTK2	;ڶҳ˵
		MOV	CX,800H
		CALL	S_CDKZ			;ʾв˵
		CMP	AL,1BH			;<ESC>
		JNZ	L_XTK2A
		RET

L_XTK2A:
		CMP	AL,2			;<ӡַ>
		JNZ	L_XTK2B
		PUSH	CS
		POP	ES
		MOV	SI,OFFSET D_DYZF
		CALL	S_QTXS			;ʾвʾ
		MOV	DI,030H 		;CS:30HΪַ
		MOV	SI,DI			;
L_XTK2A1:
		CALL	S_INT16 		;ȡַ
		CMP	AL,8			;˸?
		JNZ	L_XTK2A3
		CMP	SI,DI
		JZ	L_XTK2A1
		DEC	DI
L_XTK2A2:
		MOV	BL,D_TUX1		;ɫ:׻
		CALL	S_1403A 		;ʾ˸
		JMP	SHORT L_XTK2A1
L_XTK2A3:
		CMP	AL,0AH			;CTRL+س?
		JZ	L_XTK2A5
		CMP	AL,0DH			;س?
		JZ	L_XTK2A4
		STOSB				;
		JMP	SHORT L_XTK2A2
L_XTK2A4:
		MOV	AX,0A0DH		;س
		STOSW				;
L_XTK2A5:
		CMP	SI,DI			;ӡ?
		JZ	L_XTK2A6
		LODSB				;ȡһַ
		XOR	DX,DX
		XOR	AH,AH
		INT	17H			;ӡ
		JMP	SHORT L_XTK2A5
L_XTK2A6:
		JMP	S_1404			;رʾ

L_XTK2B:
		CMP	AL,3			;<ʾ>
		JNZ	L_XTK2C
		XOR	AX,AX
		MOV	DS,AX
		MOV	BH,3			;ַ
		CMP	BYTE PTR DS:[449H],3	;ʾַ?
		PUSH	CS
		POP	DS
		JA	L_XTK2B1
		MOV	BH,DS:[100H]		;ͼ(ʾʽ)
L_XTK2B1:
		MOV	AX,1407H		;
		INT	10H
		JMP	S_CXTUX 		;ʾ

L_XTK2C:
		CMP	AL,4			;<Ļ>
		JNZ	L_XTK2D
K_CXPM	EQU	$
		MOV	AX,1813H
		INT	10H
		RET

L_XTK2D:
		CMP	AL,5			;<ƴ>
		JNZ	L_XTK2E
		MOV	AL,74H			;JZ
		MOV	SI,OFFSET D_DK
		CMP	AL,BYTE PTR K_PYCZ
		JNZ	L_XTK2D1
		MOV	AL,0EBH 		;JMP
		MOV	SI,OFFSET D_GB
L_XTK2D1:
		MOV	BYTE PTR K_PYCZ,AL
		JMP	S_QTXS

L_XTK2E:
		CMP	AL,6			;<ֵ䷽ʽ>
		JNZ	L_XTK2F
		MOV	SI,OFFSET D_GB
		XOR	D_963B,0FFH
		JZ	L_XTK2E1
		MOV	SI,OFFSET D_DK
L_XTK2E1:
		JMP	S_QTXS

L_XTK2F:
		CMP	AL,7			;<ʾ>
		JNZ	L_XTK2G
		MOV	AL,BYTE PTR K_CMTS
		CMP	AL,7
		JZ	L_XTK2F1
		MOV	AL,7
		MOV	SI,OFFSET D_DK
		JMP	SHORT L_XTK2F2
L_XTK2F1:
		MOV	AL,' '
		MOV	SI,OFFSET D_GB
L_XTK2F2:
		MOV	BYTE PTR K_CMTS,AL
		JMP	S_QTXS

L_XTK2G:
		CMP	AL,8			;<ʾ>
		JNZ	L_XTK2H
		XOR	BYTE PTR DS:[0F4H],2
		JZ	L_XTK2G1
		JMP	S_CXTUX
L_XTK2G1:
		JMP	L_1404
L_XTK2H:
		CMP	AL,48H			;
		JNZ	L_XTK2I
		JMP	L_XTK1
L_XTK2I:
		JMP	L_XTK2

;----------------------------------------------------------------------------
D_QWXS		DB	'λ',0
D_SWXS		DB	'β',0
D_PYXS		DB	'ƴ',0
D_PYTS		DB	' V-zh I-ch U-sh L-ai J-an H-ang K-ao'
		DB	' F-en G-eng Y-ing S-ong V-',0
D_SPXS		DB	'˫ƴ',0
D_SPTS		DB	' Q-iu W-ua.ve R-ia T-ie D-ei P-ou'
		DB	' Z-uan X-i.uang C-un B-ian N-in M-iao',0
D_WBZX		DB	'',0
D_CZXS		DB	'',0
D_DBXS		DB	'籨',0
D_YWXS		DB	'Ӣ',0
;λ
L_QW:
		MOV	SI,OFFSET D_QWXS	;λ
		MOV	AL,1
		JMP	SHORT L_PY1
;β
L_SW:
		CMP	D_SW,0			;β?	5.31
		JZ	L_ERROR
		MOV	AX,D_SW
		MOV	D_2BD6,AX
		MOV	AX,D_SW+2
		MOV	D_2BD8,AX
		MOV	SI,OFFSET D_SWXS	;β
		MOV	AL,2
		JMP	SHORT L_PY1
;ƴ
L_PY:
		CMP	D_PY,0			;ƴ?
		JZ	L_ERROR
		MOV	AX,D_PY
		MOV	D_2BD6,AX
		MOV	AX,D_PY+2
		MOV	D_2BD8,AX
		MOV	AL,4
		MOV	SI,OFFSET D_PYXS	;ƴ
		CALL	L_PY1
		MOV	SI,OFFSET D_PYTS
		JMP	SHORT L_SP1
;˫ƴ
L_SP:
		CMP	D_PY,0			;ƴ?
		JZ	L_ERROR
		MOV	AX,D_PY
		MOV	D_2BD6,AX
		MOV	AX,D_PY+2
		MOV	D_2BD8,AX
		MOV	AL,8
		MOV	SI,OFFSET D_SPXS	;˫ƴ
		CALL	L_PY1
		MOV	SI,OFFSET D_SPTS
L_SP1:
		MOV	BL,D_TUX2		;ɫ:
		JMP	S_A24C
L_ERROR:
		JMP	L_9DC0
;籨
L_DB:
		CMP	D_DB,0			;޵籨?
		JZ	L_ERROR
		MOV	SI,OFFSET D_DBXS
		MOV	AL,80H
L_PY1:
		MOV	D_963A,AL
		MOV	D_2BB9,0		;־
		MOV	D_2BB0,0		;ַ
		MOV	D_959B,0FFH		;ú̬
S_QTXSC:
		CALL	S_QTXS			;ʾвʾ
		PUSH	AX
		MOV	DL,D_CZW
		CALL	S_1403
		POP	AX
L_PY9:
		RET
;ʡ
L_WBZX:
		CMP	D_INTWB+2,0		;ģ鰲װ?
		JZ	L_PY9
		MOV	SI,OFFSET D_WBZX
		MOV	AL,20H
		MOV	D_2BD2,0
		JMP	SHORT L_PY1
;Ӣġ
L_ASC:
		MOV	D_963A,AL		;=0
		MOV	D_2BB9,AL		;־
		MOV	D_959B,0FFH		;ú̬
		JMP	S_1404

D_A210		DB	60H,'', 2EH,'', 27H,'', 22H,''
		DB	5BH,'', 5DH,'', 5CH,'', 7CH,''
		DB	7BH,'', 7DH,''
;ķʽ
L_9BA6:
		CMP	D_2BAC,0FFH		;ķʽ?
		JZ	L_9BB0
L_9BB9:
		MOV	D_95D5,1		;һַ
		RET
L_9BB0:
		MOV	DI,OFFSET D_959D
L_9BB1:
		INC	D_95D5			;=1
L_A1E0:
		CMP	AL,7FH
		JAE	L_A1E5
		CMP	AL,' '                  ;Ĵ
		JNB	L_A1E7
L_A1E5:
		MOV	[DI],AL 		;һֽд뷵
		RET
L_A1E7:
		JA	L_A1F2
		MOV	AH,AL
L_A1EB:
		MOV	[DI],AX
		INC	D_95D5
		RET
L_A1F2:
		MOV	SI,OFFSET D_A210	;ת
		MOV	BL,AL
		MOV	CX,10
L_A1FA:
		LODSB				;ȡ
		CMP	AL,BL			;Ƿü
		JNZ	L_A202
		LODSW				;ȡת
		JMP	SHORT L_A1EB
L_A202:
		LODSW				;ָ
		LOOP	L_A1FA
		MOV	AH,BL
		MOV	AL,0A3H 		;
		OR	AH,80H			;ô
		JMP	SHORT L_A1EB

;ַڡ
L_9C86:
		TEST	D_2BB9,40H		;Ԥѡ־
		JZ	L_9C90
		JMP	L_A4F0			;Ԥѡ
L_9C90:
		CMP	D_959B,0FFH		;̬?
		JNZ	L_9C9A
		JMP	L_9E68			;׼
L_9C9A:
		TEST	BYTE PTR D_2BB9,10H	;д?
		JZ	L_9CA5
		JMP	L_A798
L_9CA5:
		MOV	BX,OFFSET D_963A	;뷽ʽ
		TEST	BYTE PTR [BX],1 	;λ?
		JZ	L_9CA6
		JMP	L_QWCL
L_9CA6:
		TEST	BYTE PTR [BX],20H	;?
		JZ	L_9CA8
		JMP	L_WBCL
L_9CA8:
		CMP	AL,';'                  ;תⲿ?
		JNZ	L_9CB3
L_9CA9:
		JMP	L_A5D7
L_9CB3:
		TEST	BYTE PTR [BX],80H	;籨?
		JZ	L_9CC0
		JMP	L_DBCL
L_9CC0:
		TEST	BYTE PTR [BX],2 	;β?
		JZ	L_9CC7
		CMP	AL,0DH			;س?
		JNZ	L_9CF2
		JMP	L_SW			;β
L_9CC7:
		TEST	BYTE PTR [BX],4 	;ƴ?
		JNZ	L_9CEB
		CMP	AL,0DH			;˫ƴس?
		JNZ	L_9CF2
		JMP	L_SP			;˫ƴ
L_9CEB:
		CMP	AL,0DH			;س?
		JNZ	L_9CF2
		JMP	L_PY			;ƴ
L_9CF2:
		CMP	AL,8			;˸?
		JNZ	L_9CF8
		CMP	D_2BB0,0
		JZ	L_9D48
		CALL	S_9D7D			;λ
		CALL	S_1403K
		DEC	D_2BB0			;ַһ
		JNZ	L_9D4B
		MOV	AL,0DH
		JMP	SHORT L_9CC0
L_9D48:
		JMP	L_9DC5
L_9D4B:
		CALL	S_9FC0			;Ϊָ
		JMP	L_9FA0
L_9CF8:
		CMP	AL,' '
		JNZ	L_9CFE
		MOV	AL,0			;ո=0
		JMP	SHORT L_9D0C
L_9CFE:
		CMP	AL,'9'
		JA	L_9D51
		CMP	AL,'0'
		JB	L_9D51
		JNZ	L_9D0A
		MOV	AL,3AH
L_9D0A:
		AND	AL,0FH			;ѡ
L_9D0C:
		CMP	AL,D_2BD2
		JA	L_9D27
		CBW
		SHL	AX,1
		ADD	AX,OFFSET D_2BBA
		MOV	BX,AX
		MOV	AX,[BX]
		MOV	WORD PTR D_959D,AX
		JMP	L_A559			;ת
L_9D27:
		JMP	L_9DC0			;岢˳
L_9D49:
		JMP	L_9DAE
L_9D51:
		CMP	AL,"'"                  ;ƴ             2.3
		JZ	L_9D55
		CMP	AL,'['                  ;ǰҳ
		JZ	L_9D8B
		CMP	AL,']'                  ;ҳ
		JZ	L_9D49
L_9D54:
		CMP	AL,'`'                  ;Сдĸ`
		JB	L_9D7A
		CMP	AL,'z'
		JA	L_9D7A
L_9D55:
		TEST	D_963A,8		;˫ƴ?
		JZ	L_9D58
		CMP	D_2BB0,4		;4?
		JB	L_9D58
		MOV	D_959B,0FFH		;̬
		JMP	L_9F08			;˫ƴ׼
L_9D58:
		CMP	D_2BB0,8
		JAE	L_9DC0
		INC	D_2BB0			;ַһ
		CALL	S_9D7D			;λ
		CALL	S_9F89			;дʾ
		CALL	S_9FD0			;Ϊָ
L_9FA0:
		MOV	AX,D_2BD6		;
		MOV	D_2BAD,AX
		MOV	D_2BD0,11
		AND	D_2BB9,0F5H		;Ƶ˫ƴλ
		CALL	S_A017			;>
		CALL	S_9FD9			;Ϊ´βָ
		CMP	D_2CC0,0FFH		;ƴ?
		JZ	L_9D60
		CMP	D_2BB0,2
		JNZ	L_9D70
L_9D60:
		MOV	AX,D_2BD6
		MOV	D_2BAF,AX		;׿ʼ
L_9D70:
		TEST	D_2BB9,8		;˫ƴ?
		JNZ	L_9DC6
		CALL	S_A164			;ʾ
		JMP	SHORT L_9DC5
L_9D7A:
		OR	AL,AL
		JNZ	L_9DC0
		JMP	L_9BB9			;Ĵ
;塿
L_9DC0:
		MOV	DL,7
		CALL	S_1403
L_9DC5:
		MOV	D_95D5,0		;˳
L_9DC6:
		RET
;ǰҳ
L_9D8B:
		OR	D_2BB9,2		;Ƶ
		CALL	S_A001			;Ϊָ
		CALL	S_A011			;<
		CALL	S_9FED			;Ϊ´βָ
		CMP	D_2BD0,11
		JZ	L_9D97
		MOV	D_2BD0,11
L_9D97:
		CALL	S_A164			;ʾ
		JMP	SHORT L_9DC5
;ҳ
L_9DAE:
		OR	D_2BB9,2		;Ƶ
		CALL	S_9FD0			;Ϊָ
		CALL	S_A017			;>
		CALL	S_9FD9			;Ϊ´βָ
		CMP	D_9597,0
		JNZ	L_9DAF
		MOV	AL,D_2BCF		;ȡĩҳ
		MOV	D_2BD0,AL		;
		JMP	SHORT L_9D97
L_9DAF:
		MOV	AL,D_2BD2
		OR	AL,AL
		JZ	L_9D97
		CMP	AL,11
		JZ	L_9D97
		MOV	D_2BCF,AL		;ĩҳ
		JMP	SHORT L_9D97
;ʴ
L_WBCL:
		CMP	AL,8			;<˸>
		JNZ	L_WB10
		MOV	BL,D_2BB0
		OR	BL,BL			;м?
		JZ	L_WB2
		XOR	BH,BH
		CMP	D_2BB0[BX],' '          ;в4Z?
		JNZ	L_WB0
		DEC	D_2BB0
L_WB0:
		MOV	D_2BD2,0
		CALL	S_9D7D			;λ
		CALL	S_1403K 		;
		DEC	D_2BB0			;-1
		JNZ	L_WB2
L_WB1:
		MOV	D_959B,0FFH
L_WB2:
		RET
L_WB10:
		CMP	AL,0DH			;<س>
		JNZ	L_WB18
		JMP	L_WBZX
L_WB18:
		CMP	AL,' '                  ;<ո>
		JNZ	L_WB20
		CMP	D_2BD2,0		;?
		JZ	L_WB19
		MOV	AX,0FFH 		;ҳ
		JMP	L_WB61
L_WB19:
		INC	D_2BB0
		CALL	S_9F89			;дʾ
		JMP	L_WB60
L_WB20:
		MOV	CL,D_9650		;ʻ
		OR	CL,CL
		JZ	L_WB30
L_WB21:
		XOR	CH,CH
		MOV	D_9650,CH		;
		XOR	BP,BP
		OR	CL,'0'
		CMP	AL,CL
		JA	L_WB22
		CMP	AL,'1'
		JAE	L_WB24
L_WB22:
		MOV	BP,AX			;BP=0:ѡ
		MOV	AL,1			;ѡ,Ĭϵһ
L_WB24:
		AND	AL,0FH
		MOV	CL,AL
		DEC	CX
		MOV	SI,OFFSET D_BUF 	;()
L_WB24B:
		OR	CX,CX
		JZ	L_WB26
L_WB25:
		LODSW				;ҵCL
		TEST	AX,8080H
		JNZ	L_WB25
		LOOP	L_WB25
L_WB26:
		MOV	DI,OFFSET D_959D	;
		XOR	CX,CX
L_WB27:
		LODSW				;ȡһ
		MOV	[DI],AX
		ADD	DI,2
		INC	CX
		INC	CX
		TEST	AX,8080H		;дʽ
		JNZ	L_WB27
		OR	BYTE PTR [DI-4],80H	;λ1
		OR	BYTE PTR [DI-2],80H	;λ1
		MOV	D_95D5,CL		;ֽ
		MOV	D_2BD2,0
		OR	BP,BP			;=0:ѡ
		JNZ	L_WB29
		JMP	L_WB1
L_WB29:
		MOV	AX,BP
		JMP	L_WB35			;ִ
L_WB30:
		MOV	CL,D_2BD2
		OR	CL,CL			;
		JZ	L_WB51
		MOV	D_95D5,2		;ֽ
		MOV	D_2BD2,0
		OR	CL,'0'
		CMP	AL,CL
		JA	L_WB34
		CMP	AL,'1'
		JB	L_WB34
		MOV	BL,AL
		AND	BL,0FH
		XOR	BH,BH
		SHL	BX,1
		MOV	AX,D_2BBA[BX]		;ѡ
		JMP	L_WB98
L_WB34:
		MOV	DI,OFFSET D_959D
		MOV	CX,D_2BBC		;
		MOV	[DI],CX 		;
		ADD	DI,2
L_WB35:
		CMP	AL,'a'                  ;Сдĸ?
		JB	L_WB36
		CMP	AL,'z'
		JA	L_WB36
L_WB35A:
		MOV	D_959B,0
		MOV	D_2BB0,1
		MOV	SI,OFFSET D_WBZX
		CALL	S_QTXSC 		;ʾвʾ        2.13
		JMP	S_9F89			;дʾ
L_WB36:
		MOV	D_959B,0FFH
		CMP	D_2BAC,0FFH		;дķʽ?
		JNZ	L_WB38
		JMP	L_9BB1			;Ĵ
L_WB38:
		XOR	AH,AH
		MOV	DS:[DI],AX
		INC	D_95D5
		RET
L_WB50:
		JMP	L_9BB9
L_WB51:
		CMP	AL,'a'
		JB	L_WB50
		CMP	AL,'z'
		JA	L_WB50
		CMP	D_2BB0,4
		JZ	L_WB35A
		INC	D_2BB0			;+1
		CALL	S_9F89			;дʾ
		CMP	D_2BB0,4		;4?
		JZ	L_WB60
		RET
;WBZX
L_WB60:
		XOR	AX,AX
L_WB61:
		MOV	SI,OFFSET D_BUF 	;:
		MOV	BX,OFFSET D_2BB1	;
		MOV	CX,1EH
		PUSHF
		CALL	DWORD PTR D_INTWB	;WBZXģ
L_WB63:
		PUSH	CS
		POP	ES

		TEST	DL,80H			;ִ?
		JNZ	L_WB70
L_WB64:
		CALL	S_BEEP			;
		RET				;2.13
L_WB70:
		TEST	DL,1			;ʻ?
		JNZ	L_WB70A
		JMP	L_WB80
L_WB70A:
		TEST	DL,4			;?
		JZ	L_WB76
L_WB71:
		MOV	D_9650,CL
		XOR	CH,CH
		PUSH	CX
		MOV	DL,10H
		CALL	S_9F30			;λʾ
		POP	CX
		MOV	DI,16
		MOV	DL,'1'
L_WB72:
		PUSH	DX
		MOV	BL,D_TUX1
		CALL	S_1403			;ʾ
		INC	DI
L_WB73:
		LODSW				;ȡһ
		MOV	BL,D_TUX2
		PUSH	AX
		OR	AX,8080H
		PUSH	AX
		CALL	S_1403A 		;ʾǰֽ
		INC	DI
		POP	AX
		MOV	AL,AH
		CALL	S_1403A 		;ʾֽ
		INC	DI
		POP	AX
		CMP	DI,78			;ʾ?
		JBE	L_WB74
		POP	DX
		RET
L_WB74:
		TEST	AX,8080H		;дβ?
		JZ	L_WB75
		JMP	SHORT L_WB73
L_WB75:
		MOV	DL,' '
		CALL	S_1403
		INC	DI
		POP	DX
		INC	DX
		LOOP	L_WB72
		RET
L_WB76:
		XOR	CX,CX
L_WB77:
		MOV	DI,OFFSET D_959D
L_WB771:
		LODSW
		INC	CX
		INC	CX
		TEST	AX,8080H		;Ҵβ
		JZ	L_WB78
		MOV	[DI],AX
		ADD	DI,2
		JMP	SHORT L_WB771
L_WB770:
		JMP	L_WB64
L_WB78:
		CMP	AH,' '
		JB	L_WB770
		CMP	AL,' '
		JB	L_WB770
		OR	AX,8080H		;λ1
		MOV	[DI],AX
L_WB79:
		MOV	D_95D5,CL		;ֽ
		JMP	L_WB1
L_WB80:
		TEST	DL,2			;Z?
		JZ	L_WB90
		MOV	DL,10H
		CALL	S_9F30			;λʾ
		MOV	DI,OFFSET D_2BBC	;
		LODSB				;
L_WB84:
		MOV	CL,AL
		XOR	CH,CH
		MOV	D_2BD2,CL		;
		MOV	DL,'1'
L_WB88:
		PUSH	DX
		CALL	S_1403			;ʾ
		LODSW				;д
		STOSW
		PUSH	AX
		CALL	S_1403A 		;ʾǰֽ
		POP	AX
		MOV	DL,AH
		CALL	S_1403			;ʾֽ
		LODSB
		CALL	S_1403A 		;ʾ
		LODSB
		CALL	S_1403A
		LODSB
		CALL	S_1403A
		LODSB
		CALL	S_1403A
		MOV	DL,' '
		CALL	S_1403
		POP	DX
		INC	DX
		LOOP	L_WB88
		RET
L_WB90:
		TEST	DL,4			;?
		JZ	L_WB97
		MOV	DI,OFFSET D_2BBC	;
		LODSB				;
L_WB92:
		MOV	CL,AL
		XOR	CH,CH
		MOV	D_2BD2,CL		;
		REP	MOVSW			;
		CALL	S_BEEP
L_WB94:
		MOV	DL,10H
		CALL	S_9F30			;λʾ
		MOV	DL,'1'
		CALL	S_A180			;ʾֲ
		RET
L_WB97:
		XCHG	AH,AL
L_WB98:
		MOV	WORD PTR D_959D,AX	;
		MOV	D_95D5,2		;ֽ
		MOV	D_959B,0FFH
		RET
;籨
L_DBCL:
		CMP	AL,0DH			;س?
		JNZ	L_DB1
		JMP	L_DB			;籨
L_DB1:
		CMP	AL,8			;˸?
		JZ	L_9DE0
		JMP	L_9E2A
;λҳ
L_9C3E:
		CMP	AL,'['                  ;<
		JNZ	L_9C54
		MOV	AX,D_2BBA		;ǰ
		SUB	AH,11		       ;λ-11
		CMP	AH,0A1H 		;<0
		JNB	L_9C51
		ADD	AH,94		       ;+94
		DEC	AX			;-1
		CMP	AL,0A1H
		JNB	L_9C51
		MOV	AX,0A1A1H
L_9C51:
		JMP	L_9E0D			;ʾ
L_9C54:
		CMP	AL,']'                  ;>
		JNZ	L_9C60
		MOV	AX,D_2BCE		;ǰĩ
		INC	AH			;λ+1
		CMP	AH,0FFH
		JNZ	L_9C5C
		MOV	AH,0A1H
		INC	AL
L_9C5C:
		CMP	AL,0FFH
		JNZ	L_9C5E
		MOV	AX,0A1A1H
L_9C5E:
		JMP	L_9E0D			;ʾ
;λѡС
L_9C60:
		CMP	AL,' '
		JNZ	L_9C68
		MOV	AL,'0'                  ;ո=0
		JMP	SHORT L_9C74
L_9C68:
		CMP	AL,'9'                  ;
		JA	L_9C77
		CMP	AL,'0'
		JB	L_9C77
		JNZ	L_9C74
		MOV	AL,3AH
L_9C74:
		JMP	L_9D0A			;ѡ
L_9C77:
		JMP	L_9BA6			;תСдĸ
;λ
L_QWCL:
		CMP	AL,0DH			;س?
		JNZ	L_9DD2
		JMP	L_QW			;λ
L_9DD2:
		CMP	D_2BB0,5		;λ+ո?
		JZ	L_9C3E
L_9DDC:
		CMP	AL,8			;˸?
		JNZ	L_9DF7
L_9DE0:
		MOV	DL,8
		CALL	S_1403			;˸
		DEC	D_2BB0			;-1
		CMP	D_2BB0,0		;=0?
		JNZ	L_9DF4
		MOV	D_959B,0FFH		;̬
L_9DF4:
		JMP	L_9DC5
L_9DF7:
		CMP	AL,' '                  ;λ+ո?
		JNZ	L_9E2A
		MOV	AX,WORD PTR D_2BB1	;ȡѼ
		CMP	D_2BB0,2
		JZ	L_9DF8
		CBW
		XCHG	AH,AL
L_9DF8:
		MOV	D_2BB0,5		;ñ־
		XCHG	AL,AH
		AND	AX,0F0FH
		AAD				;=AL
		OR	AL,AL
		JZ	L_9DF9
		CMP	AL,94
		JBE	L_9DFA
L_9DF9:
		MOV	AL,1
L_9DFA:
		ADD	AX,0A1A0H		;AX=
L_9E0D:
		MOV	SI,OFFSET D_2BBA	;ַ
		MOV	CX,0BH			;=11
		MOV	D_2BD2,CL
L_9E17:
		CMP	AH,0FFH 		;=95?
		JNZ	L_9E18
		MOV	AH,0A1H 		;
		INC	AX			;+1
L_9E18:
		CMP	AL,0FFH
		JNZ	L_9E1A
		MOV	AL,0A1H
L_9E1A:
		PUSH	AX
		MOV	DL,5
		CALL	S_1402			;λ
		POP	AX
		PUSH	AX
		CALL	S_9E50			;ʾ
		POP	AX
		PUSH	AX
		MOV	AL,AH
		CALL	S_9E50			;ʾλ
		POP	AX
L_9E1F:
		MOV	[SI],AX 		;д
		ADD	SI,2			;ָ2
		INC	AH			;λ+1
		CMP	AH,0FFH 		;β(λ=95)
		JNZ	L_9E20
		MOV	AH,0A1H 		;
		INC	AX			;+1
		CMP	AL,0FFH
		JNZ	L_9E20
		MOV	AL,0A1H
L_9E20:
		LOOP	L_9E1F
		JMP	L_A172			;ʾ
L_9E28:
		JMP	L_9BA6			;תĴ
L_9E2A:
		CMP	AL,'0'
		JB	L_9E28
		CMP	AL,'9'
		JA	L_9E28
		INC	D_2BB0
		CALL	S_9F89			;дʾ
		CMP	D_2BB0,4		;ļ?
		JNB	L_9E40
		RET
L_9E40:
		MOV	SI,OFFSET D_2BB1
		LODSW				;ȡǰ
		XCHG	AL,AH
		AND	AX,0F0FH
		AAD
		MOV	BL,AL			;
		LODSW				;ȡ
		XCHG	AL,AH
		AND	AX,0F0FH
		AAD
		MOV	BH,AL			;λ
		TEST	D_963A,1		;λʽ?
		JZ	L_9E48
		OR	BH,BH
		JZ	L_9E47
		CMP	BH,94
		JA	L_9E47
		OR	BL,BL
		JZ	L_9E47
		CMP	BL,94
		JA	L_9E47
		ADD	BX,0A0A0H		;תΪ
L_9E46:
		MOV	WORD PTR D_959D,BX	;淵
		JMP	L_A559			;ת
L_9E47:
		MOV	D_959B,-1
		JMP	L_9DC0
L_9E48:
		MOV	AL,100
		MUL	BL
		MOV	BL,BH
		XOR	BH,BH
		ADD	BX,AX
		SHL	BX,1
		ADD	BX,D_DB 		;ӵ籨ַ
		MOV	BX,[BX] 		;ȡ
		JMP	SHORT L_9E46

;ӳ:ʾŻλ
S_9E50:
		SUB	AL,0A0H
S_9E51:
		XOR	AH,AH
		MOV	DH,0AH			;=10
		DIV	DH
		MOV	BL,D_TUX2		;ɫ:װ
		PUSH	AX			;λAH
		OR	AL,30H			;ʮλ
		CALL	S_1403A
		POP	AX
		MOV	DL,AH
		OR	DL,30H			;λ
		JMP	S_1403

;׼
L_9E68:
		CMP	D_963A,0		;ASCII?
		JNZ	L_9E72
L_9E6F:
		JMP	L_9BA6			;Ĵ
L_9E72:
		CALL	S_9F62			;SHIFT+ո?
		JNB	L_9E80
		MOV	AL,D_95D6
		MOV	D_95D5,AL
		RET
L_9E80:
		TEST	D_2BB9,10H		;д?
		JZ	L_9E86
		JMP	L_A73B			;ѡ
L_9E86:
		CMP	D_2BB0,0
		JZ	L_9EC0
		CMP	AH,82H			;ALT+'-'
		JNB	L_9EAB
		CMP	AH,78H			;ALT+1
		JB	L_9E9E
		MOV	AL,AH
		SUB	AL,77H
		JMP	L_9D0C			;ѡ
L_9E9E:
		CALL	S_9F66			;ALT+ո
		JNB	L_9EC0
		JMP	L_9D0C			;ѡ
L_9EAB:
		JNZ	L_9EB4
		TEST	D_963A,1		;λ?
		JNZ	L_9E6F
		NOT	D_959B			;ALT+'-'
		JMP	L_9D8B
L_9EB4:
		CMP	AH,83H			;ALT+'+'?
		JNZ	L_9EC0
		TEST	D_963A,1		;λ?
		JNZ	L_9E6F
		NOT	D_959B
		JMP	L_9DAE
;λ׼
L_9EC0:
		TEST	D_963A,1		;λ?
		JZ	L_9F00
		CMP	D_2BB0,5		;+ո?
		JNZ	L_9ED0
		JMP	L_QWCL
L_9ED0:
		CMP	AL,'0'                  ;
		JB	L_9EFE
		CMP	AL,'9'
		JA	L_9EFE
		MOV	SI,OFFSET D_QWXS	;'λ'
L_9ED8:
		CALL	S_QTXSC 		;ʾвʾ
		MOV	D_2BB1,AL
		MOV	BL,D_TUX1		;ɫ:װ
		CALL	S_1403A 		;ʾ
		MOV	D_2BB0,1
L_9EFA:
		AND	D_2BB9,0EFH		;λ
		MOV	D_959B,0		;δ̬
		JMP	L_9DC5
L_9EFE:
		JMP	L_9BA6			;ת
;籨׼
L_9F00:
		TEST	D_963A,80H		;<籨>
		JZ	L_9F08
		CMP	AL,'0'                  ;
		JB	L_9EFE
		CMP	AL,'9'
		JA	L_9EFE
		MOV	SI,OFFSET D_DBXS	;'籨'
		JMP	SHORT L_9ED8
;βƴ˫ƴ׼
L_9F08:
		CALL	S_9F61			;CTRL+ո?		11.14
		JNB	L_9F08A
		MOV	D_2BB0,0		;=0
		OR	D_2BB9,80H		;ñ־
		JMP	L_9DC0
L_9F08A:
		CMP	AL,'a'                  ;Сдĸ
		JB	L_9F09
		CMP	AL,'z'
		JBE	L_9F0A
L_9F09:
		AND	D_2BB9,0B0H	       ;		       12.23
		JMP	L_9BA6
L_9F0A:
		MOV	D_959B,0FFH		;̬
		MOV	D_2BB0,1		;=1
		TEST	D_963A,20H		;?
		JZ	L_9F10
		MOV	D_2BD2,0
		MOV	SI,OFFSET D_WBZX	;' '
		CALL	S_QTXSC
		CALL	S_9F89
		JMP	L_9EFA
L_9F10:
		TEST	D_963A,2		;β?
		JZ	L_9F12
		MOV	SI,OFFSET D_SWXS	;'β '
		JMP	SHORT L_9F18
L_9F12:
		TEST	D_963A,4		;ƴ?
		JZ	L_9F14
		MOV	SI,OFFSET D_PYXS	;'ƴ '
		JMP	SHORT L_9F18
L_9F14:
		MOV	SI,OFFSET D_SPXS	;'˫ƴ '
L_9F18:
		CALL	S_QTXSC 		;ʾвʾ
		AND	D_2BB9,0F6H		;һƵ˫ƴλ
		MOV	D_2BB0,1
		CALL	S_9F89			;дʾ
		CALL	S_9FC0			;Ϊָ
		CALL	S_A017			;>
		CALL	S_9FD9			;Ϊ´βָ
		CALL	S_A164			;ʾ
L_9F20:
		JMP	L_9EFA			;λδ̬

;ӳ:ʾвʾ
S_QTXS1:
		PUSH	AX
		JMP	SHORT L_QT2
S_QTXS:
		PUSH	AX
		CALL	S_1400			;ʾ
		XOR	DL,DL			;λ
		XOR	BH,BH
		MOV	BL,D_QTS1		;ɫ:׻(ʾʽ>3)
		PUSH	DS
		XOR	AX,AX
		MOV	DS,AX
		CMP	BYTE PTR DS:[449H],4
		POP	DS
		JNB	L_QT1
		MOV	BL,D_QTS2		;ɫ:(ʾʽ<4)
L_QT1:
		CALL	S_A249			;λʾ
L_QT2:
		MOV	BP,CS
		MOV	SI,OFFSET D_QT
		MOV	BL,4EH
		MOV	DL,4CH
		MOV	AX,140AH
		INT	10H
		POP	AX
		RET

;ӳ:λʾַ
S_A249:
		CALL	S_1402
;ӳ:ʾַ
S_A24C:
		CALL	S_A24A
S_A24E:
		MOV	DL,82			;8.7
		JMP	S_1402
;ӳ:ʾַ
S_A24A:
		LODSB				;ȡһַ
		OR	AL,AL			;?
		JZ	L_A24B
		CALL	S_1403A 		;ʾ
		JMP	SHORT S_A24A
L_A24B:
		RET

D_QT	DB	255,128,128,159,177,129,131,134,140,152,176,177,191,128,128,255
	DB	255,  0,  0,  0,128,128,  0,  0,  0,  0,  0,152,152,  0,  0,255
	DB	255,  0,  0, 48,113,240, 48, 48, 48, 48, 48, 49,252,  0,  0,255
	DB	255,  1,  1,249,141, 13, 13,121, 13, 13, 13,141,249,  1,  1,255

;ӳ:˵ ַSI,CH,λCL AL=ѡ
S_CDKZ:
		MOV	DI,SI
		CALL	S_1400			;ʾ
		MOV	BL,D_TUX1		;ɫ:׻
		XOR	DL,DL			;λ
		CALL	S_A249			;ʾ
		MOV	DH,1			;ĬϺ
L_CD00:
		CALL	S_A251
		CALL	S_INT16 		;
		CMP	AL,1BH			;ESC
		JZ	L_CD08
		CMP	AL,0DH			;س
		JNZ	L_CD10
		CALL	S_1404			;رʾ
		MOV	AL,DH			;ѡ
		RET
L_CD08:
		CALL	S_1404			;رʾ
		MOV	AL,1BH			;ESC
		RET
L_CD10:
		CMP	AH,4DH			;
		JNZ	L_CD20
		CALL	S_A250			;ԭʾ
		CMP	DH,CH			;ѵ?
		JZ	L_CD11
		INC	DH			;1
		JMP	SHORT L_CD00
L_CD11:
		MOV	DH,1			;1
		JMP	SHORT L_CD00
L_CD20:
		CMP	AH,4BH			;
		JNZ	L_CD30
		CALL	S_A250			;ԭʾ
		CMP	DH,1			;=1?
		JZ	L_CD21
		DEC	DH			;1
		JMP	SHORT L_CD00
L_CD21:
		MOV	DH,CH			;
		JMP	SHORT L_CD00
L_CD30:
		CMP	AH,48H			;
		JZ	L_CD33
		CMP	AH,50H			;
		JNZ	L_CD00
L_CD33:
		MOV	AL,AH
		RET

;ӳ:λʾַSI
S_A250:
		MOV	BL,D_TUX1		;ɫ:׻
		JMP	SHORT L_A252
S_A251:
		MOV	BL,D_QTS1		;ɫ:׻
L_A252:
		PUSH	CX
		MOV	AL,10
		MUL	DH
		SUB	AX,10
		MOV	SI,DI
		ADD	SI,AX
		XOR	CH,CH
		ADD	SI,CX
		MOV	DL,CL
		ADD	DL,AL
		CALL	S_1402			;λ
		MOV	CX,8
L_A253:
		LODSB				;ȡһַ
		CALL	S_1403A 		;ʾ
		LOOP	L_A253
		CALL	S_A24E			;8.7
		POP	CX
		RET

;ӳ:ԭINT16ȡַ
S_INT16_1:
		MOV	AH,11H
INT16_AH1	EQU	$-1
		JMP	SHORT L_INT16_1
S_INT16:
		MOV	AH,10H
INT16_AH0	EQU	$-1
L_INT16_1:
		PUSHF
		CALL	CS:D_INT16
		RET

;ӳ:붨λ
S_9D7D:
		MOV	DL,4
;ӳ:ַλ
S_9D7F:
		ADD	DL,D_2BB0
		PUSH	AX
		CALL	S_1402			;ʾй궨λ
		POP	AX
		RET

;ӳ:λ5ʾ
S_9F2E:
		MOV	DL,5
;ӳ:λʾ
S_9F30:
		CALL	S_1402			;ʾй궨λ
;ӳ:ָλÿʼʾ
S_9F35:
		MOV	CX,76
D_9F36	EQU	$-2
		SUB	CL,DL			;ָλֽ
		PUSH	DX
		CALL	S_1401
		POP	DX
;ӳ:ʾй궨λ
S_1402:
		MOV	AX,1402H
		INT	10H
		RET
S_1401:
		MOV	DL,' '                  ;ո
S_1401A:
		MOV	BL,D_TUX1
		XOR	BH,BH
		MOV	AX,1401H
		INT	10H
		RET
S_1403K:
		PUSH	BX
		MOV	CX,1
		CALL	S_1401			;ʾһո
		POP	BX
		RET

;ӳ:رʾ
S_1404:
		MOV	BL,10H
S_14041:
		CMP	BYTE PTR CS:[100H],12H	;VGA?
		JB	L_1404
		TEST	BYTE PTR CS:[0F4H],2	;ʾ?
		JZ	L_1404
		JMP	S_CXTUX
L_1404:
		MOV	AX,1404H
D_1404	EQU	$-2				;ǷʽΪ1400H
		INT	10H
		RET

;ӳ:ʾ
S_1400:
		MOV	BL,10H
		MOV	AX,1400H
		INT	10H
		RET

;ӳ:ʾַAL
S_1403A:
		MOV	DL,AL
;ӳ:ʾַDL
S_1403:
		MOV	AX,1403H
		INT	10H
		RET

;ӳ:CTRL+ո
S_9F61:
		MOV	DL,4			;CTRL
		JMP	SHORT L_9F60
;ӳ:SHIFT+ո
S_9F62:
		MOV	DL,3			;SHIFT
		JMP	SHORT L_9F60
;ӳ:ALT+ո
S_9F66:
		MOV	DL,8			;ALT
L_9F60:
		MOV	DI,40H
		MOV	ES,DI
		CMP	AH,39H			;ոɨ?
		JNZ	L_9F77
		TEST	ES:[17H],DL		;ת?
		JZ	L_9F77
		XOR	AL,AL
		STC				;
		RET
L_9F77:
		CLC				;
		RET

;ӳ:дʾ
S_9F89:
		PUSH	AX
		XOR	BH,BH
		MOV	BL,D_2BB0
		MOV	D_2BB0[BX],AL		;д
		MOV	BL,D_TUX1		;ɫ:װ
		CALL	S_1403A 		;ʾ
		POP	AX
		RET

;ӳ:Ϊָ
S_9FC0:
		MOV	AX,D_2BD6
		MOV	D_2BAD,AX
		ADD	AX,2
L_9FCA:
		MOV	D_2BAF,AX
		RET
;ӳ:Ϊ´βָ
S_9FD9:
		MOV	AX,D_2BAF
		SUB	AX,2
		MOV	D_9646,AX
		MOV	AX,D_2BAD
		JMP	SHORT L_9FCA
;ӳ:Ϊָ
S_9FD0:
		MOV	AX,D_2BAF
L_9FD4:
		MOV	D_2BAD,AX
		RET
;ӳ:Ϊָ
S_A001:
		MOV	AX,D_9646
		JMP	SHORT L_9FD4
;ӳ:Ϊ´βָ
S_9FED:
		MOV	AX,D_9646
		ADD	AX,2
		MOV	D_2BAF,AX
		MOV	AX,D_2BAD
		MOV	D_9646,AX
		RET

D_1J		DW	OFFSET L_A28E		;һ
D_2J		DW	OFFSET L_A300		;
D_3J		DW	OFFSET L_A350		;
D_4J		DW	OFFSET L_A390		;ļ
;ӳ:<
S_A011:
		MOV	DI,D_2BD6
		SUB	DI,2
		STD
		MOV	AL,D_2BD0
		CBW
		DEC	AX
		SHL	AX,1
		ADD	AX,OFFSET D_2BBA
		MOV	D_2BC0,AX		;뿪ʼдַ
		JMP	SHORT L_A018
;ӳ:>
S_A017:
		MOV	DI,D_2BD8		;β
		MOV	D_2BC0,OFFSET D_2BBA	;뿪ʼдַ
L_A018:
		MOV	SI,D_2BAD		;βʼλ
		AND	D_2BB9,0DFH		;ʾλ
		XOR	CX,CX
		MOV	D_2BD2,CL		;ʾ
		MOV	D_9597,CX		;
		MOV	D_2CC0,CL		;ƴ־
		PUSH	CS
		POP	ES
		MOV	BL,D_2BB0
		TEST	D_963A,4		;ƴ?
		JNZ	L_A01B
		CMP	BL,4			;9.27
		JBE	L_A01A
		JMP	L_9DC0
L_A01A:
		XOR	BH,BH
		SHL	BX,1
		JMP	D_1J-2[BX]		;һ~ļ
L_A01B:
		CALL	S_A010			;ƴԤ
		OR	BP,BP
		JZ	L_A01C
		CMP	BP,1
		JNZ	L_A01BB
		JMP	L_A28F			;һ
L_A01BB:
		MOV	D_2A,BX 		;ת˫ƴ
		JMP	L_A301			;
L_A01C:
		CMP	D_2A,0
K_PYCZ	EQU	$
		JZ	L_A01D
		MOV	AX,D_2A
		MOV	WORD PTR D_2CC1,AX	;
		MOV	AL,D_2B
		CMP	AL,'`'
		JZ	L_A01D
		MOV	D_2CC1+2,AL		;ڶĸ
		MOV	D_2CC1+3,'?'
		MOV	D_2A,0
		XOR	DX,DX			;DH:ʾ
		MOV	D_9597,DX		;
		MOV	D_2BD2,DH
		MOV	D_966C,3		;=3˫ƴ
		OR	D_2BB9,8		;˫ƴ
		CMP	D_SPCZ,0		;Ƿװ˫ƴ?
		JZ	L_A01F
		CALL	S_A9000 		;˫ƴ
		JMP	L_A610
L_A01D:
		CMP	D_2BB0,3
		JBE	L_A01F
		CMP	D_2BB0,5
		JA	L_A01F
		JMP	L_A390			;˫ƴļ
L_A01F:
		RET

D_2A		DW	0			;ת˫ƴ
D_2B		DB	0			;ĩ

;ƴԤ2BB12CC1,:BP=ѯ,ѯ:BL,BH,DL
S_A010:
		MOV	AH,BL			;
		MOV	BP,OFFSET D_2BB1
L_A012:
		MOV	AL,CS:[BP]		;2BB12CC1
		MOV	CS:[BP+10],AL
		INC	BP
		DEC	AH
		JNZ	L_A012
		MOV	D_2B,AL 		;ĩ
		MOV	DH,AL

		CMP	BL,1			;<һ>?
		JNZ	L_A020
		MOV	BL,AL
		MOV	BP,1			;һ
		RET
L_A020:
		MOV	AX,WORD PTR D_2CC1
		CMP	BL,2			;<>?
		JNZ	L_A030
		MOV	BX,AX
		JMP	L_A061
L_A030:
		MOV	BP,OFFSET D_3JB0	;˫ĸ
L_A031:
		CMP	BYTE PTR CS:[BP],0
		JZ	L_A034
		CMP	AX,CS:[BP]
		JZ	L_A032
		ADD	BP,3
		JMP	SHORT L_A031
L_A032:
		MOV	AL,CS:[BP+2]		;viu
		MOV	D_2CC1,AL
		MOV	AH,D_2BB0
		SUB	AH,2			;ĸ
		MOV	BP,OFFSET D_2CC1+2	;ĸַ
L_A033:
		MOV	AL,CS:[BP]
		MOV	CS:[BP-1],AL
		INC	BP
		DEC	AH
		JNZ	L_A033
		DEC	BL			;-1
		MOV	D_2CC0,0FFH		;ƴ־
		JMP	SHORT L_A020		;
L_A034:
		MOV	AX,WORD PTR D_2CC1+1	;ָĸ

		CMP	BL,3			;<>?
		JNZ	L_A040
		CMP	BYTE PTR D_2CC1,'a'
		JNZ	L_A036
		CMP	WORD PTR D_2CC1+1,'gn'
		JNZ	L_A035
		MOV	BX,'ga'
		JMP	L_A060			;
L_A035:
		XOR	BP,BP
		RET
L_A036:
		CMP	DH,"'"                  ;?              2.3
		JNZ	L_A036A
		MOV	BX,WORD PTR D_2CC1
		JMP	L_A061
L_A036A:
		MOV	DL,D_2CC1
		MOV	BX,OFFSET D_3JB
L_A037:
		CMP	BYTE PTR [BX],0
		JZ	L_A035
		CMP	AX,[BX]
		JZ	L_A038
		ADD	BX,3
		JMP	SHORT L_A037
L_A038:
		MOV	BH,[BX+2]
		MOV	BL,DL
L_A039:
		JMP	L_A060			;
L_A040:
		CMP	BL,4			;<ļ>?
		JNZ	L_A050
		CMP	DH,"'"                  ;?              2.3
		JZ	L_A036A
L_A040A:
		MOV	DL,D_2CC1+3
		MOV	BX,OFFSET D_4JB
L_A041:
		CMP	BYTE PTR DS:[BX],0
		JZ	L_A044
		CMP	AX,[BX]
		JNZ	L_A042
		CMP	DL,[BX+2]
		JZ	L_A043
L_A042:
		ADD	BX,4
		JMP	SHORT L_A041
L_A043:
		MOV	BH,[BX+3]
		MOV	BL,D_2CC1
		JMP	SHORT L_A060		;
L_A044:
		XOR	BP,BP
		RET
L_A048:
		CMP	BL,6			;<>?		2.3
		JNZ	L_A044
		CMP	DH,"'"                  ;               2.3
		JZ	L_A050A
		JMP	SHORT L_A044
L_A050:
		CMP	BL,5			;<>?
		JNZ	L_A048
		CMP	DH,"'"                  ;               2.3
		JZ	L_A040A
L_A050A:
		MOV	DX,WORD PTR D_2CC1+3
		MOV	BX,OFFSET D_5JB
L_A051:
		CMP	BYTE PTR DS:[BX],0
		JZ	L_A044
		CMP	AX,[BX]
		JNZ	L_A052
		CMP	DX,[BX+2]
		JZ	L_A053
L_A052:
		ADD	BX,5
		JMP	SHORT L_A051
L_A053:
		MOV	BH,[BX+4]
		MOV	BL,D_2CC1
L_A060:
		MOV	D_2CC0,0FFH		;ƴ־
L_A061:
		CALL	S_A080
		MOV	BP,2			;
		RET

;ӳ:ʾѯ
S_A080:
		PUSH	DX
		MOV	DL,13
		CALL	S_1402
		MOV	DL,BL
		CALL	S_14030
		MOV	DL,BH
		CALL	S_14030
		POP	DX
		RET
S_14030:
		PUSH	BX
		MOV	BX,1DH				;2.12
		CALL	S_1403
		POP	BX
		RET

D_3JB0		DB	'zhv', 'chi', 'shu', 0         ;˫ĸ
D_3JB		DB	'ail', 'anj', 'aok', 'eid', 'enf', 'ons', 'oup'
		DB	'iar', 'iet', 'ihx', 'ijb', 'ikm', 'inn', 'ios'
		DB	'iuq', 'iss', 'uaw', 'uew', 'uhx', 'uiv', 'ujz'
		DB	'uly', 'unc', 'uoo', 'vew', 0  ;
D_4JB		DB	'angh', 'engg', 'ongs'
		DB	'ianb', 'iaom', 'ingy', 'ions'
		DB	'uaiy', 'uanz', 0              ;ļ
D_5JB		DB	'iangx', 'iongs', 'uangx', 0   ;

;һ
L_A28E:
		MOV	BL,D_2BB1		;ȡһѯ
L_A28F:
		TEST	D_963A,2		;β?
		JNZ	L_A290
		TEST	D_2BB9,1		;һƵ?
		JNZ	L_A290
		MOV	SI,D_2BD6		;ƴ
		SUB	SI,11*26*2		;һֱ
		MOV	DI,OFFSET D_2BBA	;
		MOV	AL,BL
		AND	AL,1FH			;Ϊ1~26
		CBW
		DEC	AX			;0~25
		MOV	CX,22			;ÿ11
		MUL	CX
		ADD	SI,AX			;Ƶĸ
		REP	MOVSB			;д
		MOV	D_2BD2,11		;
		OR	D_2BB9,1		;һƵλ
		RET
L_A290:
		AND	BL,1FH			;ת
L_A295:
		CMP	SI,DI			;?
		JZ	L_A2AF
		MOV	AL,[SI] 		;ȡβ
		AND	AL,1FH			;ȡһ
		CMP	AL,BL			;
		JZ	L_A2C7
L_A2AB:
		LODSW				;תһ
		JMP	SHORT L_A295
L_A2AF:
		OR	CX,CX			;=0?
		JZ	L_A2C1
		MOV	D_9597,CX		;
		CMP	CX,11			;>11?
		JA	L_A2C1
		MOV	D_2BAD,DI		;´βָ
L_A2C1:
		CLD
		RET
L_A2C7:
		CALL	S_A2D9			;봦
		JMP	SHORT L_A2AB
;ӳ:봦
S_A2D9:
		CALL	S_A257			;תΪ벢д
		JB	L_A2EE
		TEST	D_2BB9,20H		;ʾλ?
		JNZ	L_A2EE
		MOV	D_2BAD,SI		;´βָ
		OR	D_2BB9,20H		;ʾλ
L_A2EE:
		INC	CX			;+1
		RET
;
L_A300:
		MOV	BX,WORD PTR D_2BB1	;ȡǰѯ
L_A301:
		AND	BX,1F1FH		;ת
		MOV	AH,BH
		XOR	AL,AL
		SHR	AX,1
		SHR	AX,1
		SHR	AX,1
		MOV	BH,AH
		OR	BL,AL
L_A31F:
		CMP	SI,DI			;?
		JZ	L_A338
		MOV	AX,[SI] 		;ȡ
		AND	AX,3FFH 		;ȡ10λ
		CMP	AX,BX			;
		JZ	L_A33A
L_A336:
		LODSW				;תһ
		JMP	SHORT L_A31F
L_A338:
		JMP	L_A2AF
L_A33A:
		TEST	D_963A,2		;β
		JNZ	L_A33C
		TEST	D_2BB9,2		;Ƶ?
		JNZ	L_A33C
		TEST	BYTE PTR DS:[SI+1],80H
		JZ	L_A336
L_A33C:
		CALL	S_A2D9			;봦
		JMP	SHORT L_A336
;
L_A350:
		MOV	BX,WORD PTR D_2BB1	;ȡǰѯ
		MOV	DL,D_2BB1+2		;ȡѯ
L_A351:
		AND	BX,1F1FH		;ת
		MOV	AH,BH
		XOR	AL,AL
		SHR	AX,1
		SHR	AX,1
		SHR	AX,1
		MOV	BH,AH
		OR	BL,AL
		AND	DL,1FH			;ת
		SHL	DL,1
		SHL	DL,1
		OR	BH,DL
L_A361:
		CMP	SI,DI			;?
		JZ	L_A38B
		MOV	AX,[SI] 		;ȡ
		AND	AX,7FFFH
L_A383:
		CMP	AX,BX			;
		JZ	L_A38E
L_A387:
		LODSW				;תһ
		JMP	SHORT L_A361
L_A38B:
		JMP	L_A2AF			;괦
L_A38E:
		CALL	S_A2D9			;봦
		JMP	SHORT L_A387
;ļ
L_A390:
		XOR	DX,DX			;DH:ʾ
		MOV	D_9597,DX		;
		MOV	D_2BD2,DH
		CMP	D_SPCZ,0		;Ƿװ˫ƴ?
		JZ	L_A391
		MOV	D_966C,3
		OR	D_2BB9,8		;˫ƴ
		CALL	S_A900
		JMP	L_A610
L_A391:
		RET

;ӳ:ʾ
S_A164:
		MOV	DL,10H			;λ
		CALL	S_9F30			;λʾ
L_A172:
		MOV	DL,'0'
S_A180:
		MOV	CX,11
		CMP	CX,D_9597		;>11?
		JNB	L_A185
		SUB	D_9597,CX		;-11
		JMP	SHORT L_A189
L_A185:
		MOV	D_9597,0		;
L_A189:
		MOV	CL,D_2BD2		;ʾ
		OR	CL,CL			;=0?
		JNZ	L_A19D
		TEST	D_963A,8		;˫ƴ?
		JNZ	L_A190
S_BEEP:
		MOV	DL,7
K_CMTS	EQU	$-1
		CALL	S_1403			;,˳
L_A190:
		RET
L_A19D:
		MOV	SI,OFFSET D_2BBC
		CMP	DL,'0'
		JNZ	L_A1A2
		MOV	SI,OFFSET D_2BBA	;ָ
		PUSH	DX
		JMP	SHORT L_A1A6
L_A1A2:
		PUSH	DX
		MOV	BL,D_TUX2		;ɫ:
		CALL	S_1403			;ʾ
L_A1A6:
		TEST	D_963A,8		;˫ƴ?
		JNZ	L_A1A7
L_A1A7A:
		MOV	DL,':'
		CALL	S_1403			;ʾ':'
L_A1A7:
		MOV	BL,D_TUX1		;ɫ:׻
		LODSB
		CALL	S_1403A 		;ʾǰֽ
		LODSB
		CALL	S_1403A 		;ʾֽ
		TEST	D_963A,8		;˫ƴ?
		JZ	L_A1B0
		MOV	AX,[SI-2]		;ȡ
		CMP	D_2BB0,1		;һ?
		JNZ	L_A1A8
		CALL	S_A9A0			;ȡ˫ƴ
		MOV	AL,AH
		JMP	SHORT L_A1A9
L_A1A8:
		CMP	D_2BB0,2		;?
		JNZ	L_A1B0
		CALL	S_A9B8			;ȡ
L_A1A9:
		CALL	S_1403A
L_A1B0:
		MOV	DL,' '
		CALL	S_1403			;ʾո
		POP	DX
		INC	DL			;żһ
		CMP	DL,3AH			;10
		JNZ	L_A1C8
		MOV	DL,'0'                  ;'0'
L_A1C8:
		LOOP	L_A1A2
		MOV	DL,8
		CALL	S_1403			;˸
;ӳ:ʾʣ
S_A1CC:
		MOV	AX,D_9597		;ʣ
		MOV	SI,OFFSET D_A1D8+3	;λ
		MOV	CX,30AH
L_A1D0:
		DIV	CL			;10
		OR	AH,'0'
		MOV	[SI],AH 		;д
		XOR	AH,AH
		DEC	SI
		DEC	CH
		JNZ	L_A1D0
L_A1D1:
		MOV	BL,D_TUX2		;ɫ:
		JMP	S_A24C			;ʾַ
D_A1D8		DB	'[000]',0

;ӳ:ת鵽ַΪ벢д
S_A257:
		PUSH	DI
		MOV	AL,D_2BD2		;ʾ
		CMP	AL,D_2BD0		;>=11
		JNB	L_A289
		MOV	AX,SI			;鵽ַ
		SUB	AX,D_2BD6		;ַ
		SHR	AX,1			;2ú
		MOV	DL,5EH			;=94
		DIV	DL			;94
		ADD	AX,0A1B0H		;ú
		MOV	DI,D_2BC0
		STOSW				;д
		MOV	D_2BC0,DI
		INC	D_2BD2			;ʾ+1
		STC
L_A289:
		POP	DI
		RET

;Ԥѡ
L_A4F0:
		CMP	AL,'['                  ;<
		JNZ	L_A512
		CMP	D_YXH,1 		;һ?
		JZ	L_A50D
		DEC	D_YXH			;к-1
		SUB	D_YX,36H		;ǰеַ-54
		JMP	L_YX1			;ʾ
L_A50D:
		JMP	L_9DC0			;岢
L_A512:
		CMP	AL,']'                  ;>
		JNZ	L_A52C
		MOV	SI,D_YX 		;ǰеַ
		CMP	BYTE PTR [SI+36H],'$'   ;βΪ'$'?
		JZ	L_A50D
		INC	D_YXH			;к+1
		ADD	D_YX,36H		;ǰеַ+54
		JMP	L_YX1			;ʾ
L_A52C:
		CMP	AL,'A'                  ;ддĸ
		JNB	L_A535
L_A530:
		TEST	D_963A,3EH		;ԭΪβ,ƴ,˫ƴ,,?
		JNZ	L_A532
L_A531:
		JMP	L_9BA6			;ֱ
L_A532:
		CMP	AL,'a'                  ;Сдĸ
		JB	L_A531
		CMP	AL,'z'
		JA	L_A531
		AND	D_2BB9,0BFH		;Ԥѡλ
		JMP	L_9C90			;תԭ뷽ʽ
L_A535:
		CMP	AL,'Z'
		JA	L_A530
		SUB	AL,'A'                  ;
		XOR	AH,AH
		SHL	AX,1			;Եַ
		ADD	AX,D_YX 		;ӵǰеַ
		MOV	SI,AX			;ѡֵַ
		LODSW				;ȡ
		MOV	WORD PTR D_959D,AX	;д뷵
;봦
L_A559:
		MOV	D_95D5,2		;=2
		MOV	D_95D6,2		;..
		MOV	D_959B,0FFH		;̬
		MOV	AX,WORD PTR D_959D	;ȡغ
		MOV	BP,AX

		TEST	D_9639,1		;뿪״̬
		JZ	L_A58F			;ת
		CMP	D_9686,0		;=0?
		JZ	L_A58F
L_A574:
		CMP	AL,0B0H 		;к?
		JB	L_A58F
		AND	AX,7F7FH		;ȥλ
		MOV	WORD PTR D_2BB1,AX	;Ϊ
		MOV	D_2BB0,2		;=2
		MOV	D_966C,1		;
		MOV	D_966D,0FFH		;־
		MOV	SI,OFFSET D_9A60	;''
		JMP	L_A5DF			;ʴ
D_9A60		DB	' ',0

L_A58F:
		CMP	D_963B,0FFH		;ֵ䷽ʽ?
		JZ	L_A591
L_A590:
		RET
L_A591:
		CALL	S_1400
		MOV	SI,OFFSET D_QWXS	;'λ'
		MOV	BL,D_QTS2
		CALL	S_A24A
		MOV	AX,BP			;ȡغ
		CALL	S_9E50			;ʾλ
		MOV	AX,BP
		MOV	AL,AH
		CALL	S_9E50
		MOV	DL,' '
		CALL	S_1403

		CMP	BYTE PTR D_959D,0B0H	;к?
		JB	L_A590

		MOV	DI,D_SW
		OR	DI,DI			;аװβ?
		JZ	L_A594
		MOV	SI,OFFSET D_SWXS	;'β'
		MOV	BL,D_QTS2
		CALL	S_A24A
		CALL	S_XSSW
L_A594:
		MOV	DI,D_PY
		OR	DI,DI			;аװƴ?
		JZ	L_A595
		MOV	SI,OFFSET D_PYXS	;'ƴ'
		MOV	BL,D_QTS2
		CALL	S_A24A
		CALL	S_XSPY
L_A595:
		MOV	DX,D_INTWB+2
		OR	DX,DX			;аװ?
		JNZ	L_A595A
		JMP	L_A596
L_A595A:
		MOV	ES,DX
		MOV	SI,OFFSET D_WBZX	;
		CMP	BYTE PTR [SI],80H
		JNB	L_A595B
		NOT	WORD PTR [SI]
		NOT	WORD PTR [SI+2]
L_A595B:
		MOV	BL,D_QTS2
		CALL	S_A24A
		MOV	BL,D_TUX2
		MOV	AX,BP			;ȡغ
		AND	AX,7F7FH
		SUB	AX,2130H
		MOV	DX,AX
		MOV	AL,94
		MUL	DL
		MOV	DL,DH
		XOR	DH,DH
		ADD	AX,DX			;
		MOV	DX,AX
		SHL	AX,1
		ADD	AX,DX			;AX*3
		ADD	AX,0BDH 		;ģַ
		MOV	SI,AX
		MOV	AL,ES:[SI]
		MOV	CL,3
		SHR	AL,CL
		OR	AL,60H
		CALL	S_1403A
		MOV	AX,ES:[SI]
		XCHG	AH,AL
		AND	AH,7
		SHL	AL,1
		SHL	AL,1
		SHL	AX,1
		SHL	AX,1
		MOV	AL,AH
		OR	AL,60H
		CALL	S_1403A
		MOV	AX,ES:[SI+1]
		XCHG	AH,AL
		AND	AH,0FH
		SHL	AL,1
		SHL	AL,1
		SHL	AX,1
		MOV	AL,AH
		OR	AL,60H
		CALL	S_1403A
		MOV	AL,ES:[SI+2]
		AND	AL,1FH
		OR	AL,60H
		CALL	S_1403A
		MOV	DL,' '
		CALL	S_1403
L_A596:
		MOV	DI,D_DB 		;аװ籨?
		MOV	CX,DI
		ADD	CX,20000
		OR	DI,DI
		JZ	L_A599
		MOV	SI,OFFSET D_DBXS
		MOV	BL,D_QTS2
		CALL	S_A24A
		MOV	DX,BP			;ȡغ
L_A597:
		ADD	DI,2
		MOV	AX,[DI]
		CMP	AX,DX
		JNZ	L_A598
		MOV	AX,DI
		SUB	AX,D_DB
		SHR	AX,1
		MOV	DL,100
		DIV	DL
		PUSH	AX
		CALL	S_9E51
		POP	AX
		MOV	AL,AH
		JMP	S_9E51
L_A598:
		CMP	DI,CX
		JBE	L_A597
L_A599:
		RET

D_WBCZ		DB	':',0
;鴦
L_A5D7:
		MOV	SI,OFFSET D_WBCZ	;':'
		MOV	D_966C,0		;ⲿ
L_A5DF:
		CALL	S_QTXS			;ʾвʾ
		MOV	SI,OFFSET D_2BB1	;
		MOV	CL,D_2BB0		;
		XOR	CH,CH
		MOV	BL,D_TUX1		;ɫ:װ
L_A5F0:
		LODSB				;ȡ
		CMP	D_966C,1		;?
		JNZ	L_A5F8
		OR	AL,80H
L_A5F8:
		CALL	S_1403A 		;ʾ
		LOOP	L_A5F0
L_A5FA:
		MOV	SI,OFFSET D_9680	;ʴַ
		MOV	AL,6			;ÿ6ֽ
		MUL	D_966C			;˴ʴʽ
		ADD	SI,AX			;ָʴ
		LODSW				;ʱ
		OR	AX,AX
		JNZ	L_A5FC
		JMP	L_9DC0
L_A5FC:
		MOV	D_2B98,AX
		LODSW				;ʱ
		MOV	D_2BA2,AX
		LODSW				;ʱ
		MOV	D_2BA0,AX
		MOV	D_2B9A,AX
		MOV	SI,D_2BA2		;ʱ
		CALL	S_A809			;SIָ´ʳ
		ADD	AX,D_2B9A		;һַ
		MOV	D_2B9E,AX		;
		MOV	AX,D_2BA2
		MOV	D_2BAD,AX
		INC	AX
		MOV	D_2BAF,AX
L_A600:
		MOV	D_2BA5,0		;ʱ:
		MOV	DI,D_2BA0		;ָ
		CALL	S_A85A			;ʱ
		CALL	S_A816			;Ϊ´βָ
L_A610:
		TEST	D_2BB9,8		;˫ƴ?
		JZ	L_A618
		CMP	D_2BD2,1		;=1?
		JNZ	L_A616
		MOV	DL,13
		CALL	S_9F30			;λʾ
		XOR	AL,AL
		JMP	SHORT L_A634		;ֱѡ
L_A616:
		CALL	S_BEEP
		CMP	D_2BD2,0
		JZ	L_A627
L_A618:
		OR	D_2BB9,10H		;־
		MOV	D_959B,0		;δ̬
		CALL	S_A694			;ʾ
		CMP	D_966D,0FFH		;־?
		JZ	L_A627
		JMP	L_9DC5
L_A627:
		RET

;ѡд
L_A634:
		MOV	D_959B,0FFH		;̬
		MOV	BL,4
		MUL	BL
		MOV	BX,AX			;ѡдڴλ
		MOV	AX,D_9648[BX]		;ȡַ
		MOV	D_9669,AX		;ѡдַ
		MOV	AX,WORD PTR D_964A[BX]	;ȡʳ
		MOV	D_966B,AL		;ѡдʳ
		MOV	D_2BD4,AH		;ִƫ
						;ԭA701
		MOV	CL,D_966B		;ѡдʳ
		MOV	D_95D5,CL		;
		XOR	CH,CH

		MOV	SI,D_9669		;ѡдָ
		MOV	DS,D_2B98		;DS=ʱ
		PUSH	CS
		POP	ES
		MOV	DI,OFFSET D_959D	;
		CMP	CS:D_2BD4,0		;жִƫ?
		JZ	L_A650
L_A640:
		LODSW				;͵һ
		OR	AX,8080H
		STOSW
		TEST	CS:D_2BB9,80H		;ִʵ?
		JZ	L_A642
		MOV	AX,[SI-2]
		STOSW
L_A642:
		MOV	AL,CS:D_2BD4
		CBW
		MOV	CS:D_2BD4,AH		;0
		ADD	SI,AX			;ƫ
		MOVSW				;͵ڶ
		TEST	CS:D_2BB9,80H		;ִʵ?		11.11
		JZ	L_A660
		MOV	AX,[SI-2]
		STOSW
		ADD	CS:D_95D5,4
		JMP	SHORT L_A660
L_A650:
		TEST	CS:D_2BB9,80H		;ִʵ?		11.11
		JZ	L_A654
		CMP	CL,4			;жִ?
		JZ	L_A640
L_A654:
		REP	MOVSB
L_A660:
		PUSH	CS
		POP	DS
		TEST	D_2BB9,8		;˫ƴ?
		JZ	L_A664
		MOV	CL,4
		MOV	DI,OFFSET D_959D
L_A662:
		OR	BYTE PTR DS:[DI],80H	;λ1		11.11
		INC	DI
		LOOP	L_A662
L_A664:
		MOV	AL,D_95D5		;			11.15
		MOV	D_95D6,AL
		AND	D_2BB9,7FH		;־ 		11.11
		RET

;ӳ:ʾ
S_A694:
		MOV	DL,16
		CALL	S_9F30			;λʾ
		MOV	DL,D_2BD2		;ʾ
		OR	DL,DL			;=0?
		JNZ	L_A6A0
	;	AND	D_2BB9,0F7H		;˫ƴλ
		RET
L_A6A0:
		XOR	DH,DH
		SUB	D_9597,DX		;ʣ
		CALL	S_A1CC			;ʾʣ
		MOV	DL,21
		CALL	S_1402
		MOV	DL,'0'                  ;
		MOV	CL,D_2BD2		;ʾ
		PUSH	DX
		JMP	SHORT L_A6BC
L_A6B8:
		PUSH	DX
		MOV	BL,D_TUX1		;ɫ:׻
		CALL	S_1403			;ʾ
L_A6BC:
		MOV	BL,D_2BD2
		SUB	BL,CL
		MOV	AL,4
		MUL	BL
		MOV	BX,AX
		MOV	SI,D_9648[BX]		;
		PUSH	CX
		MOV	CX,WORD PTR D_964A[BX]	;ʳ
		MOV	BL,D_TUX2		;ɫ:
		MOV	DS,D_2B98		;ʱ
		OR	CH,CH			;жִƫ?
		JZ	L_A6DB
		LODSB				;ȡһֽ
		OR	AL,80H
		CALL	S_1403A 		;ʾ
		LODSB				;ȡһֽ
		OR	AL,80H
		CALL	S_1403A 		;ʾ
		MOV	AL,CH
		XOR	AH,AH
		ADD	SI,AX			;ƫ
		LODSB				;ȡһֽ
		CALL	S_1403A 		;ʾ
		LODSB				;ȡһֽ
		CALL	S_1403A 		;ʾ
		JMP	SHORT L_A6E0
L_A6DB:
		TEST	CS:D_2BB9,8		;˫ƴ?
		JZ	L_A6DE
L_A6DC:
		LODSB				;ȡһֽ		3.15
		OR	AL,80H
		CALL	S_1403A 		;ʾ
		LODSB				;ȡһֽ
		OR	AL,80H
		CALL	S_1403A 		;ʾ
		SUB	CX,2
L_A6DE:
		LODSB				;ȡһֽ
		CALL	S_1403A 		;ʾ
		LOOP	L_A6DE
L_A6E0:
		MOV	DL,' '
		CALL	S_1403			;ʾո
		PUSH	CS
		POP	DS
		POP	CX
		POP	DX
		INC	DL			;+1
		CMP	DL,3AH
		JNZ	L_A6F3
		MOV	DL,'0'                  ;10='0'
L_A6F3:
		LOOP	L_A6B8
		RET

;ѡ顿
L_A73B:
		CMP	AH,82H			;ALT+'-'
		JNB	L_A760
		CMP	AH,78H			;ALT+1
		JB	L_A757
		MOV	AL,AH
		SUB	AL,77H			;ALT+1~0תΪ0~9
L_A749:
		CMP	AL,D_2BD2		;ѡΧ?
		JB	L_A752
		JMP	L_9DC0			;岢
L_A752:
		JMP	L_A634			;ѡд
L_A757:
		CALL	S_9F66			;ALT+ո
		JB	L_A749
		JMP	SHORT L_A767
L_A760:
		JZ	L_A76A			;ALT+'-'
		CMP	AH,83H			;ALT+'+'
		JZ	L_A783
L_A767:
		JMP	L_9E86			;Ǵ׼
L_A76A:
		TEST	D_2BB9,8		;˫ƴ
		JZ	L_A770
		RET
L_A770:
		CALL	S_A831			;Ϊʱָ
		MOV	DI,D_2BA2		;ʱָ
		DEC	DI
		STD
		MOV	D_2BA5,0FFH		;ʱ:
		CALL	S_A85A			;ʱ
		CALL	S_A83A			;Ϊ´βʱָ
		JMP	L_A610			;ʷʽ
L_A783:
		TEST	D_2BB9,8		;˫ƴ
		JZ	L_A790
		RET
L_A790:
		CALL	S_A851			;Ϊʱָ
		JMP	L_A600			;ʷʽ
;ѡС
L_A798:
		CMP	AL,0DH			;س?
		JNZ	L_A7C0
L_A79D:
		MOV	D_2BB0,0
		AND	D_2BB9,0EFH		;ʱ־λ
		CALL	S_9F2E			;λʾ
		MOV	D_959B,0FFH		;̬
		JMP	L_9DC5			;
L_A7C0:
		CMP	AL,'['
		JNZ	L_A7C1
		JMP	L_A76A
L_A7C1:
		CMP	AL,']'
		JZ	L_A783
		CMP	AL,'9'                  ;
		JA	L_A7E2
		CMP	AL,'0'
		JB	L_A7D9
		JNZ	L_A7D4
		MOV	AL,3AH
L_A7D4:
		AND	AL,0FH
		JMP	L_A749			;ѡ
L_A7D9:
		CMP	AL,' '
		JB	L_A79D
		JNZ	L_A7E2
		XOR	AL,AL			;ո=0
		JMP	L_A749			;ѡ
L_A7E2:
		CMP	D_963A,4
		JZ	L_A7E3
		JMP	L_9E86			;ԭ뷽ʽ
L_A7E3:
		JMP	L_9D54

;ӳ:ȡָSIʳ
S_A809:
		PUSH	DS
		MOV	DS,D_2B98
		MOV	AL,[SI]
		XOR	AH,AH
		POP	DS
		RET
;ӳ:Ϊ´βʱָ
S_A816:
		MOV	AX,D_2BAF
		DEC	AX
		MOV	D_9646,AX
		MOV	AX,D_2BAD
		MOV	D_2BAF,AX
		MOV	SI,D_9646
		CALL	S_A809
		SUB	D_2B9E,AX
		MOV	AX,D_2B9E
		MOV	D_2B9C,AX
		MOV	AX,D_2B9A
		MOV	D_2B9E,AX
		RET
;ӳ:Ϊʱָ
S_A831:
		MOV	AX,D_2B9C
		MOV	D_2B9A,AX
		MOV	AX,D_9646
		MOV	D_2BAD,AX
		RET
;ӳ:Ϊ´βʱָ
S_A83A:
		MOV	SI,D_9646
		CALL	S_A809
		ADD	AX,D_2B9C
		MOV	D_2B9E,AX
		MOV	AX,D_2B9A
		MOV	D_2B9C,AX
		MOV	AX,D_9646
		INC	AX
		MOV	D_2BAF,AX
		MOV	AX,D_2BAD
		MOV	D_9646,AX
		RET
;ӳ:Ϊʱָ
S_A851:
		MOV	AX,D_2B9E
		MOV	D_2B9A,AX
		MOV	AX,D_2BAF
		MOV	D_2BAD,AX
		RET

;ӳ:ʱ
S_A85A:
		AND	D_2BB9,0DFH		;λ
		XOR	DX,DX			;DH:ʾдܳ
		MOV	D_9597,DX		;
		MOV	D_2BD2,DH		;ʾ
		XOR	CH,CH
		MOV	SI,D_2BAD		;ǰʱָ
		MOV	BP,D_2B9A		;ǰָ
		MOV	DS,D_2B98		;ʱ
L_A87C:
		CMP	SI,DI			;?
		JNZ	L_A899
		PUSH	CS
		POP	DS
		MOV	AL,D_2BD2		;ʾ
		XOR	AH,AH
		CMP	AX,D_9597		;>ʾ?
		JBE	L_A897
		MOV	D_2BAD,SI		;浱ǰָ
		MOV	D_2B9A,BP		;浱ǰָ
L_A897:
		CLD
		RET
L_A899:
		PUSH	BP
		MOV	CL,CS:D_2BB0		;
		MOV	BX,OFFSET D_2BB1	;
L_A89D:
		MOV	AL,DS:[BP]
		CMP	AL,CS:[BX]		;м
		JNZ	L_A8BC
		INC	BP
		INC	BX
		LOOP	L_A89D
		JMP	SHORT L_A8DC
L_A8BC:
		POP	BP
L_A8BD:
		LODSB				;תһ
		XOR	AH,AH
		CMP	CS:D_2BA5,0FFH		;ʱ?
		JZ	L_A8D2
		ADD	BP,AX			;ָ
		JMP	SHORT L_A87C
L_A8D2:
		MOV	AL,[SI] 		;ָ´ʳ
		SUB	BP,AX			;ָ
		JMP	SHORT L_A87C
L_A8DC:
		POP	BP
		INC	CS:D_9597		;+1
		MOV	DL,[SI] 		;ʳ
		PUSH	BP
		CMP	CS:D_966D,0FFH
		JNZ	L_A8E0
L_A8DE:
		CMP	BYTE PTR DS:[BP],0A0H	;к?
		JA	L_A8E8
		INC	BP
		DEC	DL
		JMP	SHORT L_A8DE
L_A8E0:
		CMP	BYTE PTR DS:[BP],60H	;Сдĸ?
		JB	L_A8E8
		CMP	BYTE PTR DS:[BP],7AH
		JA	L_A8E8
		INC	BP
		DEC	DL
		JMP	SHORT L_A8E0
L_A8E8:
		MOV	AX,BP
		POP	BP
		ADD	DH,DL			;ۼʾдʳ
		ADD	DH,2			;źͿո
		TEST	CS:D_2BB9,20H		;ʾ¼λ?
		JNZ	L_A8BD
		MOV	BL,CS:D_2BD2		;ʾ
		CMP	DH,CS:D_9668		;ʾд?
		JA	L_A8FA
		CMP	BL,11			;ʾ>11
		JB	L_A8FB
L_A8FA:
		OR	BL,BL			;ʾ?
		JNZ	L_A8FC
L_A8FB:
		PUSH	AX
		MOV	AL,4
		MUL	BL			;ָ
		MOV	BX,AX
		POP	AX
		MOV	CS:D_964A[BX],DL	;鵽ʳ
		MOV	CS:D_964B[BX],0
		MOV	CS:D_9648[BX],AX	;ַ
		INC	CS:D_2BD2		;ʾ+1
		JMP	L_A8BD
L_A8FC:
		TEST	CS:D_2BB9,20H		;ʾ¼λ?
		JNZ	L_A8FD
		MOV	CS:D_2BAD,SI		;浱ǰʱָ
		MOV	CS:D_2B9A,BP		;浱ǰָ7
		OR	CS:D_2BB9,20H		;ʾ¼λ
L_A8FD:
		JMP	L_A8BD

;ӳ:˫ƴʱ
;	SI-ַ,BP-ʳ,DH-ۼƳ,DL-ƫ
S_A900:
		MOV	AX,WORD PTR D_2BB1
		MOV	WORD PTR D_2CC1,AX
		MOV	AX,WORD PTR D_2BB1+2
		MOV	WORD PTR D_2CC1+2,AX
S_A9000:
		MOV	DS,D_SPCZ		;˫ƴʱ
		MOV	CS:D_2B98,DS

		MOV	SI,DS:[4]		;չʿ
L_A901:
		CMP	SI,DS:[6]		;:չʿβ?
		JZ	L_A940			;:ʿ
		XOR	BP,BP
L_A903:
		CMP	BYTE PTR DS:[BP+SI],',' ;дβ?
		JZ	L_A910
		INC	BP
		JMP	SHORT L_A903
L_A910:
		CMP	BP,4			;ִ?
		JNZ	L_A920
		MOV	DI,SI
		LODSW				;ȡһ
		CALL	S_A9A0			;ȡ˫ƴ
		CMP	AX,WORD PTR CS:D_2CC1	;?
		LODSW
		JNZ	L_A919
		CALL	S_A9A0			;ȡ˫ƴ
		CMP	AL,CS:D_2CC1+2		;е?
		JNZ	L_A919
		CMP	CS:D_2CC1+3,'?'
		JZ	L_A912
		CMP	AH,CS:D_2CC1+3		;еļ?
		JNZ	L_A919
L_A912:
		CALL	S_A990			;
L_A919:
		INC	SI
		JMP	SHORT L_A901
L_A920:
		CMP	BP,6			;ִ?
		JNZ	L_A930
		CALL	S_SP6			;ִ
		JMP	SHORT L_A919
L_A930:
		CALL	S_SP8			;ִ
		JMP	SHORT L_A919

L_A940:
		MOV	BP,4			;ִ
		MOV	SI,16
L_A941:
		XOR	DL,DL
		CMP	SI,DS:[0]		;ִʿʼ?
		JZ	L_A950
		MOV	DI,SI
		LODSW				;ȡһ
		CALL	S_A9A0			;ȡ˫ƴ
		CMP	AX,WORD PTR CS:D_2CC1	;?
		JZ	L_A945
L_A942:
		LODSW
		TEST	AX,8080H		;һ?
		JNZ	L_A942
L_A943:
		SUB	SI,2			;ָһ
		JMP	SHORT L_A941
L_A944:
		ADD	DL,2			;ƫ
L_A945:
		LODSW				;ȡһ
		TEST	AX,8080H		;һ?
		JZ	L_A943
		CALL	S_A9A0			;ȡ˫ƴ
		CMP	AL,CS:D_2CC1+2		;е?
		JNZ	L_A944
		CMP	CS:D_2CC1+3,'?'
		JZ	L_A946
		CMP	AH,CS:D_2CC1+3		;е?
		JNZ	L_A944
L_A946:
		CALL	S_A990			;
		JMP	SHORT L_A944
L_A950:
		CMP	CS:D_2CC1+3,'`'         ;ļ`ִֻ
		JNZ	L_A960
		MOV	BP,6			;ִ
L_A951:
		CMP	SI,DS:[2]		;ִʿʼַ?
		JZ	L_A970
		CALL	S_SP6
		JMP	SHORT L_A951
L_A960:
		CMP	SI,DS:[4]		;ִʽ?
		JZ	L_A970
		CALL	S_SP8
		INC	SI
		JMP	SHORT L_A960
L_A970:
		PUSH	CS			;
		POP	DS
		RET
;ӳ:ִ
S_SP6:
		LODSW
		CALL	S_A9B0			;ȡ˫ƴĸ
		CMP	AL,CS:D_2CC1
		JZ	L_SP61
		ADD	SI,4
		RET
L_SP61:
		LODSW
		CALL	S_A9B0			;ȡ˫ƴĸ
		CMP	AL,CS:D_2CC1+1
		LODSW
		JNZ	L_SP62
		CALL	S_A9B0			;ȡ˫ƴĸ
		CMP	AL,CS:D_2CC1+2
		JNZ	L_SP62
		CALL	S_A990			;
L_SP62:
		RET
;ӳ:Ҷִ
S_SP8:
		LODSW				;һ
		CALL	S_A9B0			;ȡ˫ƴĸ
		CMP	AL,CS:D_2CC1
		JZ	L_SP82
;ӳ:Ҵβ ָ򶺺
S_A980:
		MOV	BP,6
L_A981:
		CMP	BYTE PTR [SI],','       ;дβ?
		JZ	L_A981A
		INC	BP
		INC	SI
		JMP	SHORT L_A981
L_A981A:
		RET
L_SP82:
		LODSW				;ڶ
		CALL	S_A9B0			;ȡ˫ƴĸ
		CMP	AL,CS:D_2CC1+1
		JNZ	S_A980
		LODSW				;
		CALL	S_A9B0			;ȡ˫ƴĸ
		CMP	AL,CS:D_2CC1+2
		JNZ	S_A980
		CALL	S_A980			;Ҵβ
		MOV	AX,[SI-2]		;ȡĩ
		CALL	S_A9B0			;ȡ˫ƴĸ
		CMP	AL,CS:D_2CC1+3
		JNZ	L_SP83
		CALL	S_A990			;
L_SP83:
		RET
;ӳ:鵽ʵַ
S_A990:
		INC	CS:D_9597		;+1	11.16-
		MOV	CX,BP			;ʳ
		ADD	DH,CL			;ۼƴʳ
		ADD	DH,2			;źͿո
		CMP	DH,CS:D_9668		;?
		JA	L_A993			;		11.16
		MOV	AL,CS:D_2BD2		;ȡʾ
		CMP	AL,11
		JAE	L_A993
		INC	CS:D_2BD2		;ʾ+1
		MOV	AH,4
		MUL	AH			;		11.16
		MOV	BX,AX			;ָ
		MOV	CS:D_964A[BX],CL	;鵽ʳ
		MOV	CS:D_964B[BX],DL	;ִƫ
		CMP	BP,4
		JZ	L_A992
		MOV	AX,SI			;һʵַ
		SUB	AX,BP			;ʳ
		MOV	CS:D_9648[BX],AX	;鵽ʵַ
		RET
L_A992:
		MOV	CS:D_9648[BX],DI	;鵽ʵַ
L_A993:
		RET
;ӳ:ȡ˫ƴ
S_A9A0:
		CALL	S_A9C0			;ȡ	A960
S_A9A1:
		AND	AX,3FFH 		;ȡʮλ	A961
		PUSH	CX
		MOV	CL,3
		SHL	AX,CL
		SHR	AL,CL			;AHڶ,ALһ
		POP	CX
		ADD	AX,6060H		;ΪСдĸ
		RET
;ӳ:ȡƴ
S_A9B0:
		CALL	S_A9C0			;ȡ	A970
		AND	AL,1FH			;ȡλ
		ADD	AL,60H			;ΪСдĸ
		RET
;ӳ:ȡ
S_A9B8:
		CALL	S_A9C0			;ȡ
		MOV	AL,AH
		AND	AL,7FH
		SHR	AL,1
		SHR	AL,1
		OR	AL,60H
		RET
;ӳ:ȡƴеı			      A990
S_A9C0:
		PUSH	BX
		AND	AX,7F7FH
		SUB	AX,2130H
		MOV	BL,AH
		MOV	BH,94
		MUL	BH
		XOR	BH,BH
		ADD	AX,BX
		SHL	AX,1
		ADD	AX,CS:D_PY
		MOV	BX,AX
		MOV	AX,CS:[BX]
		POP	BX
		RET

;ӳ:ʾƴ
S_XSPY:
		MOV	AX,BP
		PUSH	AX
		CALL	S_A9A0			;ȡǰ
		CALL	S_XSAX
		POP	AX
		CALL	S_A9B8
		MOV	AH,' '
S_XSAX:
		MOV	BL,D_TUX2
		PUSH	AX
		CALL	S_1403A
		POP	AX
		MOV	AL,AH
		CALL	S_1403A
		RET

;ӳ:ʾβ
S_XSSW:
		MOV	AX,BP
		SUB	AX,0A1B0H
		MOV	DL,AH
		MOV	DH,94
		MUL	DH
		XOR	DH,DH
		ADD	AX,DX
		SHL	AX,1
		ADD	AX,CS:D_SW
		MOV	BX,AX
		MOV	AX,CS:[BX]
		CALL	S_A9A1
		CALL	S_XSAX
		MOV	DL,' '
		CALL	S_1403
		RET

S_JRCL		ENDP

;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
A_BUF		DW	0			;ûָ
D_959D		EQU	$			;(256)
D_BUF		EQU	$+256			;û(512ֽ)

;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
		ORG	$+64
L_S60:
		CMP	K_SW,'Y'                ;װβ?
		JNZ	L_S70
		MOV	DX,OFFSET F_SWMB	;'SWMB', 0
		CALL	S_HF			;дļ
		JB	L_S62
		CALL	S_READ			;
		JB	L_S62
		OR	CX,CX
		JZ	L_S62
		MOV	DX,CS:[BP]		;''
		MOV	WORD PTR D_SWXS,DX
		MOV	DX,CS:[BP+2]		;'β'
		MOV	WORD PTR D_SWXS+2,DX
		MOV	D_SW,BP 		;β׵ַ
		ADD	D_SW,4
		ADD	BP,CX			;β
		MOV	D_SW+2,BP		;ββַ
		JMP	SHORT L_S70
L_S62:
		MOV	K_SW,'N'
		MOV	SI,OFFSET F_SWMB	;'SWMB', 0
		CALL	S_NOFOUND
L_S70:
		CMP	K_PY,'Y'                ;װƴ?
		JNZ	L_S80
		MOV	DX,OFFSET F_PYMB	;'PYMB', 0
		CALL	S_HF			;дļ
		JB	L_S72
		CALL	S_READ			;
		JB	L_S72
		OR	CX,CX
		JZ	L_S72
		MOV	D_PY,BP 		;ƴ׵ַ
		ADD	D_PY,11*26*2
		ADD	BP,CX			;ƴ
		MOV	D_PY+2,BP		;ƴβַ
		JMP	SHORT L_S80
L_S72:
		MOV	K_PY,'N'
		MOV	SI,OFFSET F_PYMB	;'PYMB', 0
		CALL	S_NOFOUND
L_S80:
		CMP	K_DB,'Y'                ;װ籨?
		JNZ	L_S90
		MOV	DX,OFFSET F_DBMB	;'DBMB', 0
		CALL	S_HF			;дļ
		JB	L_S82
		CALL	S_READ			;
		JB	L_S82
		OR	CX,CX
		JZ	L_S82
		MOV	D_DB,BP 		;籨׵ַ
		ADD	BP,CX			;ӵ籨
		JMP	SHORT L_S90
L_S82:
		MOV	K_DB,'N'
		MOV	SI,OFFSET F_DBMB	;'DBMB', 0
		CALL	S_NOFOUND
L_S90:
		MOV	DX,OFFSET F_YX		;'YX0.DAT'
		CALL	S_HF			;дļ
		JB	L_S92
		CALL	S_READ			;
		JB	L_S92
		OR	CX,CX
		JZ	L_S92
		MOV	D_YX,DX
		ADD	BP,CX
		JMP	SHORT L_S95
L_S92:
		MOV	SI,OFFSET F_YX
		CALL	S_NOFOUND
L_S95:
		MOV	AX,BP
		MOV	CL,4
		SHR	AX,CL
		INC	AX
		MOV	BP,CS
		ADD	BP,AX

		MOV	AL,K_SPKZ		;˫ƴС
		CMP	AL,'1'
		JB	L_S100
		CMP	AL,'9'
		JA	L_S100
		AND	AL,0FH
		CBW
		MOV	DX,400H 		;=1K
		MUL	DX
		MOV	DS:[0FCH],AX		;˫ƴԤ

		MOV	DX,OFFSET F_SPCZ
		CALL	S_HF			;дļ
		JB	L_S98
		MOV	BX,AX
		MOV	DS,BP
		MOV	CS:D_SPCZ,BP
		MOV	DX,0
		MOV	CX,-1
		MOV	AH,3FH			;˫ƴļ
		INT	21H
		MOV	DI,AX
		MOV	WORD PTR DS:[DI],0	;β0
		MOV	AX,CS:[0FCH]
		ADD	AX,DS:[6]		;˫ƴ
		MOV	DS:[8],AX		;˫ƴβ
		MOV	CL,4
		SHR	AX,CL
		INC	AX
		MOV	DX,AX			;
		MOV	AH,3EH
		INT	21H
		CMP	BYTE PTR DS:[0FH],0FFH	;SPCZ.DAT־?
		JNZ	L_S98
		ADD	BP,DX			;
		JMP	SHORT L_S100
L_S98:
		MOV	SI,OFFSET F_SPCZ
		CALL	S_NOFOUND
L_S100:
		MOV	DX,BP
		MOV	BP,CS
		MOV	DS,BP
		SUB	DX,BP
		ADD	DX,3
		MOV	D_LEN,DX		;פ()

		MOV	AX,CS
		CMP	AX,0A000H		;LH?
		JA	L_S110
		CMP	D_RAM,'N'               ;פڴ
		JZ	L_S110
		CALL	S_GETUMB		;UMB
		JZ	L_S120
L_S110:
		MOV	ES,DS:[2CH]
		MOV	AH,49H			;廷
		INT	21H
		CALL	S_SETINT
		JMP	L_S140			;פ
L_S120:
		MOV	AX,D_UMB
		OR	AX,AX
		JZ	L_S110
		DEC	AX
		MOV	ES,AX
		MOV	DI,8
		MOV	SI,OFFSET D_NAME
		MOV	CX,5
		REP	MOVSB			;UMBļƿд뱾ģ

		MOV	DX,D_UMB		;
		MOV	ES,DX
		XOR	SI,SI
		MOV	DI,SI
		MOV	BP,D_LEN
		CMP	BP,1000H
		JB	L_S130
		SUB	BP,1000H
		MOV	CX,8000H
		REP	MOVSB			;ģ鵽UMB
		MOV	CX,8000H
		REP	MOVSB			;ģ鵽UMB
		ADD	DX,1000H
		MOV	ES,DX
		MOV	DX,DS
		ADD	DX,1000H
		MOV	DS,DX
L_S130:
		MOV	AX,16
		MUL	BP
		MOV	CX,AX
		REP	MOVSB			;ģ鵽UMB
		MOV	DS,CS:D_UMB

		CALL	S_SETINT

		PUSH	CS
		POP	DS
		MOV	ES,DS:[2CH]
		MOV	AH,49H			;廷
		INT	21H
		PUSH	CS
		POP	ES
		MOV	AH,49H			;屾ģ
		INT	21H

		MOV	AH,50H			;PSP
		MOV	BX,D_UMB
		INT	21H
L_S140:
		MOV	DX,D_LEN		;ģ鳤()
		MOV	AX,3100H		;פ
		INT	21H

D_XMS		DD	0			;XMSַ
D_NCFP		DW	0			;ԭڴ
D_UMB0		DW	0			;ԭUMB״̬
D_UMB		DW	0			;UMB
D_LEN		DW	0			;ģ鳤()
D_RAM		DB	0			;='N':פڴ

;ӳ:ȡUMB
S_GETUMB	PROC	NEAR
		CALL	S_GETXMS		;ȡXMSַ
		JNZ	L_GU2
		MOV	AH,10H			;UMB
		CALL	D_XMS			;XMS
		CMP	AX,1			;=1:ɹ,BX=
		JZ	L_GU1
		CALL	S_UMB			;UMBBX
		CMP	AL,AL			;ZF=1
		RET
L_GU1:
		MOV	D_UMB,BX		;ȡUMB
L_GU2:
		RET
S_GETUMB	ENDP

S_UMB		PROC	NEAR
		MOV	AX,3000H		;ȡDOS汾
		INT	21H
		CMP	AL,5			;>5.0
		JB	L_UMB3
		MOV	AX,5800H		;ȡڴAX
		INT	21H
		MOV	D_NCFP,AX
		MOV	AX,5802H		;ȡUMB״̬AL
		INT	21H
		CBW
		MOV	D_UMB0,AX

		MOV	AX,5803H		;UMB
		MOV	BX,1			;=1
		INT	21H
		JC	L_UMB3
		MOV	AX,5801H		;ڴ
		MOV	BX,41H			;ʺϿ
		INT	21H
		JC	L_UMB2
		MOV	AH,48H			;ڴ
		MOV	BX,D_LEN
		INT	21H
		JC	L_UMB1
		MOV	D_UMB,AX		;
L_UMB1:
		MOV	AX,5801H		;ָڴ
		MOV	BX,D_NCFP
		INT	21H
L_UMB2:
		MOV	BX,D_UMB0
		MOV	AX,5803H		;ָUMB״̬
		INT	21H
L_UMB3:
		RET
S_UMB		ENDP

;ӳ:ȡXMSַ ->D_XMS
S_GETXMS	PROC	NEAR
		MOV	AX,4300H		;ȡXMSװ״̬
		INT	2FH
		CMP	AL,80H			;=80H:Ѱװ
		JNZ	L_GX1
		MOV	AX,4310H		;ȡXMSַ
		INT	2FH
		MOV	WORD PTR D_XMS,BX	;
		MOV	WORD PTR D_XMS+2,ES
		CMP	AL,AL			;ZF=1
L_GX1:
		RET
S_GETXMS	ENDP

S_SETINT	PROC	NEAR
		MOV	DX,OFFSET INT_16
		MOV	AX,2516H		;ж16H
		INT	21H
		MOV	DX,OFFSET INT_9
		MOV	AX,2509H		;ж9
		INT	21H

		MOV	AX,D_SPCZ
		OR	AX,AX
		JZ	L_SI2
		MOV	BX,CS
		SUB	AX,BX
		MOV	DX,DS
		ADD	AX,DX
		MOV	D_SPCZ,AX
L_SI2:
		RET
S_SETINT	ENDP

;ӳ:дļ DX=ļ DX=ļ
S_HF		PROC	NEAR
		MOV	DI,A_S			;·дַ
		OR	DI,DI			;?
		JZ	L_HF1
		MOV	CX,10
		MOV	SI,DX			;ļ
		CALL	S_MOVE			;
		MOV	DX,OFFSET F_S		;ļ
L_HF1:
		MOV	AX,3D00H		;ļ
		INT	21H
		RET
S_MOVE:
		LODSB
		STOSB
		OR	AL,AL
		JNZ	S_MOVE
		RET
S_HF		ENDP

;ӳ:ļ DX=ļ,BP=ַ CX=
S_READ		PROC	NEAR
		MOV	BX,AX
		MOV	DX,BP			;ַ
		MOV	CX,-1
		MOV	AH,3FH
		INT	21H
		JB	L_RD1
		MOV	CX,AX			;
		MOV	AH,3EH
		INT	21H
		CLC
L_RD1:
		RET
S_READ		ENDP

NOFOUND 	DB	13,10,'NOT FOUND FILE ',7,'$'
;ӳ:ʾδҵ SI:ļ
S_NOFOUND	PROC	NEAR
		PUSH	CS			;			3.15
		POP	DS
		MOV	DX,OFFSET NOFOUND
		MOV	AH,9
		INT	21H
		MOV	AH,2
L_NF1:
		LODSB
		OR	AL,AL
		JZ	L_NF2
		MOV	DL,AL
		INT	21H
		JMP	SHORT L_NF1
L_NF2:
		RET
S_NOFOUND	ENDP

D_NAME		DB	'CKBD',0                ;ģ
F_S		DB	40 DUP(0)		;Դļ
A_S		DW	0			;дַ
MSG		DB	'2.13L ϵͳģ ',DATE,13,10,'$'

;****************************************************************************
;ģ鿪ʼִС
BEGIN:
		MOV	SP,0D0H

		MOV	SI,80H
		LODSB
		OR	AL,AL
		JZ	L_S10
L_S1:
		LODSB
		CMP	AL,0DH
		JZ	L_S10
		CMP	AL,'/'
		JNZ	L_S1
		LODSB
		CMP	AL,'?'
		JNZ	L_S2
		MOV	DX,OFFSET MSG
		MOV	AH,9
		INT	21H
		INT	20H
L_S2:
		AND	AL,5FH
		CMP	AL,'N'                  ;/N:פڴ
		JNZ	L_S1
		MOV	D_RAM,AL
		JMP	SHORT L_S1
L_S10:
		MOV	CX,-1
		MOV	AH,5			;̻0FFFFH
		INT	16H
		OR	AL,AL			;֧?
		JNZ	L_S14
		MOV	CX,15
L_S12:
		MOV	AH,10H			;ȡ
		INT	16H
		CMP	AX,-1			;Ƿд?
		JZ	L_S15
		LOOP	L_S12
L_S14:
		MOV	BYTE PTR INT16_AH0,0	;ϼ,ֻAH=0
		MOV	BYTE PTR INT16_AH1,1
L_S15:
		MOV	AH,2FH			;ȡģ
		INT	16H
		CMP	AX,44H			;CKBDפ?		2.10
		JNZ	L_S20
		MOV	DX,OFFSET ALREADY
L_ERR:
		MOV	AH,9
		INT	21H
L_ERR1:
		MOV	AX,4C01H
		INT	21H
L_S20:
		MOV	AX,40H
		MOV	ES,AX
		MOV	AX,ES:[82H]		;̻βַ
		SUB	AX,ES:[80H]		;-=С
		SHR	AX,1
		MOV	D_KBDBUF,AX
		MOV	AX,3516H		;ȡж16H
		INT	21H
		MOV	WORD PTR D_INT16,BX	;
		MOV	WORD PTR D_INT16+2,ES
		MOV	AX,3509H		;;ȡж9
		INT	21H
		MOV	WORD PTR D_INT9,BX	;
		MOV	WORD PTR D_INT9+2,ES

		MOV	DS,DS:[2CH]		;
		XOR	SI,SI
L_S30:
		CMP	WORD PTR DS:[SI],0	;һβ?
		JZ	L_S32
		INC	SI
		JMP	SHORT L_S30
L_S32:
		ADD	SI,4
		MOV	DI,OFFSET F_S		;·Դļ
		PUSH	CS
		POP	ES
		CMP	BYTE PTR [SI+1],':'     ;̷?
		JZ	L_S33
		MOV	AH,19H			;ȡǰ
		INT	21H
		INC	AL
		MOV	DL,AL
		OR	AL,40H
		STOSB				;д̷
		MOV	AL,':'
		STOSB
		CMP	BYTE PTR [SI],'\'       ;о·?
		JZ	L_S33
		MOV	AL,'\'
		STOSB
		JMP	SHORT L_S34
L_S33:
		CMP	BYTE PTR [SI+2],'\'     ;о·?
		JZ	L_S35
		LODSW				;̷\
		SUB	AL,40H
		MOV	DL,AL			;̷
		STOSW
L_S34:
		PUSH	SI
		MOV	SI,DI
		MOV	AH,47H			;ȡǰ·
		INT	21H
		POP	SI
L_S35:
		CALL	S_MOVE			;
		PUSH	CS
		POP	DS
L_S37:
		CMP	BYTE PTR [DI-1],'\'
		JZ	L_S38
		DEC	DI
		JMP	SHORT L_S37
L_S38:
		MOV	A_S,DI			;ļдַ

		MOV	SI,OFFSET F_S
		MOV	DI,D_PATH
		MOV	WORD PTR [DI-2],'  '
L_S40:
		CMP	SI,A_S
		JZ	L_S41
		MOVSB				;͵װ·
		JMP	SHORT L_S40
L_S41:
		MOV	BYTE PTR [DI-1],0

		MOV	DX,OFFSET F_INI
		CALL	S_HF			;дļ
		JNB	L_S42
		MOV	SI,OFFSET F_INI
		CALL	S_NOFOUND
		JMP	L_ERR1
L_S42:
		MOV	BX,AX
		MOV	DX,OFFSET BUF
		MOV	SI,DX
		MOV	CX,-1
		MOV	AH,3FH			;ļ
		INT	21H
		MOV	AH,3EH			;رļ
		INT	21H
		MOV	DI,OFFSET K_DISP	;
		MOV	CX,32
L_S44:
		CALL	S_GETB			;ȡһ
		STOSB
		LOOP	L_S44
		MOV	SI,OFFSET K_DISP
		MOV	DI,0F4H
		MOVSW
		MOVSW

		MOV	AX,6F1H
		MOV	SI,OFFSET K_AF1
		CMP	K_FCC,'Y'               ;³Ǽ?
		JZ	L_S46
		MOV	SI,OFFSET D_JHJB	;
L_S46:
		MOV	[SI],AL
		INC	SI
		INC	AX
		DEC	AH
		JNZ	L_S46
L_S50:
		MOV	D_9680,CS

		MOV	BP,OFFSET D_BUF+768	;768ֽ
		JMP	L_S60

;ӳ:ȡINIһ->AL
S_GETB		PROC	NEAR
		PUSH	CX
		LODSB				;ȡһֽ
		CALL	S_TO10			;תʮ
		CMP	BYTE PTR [SI],' '       ;һֽΪո?
		JZ	L_GETB1
		MOV	CL,4
		SHL	AL,CL			;*16
		MOV	CL,AL
		LODSB				;ȡһֽ
		CALL	S_TO10			;תʮ
		ADD	AL,CL			;+
L_GETB1:
		PUSH	AX
L_GETB2:
		LODSB
		CMP	AL,0AH
		JNZ	L_GETB2
		POP	AX
		POP	CX
		RET
S_TO10: ;תʮ
		CMP	AL,'9'                  ;?
		JBE	L_T1
		AND	AL,5FH			;Сдд
L_T1:
		SUB	AL,'0'
		CMP	AL,9
		JBE	L_T2
		SUB	AL,7
L_T2:
		RET
S_GETB		ENDP

ALREADY 	DB	'CKBD IS ALREADY!',7,13,10,'$'

BUF		EQU	$

SEG_A		ENDS
		END	START
