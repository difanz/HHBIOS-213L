;	LSETUP.ASM
;	1999.2.13, 11.14
DATE	EQU	"1999.11.29"

SEG_A		SEGMENT
		ASSUME	CS:SEG_A, DS:SEG_A

		ORG	100H
START:		JMP	BEGIN

D_0		DW	204H			;˵λ
C_0		DW	1EH			;      ɫ
A_0		DW	0F16H			;      С

D_9		DW	201H			;ܼ˵λ
C_9		DW	6FH			;	   ɫ
A_9		DW	101DH			;	   С

D_9A		DW	21FH			;ܼλ
C_9A		DW	6FH			;	 ɫ
A_9A		DW	1030H			;	 С

D_10		DW	420H			;ӡ˵λ
C_10		DW	2FH			;	   ɫ
A_10		DW	0E14H			;	   С

D_14		DW	20H			;ʾ˵λ
C_14		DW	5FH			;	     ɫ
A_14		DW	151AH			;	     С

D_15		DW	41CH			;޸213L.BATλ
C_15		DW	34H			;		 ɫ
A_15		DW	0A1AH			;		 С

D_PR		DW	438H			;PRѡ񴰿λ
C_PR		DW	0FF6FH			;	   ɫ
A_PR		DW	0C17H			;	   С

D_PRNT		DW	438H			;PRNTѡ񴰿λ
C_PRNT		DW	0FF6FH			;	     ɫ
A_PRNT		DW	0C13H			;	     С

D_HELP		DW	1504H			;λ
C_HELP		DW	30H
A_HELP		DW	448H			;	 С

D_IN		DW	1222H			;봰λ
C_IN		DW	0FF71H			;	 ɫ
A_IN		DW	32AH			;	 С

D_XTPZ		DB	'2.13L ϵͳ',0
F_INI		DB	'213L.INI',0
D_W		DB	0			;='W':޸ĵǰĿ¼µINIļ
NOINI		DB	'ϵͳļ 213L.INI δҵ!',7,13,10,'$'
MSG		DB	'2.13L ϵͳó ',DATE,13,10
		DB	'ʽ: LSETUP [/W][/?]',13,10
		DB	': /W - ǰĿ¼ϵͳļ213L.INI',13,10
		DB	'           ȱʡ:Ŀ¼ļ',13,10
		DB	'      /? - ʾ˵',13,10,'$'

D_210A		DB	4, 0, 0, 0

D_SPCZ		DB	'˫ƴչС(0~9):',0,0
D_XTKG		DB	'1-,2-SHIFT,3-SCROLL LOCK:',0,0

D_MODE		DB	0			;ʾʽ
D_ZJXP		DB	0			;=1ֱд
D_CKBD		DW	0			;ģ
D_HAN		DW	0			;ļ
D_SELE		DB	0			;˵Ĭѡ
D_DX		DW	0			;ļ
D_CX		DW	0			;    
D_SX		DW	0			;    

D_B1		DB	'ͻ',0
D_B2		DB	' ',0
D_B3		DB	'ͼ',0

;˵
D_S1		DB	'ô̲˳    ',0
D_S2		DB	'        ',0
D_S3		DB	'Ƿ³Ǽ  Y ',0
D_S4		DB	'װƴ  Y ',0
D_S5		DB	'װβ  N ',0
D_S6		DB	'װ籨  N ',0
D_S7		DB	'˫ƴչ  1K',0
D_S8		DB	'ܿSHIFT:  ',0
D_S9		DB	'ѡܼ    ',0
D_S10		DB	'ʾģ    ',0
D_S11		DB	'޸ļ213L.BAT  ',0,0

D_SB1		DB	'ϵͳõκ޸,̲ſϵͳʱЧ!',0,0
D_SB2		DB	'ѡȡ޸. ʱ<ESC>Ҳ.',0,0
D_SB3		DB	'101̹Ϸ  λ(Insert)    β(Home)  ƴ(PageUp)',0
		DB	'6³ǵķʽ  ˫ƴ(Delete)  ȫ/(End)  Ӣ(PageDn)',0,0
D_SB4		DB	'ֱӻسѡ Y-װ  N-װ.',0
		DB	'  װƴ,˫ƴҲʧЧ,뷽ȡƴ˫ƴ.',0,0
D_SB5		DB	'ֱӻسѡ Y-װ  N-װ.',0
		DB	'  װβ,뷽ȡβ.',0,0
D_SB6		DB	'ֱӻسѡ Y-װ  N-װ.',0
		DB	'  װ籨,뷽ȡ籨.',0,0
D_SB7		DB	'ܿѡ˫ƴչС,Χ0-9,λΪKֽ.',0
		DB	'  װ˫ƴ,ѡ˫ƴչΪ0.',0,0
D_SB8		DB	'ѡϵͳܼʹSHIFTԼSCROLL LOCK.',0,0
D_SB9		DB	'ѡ˹,ϵͳܼļλ.',0
		DB	'  ִд˹ܽʾ˵һѡ.',0,0
D_SB10		DB	'ܿʾģһЩҪ.',0
		DB	'  Լʾɫ.',0,0
D_SB11		DB	'޸ıϵͳļ213L.BAT',0
		DB	'  ѡģ顢ģ顢ӡ.',0,0

D_SBZ1		DW	OFFSET D_SB1
D_SBZ2		DW	OFFSET D_SB2
D_SBZ3		DW	OFFSET D_SB3
D_SBZ4		DW	OFFSET D_SB4
D_SBZ5		DW	OFFSET D_SB5
D_SBZ6		DW	OFFSET D_SB6
D_SBZ7		DW	OFFSET D_SB7
D_SBZ8		DW	OFFSET D_SB8
D_DBZ9		DW	OFFSET D_SB9
D_SBZ10 	DW	OFFSET D_SB10
D_SBZ11 	DW	OFFSET D_SB11

C_DISP		DB	02H	;ʾ1
C_DISP2 	DB	01H	;	 2
C_DISP3 	DB	05H	;	 3
C_DISP4 	DB	39H	;	 4
		DB	00
C_TUXN1 	DB	1EH	;ʾ1
C_TUXN2 	DB	1AH	;	   2
C_TUXB1 	DB	4EH	;ʾб1ɫ
C_TUXB2 	DB	4AH	;	   2
		DB	00
C_SHIFT 	DB	01H	;=1,=2
C_KEY		DB	64H	;ʾ CTRL+F7
		DB	68H	;λ	ALT+F1
		DB	69H	;β	ALT+F2
		DB	6AH	;ƴ	ALT+F3
		DB	6BH	;˫ƴ	ALT+F4
		DB	66H	;/ȡCTRL+F9
		DB	6DH	;ASCII	ALT+F6
		DB	6CH	;	ALT+F5
		DB	71H	;籨	ALT+F10
		DB	86H	;Ԥѡ	F12
		DB	85H	;	F11
		DB	62H	;ϵͳ	CTRL+F5
		DB	70H	;˫ƴ	ALT+F9
		DB	67H	;ôӡ	CTRL+F10
		DB	00	;
		DB	00	;
C_FCC		DB	59H	;³Ǽ	(YN)
C_SPKZ		DB	31H	;˫ƴչ (1-9)
C_PY		DB	59H	;װƴ	(YN)
C_SW		DB	4EH	;װβ	(YN)
C_DB		DB	4EH	;װ籨	(YN)

;****************************************************************************
BEGIN:
		MOV	SI,80H
		LODSB
		OR	AL,AL
		JZ	L_10
L_1:
		LODSB
		CMP	AL,' '
		JZ	L_1
		CMP	AL,0DH
		JZ	L_10
		CMP	AL,'/'
		JNZ	L_1
		LODSB
		CMP	AL,'?'
		JNZ	L_2
		MOV	DX,OFFSET MSG
		MOV	AH,9
		INT	21H
		INT	20H
L_2:
		AND	AL,5FH
		CMP	AL,'W'                  ;ǰĿ¼INI
		JNZ	L_1
		MOV	D_W,AL
		JMP	SHORT L_1
L_10:
		XOR	BP,BP
		MOV	AH,2FH			;ȡģ
		INT	16H
		OR	BP,BP
		JNZ	L_12
		MOV	AX,0E07H
		INT	10H
		INT	20H
L_12:
		MOV	D_CKBD,BP
		MOV	ES,BP
		MOV	AL,ES:[100H]
		MOV	D_MODE,AL
		MOV	AL,ES:[102H]
		MOV	D_ZJXP,AL

		CMP	D_W,'W'                 ;޸ĵǰĿ¼ļ
		JNZ	L_20
		MOV	DX,OFFSET F_INI
		JMP	L_30
L_20:
		MOV	DS,DS:[2CH]		;
		XOR	SI,SI
L_21:
		CMP	WORD PTR DS:[SI],0	;һβ?
		JZ	L_22
		INC	SI
		JMP	SHORT L_21
L_22:
		ADD	SI,4
		MOV	DI,OFFSET D_FILE	;·Դļ
		PUSH	CS
		POP	ES
		CALL	S_MOVE
		PUSH	CS
		POP	DS
L_24:
		CMP	BYTE PTR [DI-1],'\'
		JZ	L_25
		CMP	BYTE PTR [DI-1],':'
		JZ	L_25
		DEC	DI
		JMP	SHORT L_24
L_25:
		MOV	SI,OFFSET F_INI
		CALL	S_MOVE
		MOV	DX,OFFSET D_FILE	;'213L.INI'
L_30:
		MOV	D_DX,DX 		;
		MOV	AX,4300H		;ȡļ
		INT	21H
		JB	L_40
		MOV	D_SX,CX 		;
		MOV	CX,20H
		MOV	AX,4301H		;
		INT	21H

		MOV	AX,3D02H		;ļ
		INT	21H
		JB	L_40
		MOV	D_HAN,AX		;ļ
		MOV	BX,AX
		MOV	DX,OFFSET B_BUF+100H	;ַ
		MOV	CX,-1			;
		MOV	AH,3FH			;
		INT	21H
		JNB	SHORT L_50
L_40:
		MOV	DX,OFFSET NOINI 	;'NOT FOUND FILE'
		MOV	AH,9
		INT	21H
		MOV	AL,-1
		JMP	L_END
L_50:
		MOV	D_CX,AX 		;ļ
L_S0:
		MOV	SI,OFFSET B_BUF+100H
		MOV	DI,OFFSET C_DISP	;
		MOV	CX,32
L_S0A:
		CALL	S_GETB			;ȡһ
		STOSB
		LOOP	L_S0A

		CALL	S_CLS			;
L_S00:
;д˵״̬
		MOV	AL,C_FCC		;³Ǽ
		MOV	D_S3+16,AL
		MOV	AL,C_PY 		;ƴ
		MOV	D_S4+16,AL
		MOV	AL,C_SW 		;β
		MOV	D_S5+16,AL
		MOV	AL,C_DB 		;籨
		MOV	D_S6+16,AL
		MOV	AL,C_SPKZ		;˫ƴչС
		MOV	D_S7+16,AL
		MOV	AX,''
		CMP	C_SHIFT,1		;SHIFT
		JZ	L_S01
		MOV	AX,''
		CMP	C_SHIFT,2		;SHIFT
		JZ	L_S01
		MOV	AX,'SL'
L_S01:
		MOV	D_S8+16,AH
		MOV	D_S8+17,AL

		MOV	DX,D_0			;˵λ
		MOV	BX,C_0			;      ɫ
		MOV	CX,A_0			;      С
		CALL	S_XSCK			;ʾմ
		MOV	SI,OFFSET D_XTPZ	;ܱ
		ADD	DX,104H
		MOV	BL,4EH
		CALL	S_XSZFC
		MOV	SI,OFFSET D_S1		;ʾ
		MOV	DX,D_0
		ADD	DX,302H 		;λ
		MOV	BX,C_0			;ɫ
		CALL	S_CKXS			;ʾ

		MOV	SI,OFFSET D_S1		;˵
		MOV	BP,OFFSET D_SBZ1	;ָ
		MOV	BH,19			;
		MOV	CH,10			;-1
		MOV	CL,D_SELE		;
		CALL	S_CDKZ			;˵
		MOV	D_SELE,AL		;ѡ
;----------------------------------------------------------------------------
		CMP	AL,0			;**ô**
		JNZ	L_S2
		MOV	SI,OFFSET C_DISP	;
		MOV	DI,OFFSET B_BUF+100H
		MOV	CX,32
L_S1A:
		LODSB
		CALL	S_SETB			;д
		LOOP	L_S1A

		MOV	BX,D_HAN		;ļ
		XOR	CX,CX
		XOR	DX,DX
		MOV	AX,4200H		;ƶдָ
		INT	21H
		MOV	DX,OFFSET B_BUF+100H	;дַ
		MOV	CX,D_CX 		;
		MOV	AH,40H			;д
		INT	21H
		MOV	AH,3EH			;ر
		INT	21H
L_S1B:
		MOV	DX,D_DX
		MOV	CX,D_SX
		MOV	AX,4301H		;ָԭ
		INT	21H

		MOV	AX,1813H
		INT	10H
		CALL	S_KGB
		XOR	AL,AL
L_END:
		MOV	AH,4CH			;˳
		INT	21H
;----------------------------------------------------------------------------
L_S2:
		CMP	AL,1			;****
		JZ	L_S1B
		CMP	AL,1BH			;<ESC>ͬAL=1
		JZ	L_S1B
;----------------------------------------------------------------------------
L_S3:
		CMP	AL,2			;**³Ǽ**
		JNZ	L_S4
		MOV	AL,'Y'
		CMP	AL,C_FCC		;?
		JNZ	L_S3A
		MOV	AL,'N'
L_S3A:
		MOV	C_FCC,AL

		CMP	AL,'N'                  ;³?
		JNZ	L_S3B
		MOV	BX,6869H		;ALT+F1~F6
		MOV	CX,6A6BH
		MOV	DX,666DH
		JMP	SHORT L_S3C
L_S3B:
		MOV	BX,0F1F2H
		MOV	CX,0F3F4H
		MOV	DX,0F5F6H
L_S3C:
		MOV	C_KEY+1,BH
		MOV	C_KEY+2,BL
		MOV	C_KEY+3,CH
		MOV	C_KEY+4,CL
		MOV	C_KEY+5,DH
		MOV	C_KEY+6,DL
		JMP	L_S00
;----------------------------------------------------------------------------
L_S4:
		CMP	AL,3			;**ƴ**
		JNZ	L_S5
		MOV	BX,OFFSET C_PY
L_S4A:
		MOV	AL,'Y'
		CMP	AL,[BX] 		;ԭ'Y'?
		JNZ	L_S4B
		MOV	AL,'N'
L_S4B:
		MOV	[BX],AL 		;д
		JMP	L_S00
;----------------------------------------------------------------------------
L_S5:
		CMP	AL,4			;**β**
		JNZ	L_S6
		MOV	BX,OFFSET C_SW
		JMP	L_S4A
;----------------------------------------------------------------------------
L_S6:
		CMP	AL,5			;**籨**
		JNZ	L_S7
		MOV	BX,OFFSET C_DB
		JMP	L_S4A
;----------------------------------------------------------------------------
L_S7:
		CMP	AL,6			;**˫ƴչ**
		JNZ	L_S8
		MOV	SI,OFFSET D_SPCZ	;'˫ƴչС:'
		CALL	S_INKEY 		;ʾ->AL
		CMP	AL,0DH
		JZ	L_S7A
		MOV	C_SPKZ,AL		;д
L_S7A:
		JMP	L_S00
;----------------------------------------------------------------------------
L_S8:
		CMP	AL,7			;**ѡϵͳܿؼ**
		JNZ	L_S9
		MOV	SI,OFFSET D_XTKG	;'ϵͳܿؼ..'
		CALL	S_INKEY 		;ʾ->AL
		CMP	AL,'1'                  ;123?
		JB	L_S8B
		CMP	AL,'3'
		JA	L_S8B
		AND	AL,0FH
		CMP	AL,3			;SCROOL LOCK?
		JNZ	L_S8A
		MOV	AL,16
L_S8A:
		MOV	C_SHIFT,AL		;
L_S8B:
		JMP	L_S00
;----------------------------------------------------------------------------
L_S9:
		CMP	AL,8			;**ùܼ**
		JNZ	L_S10
		JMP	L_JPCS
;----------------------------------------------------------------------------
L_S10:
		CMP	AL,9			;**ʾģ**
		JNZ	L_S11
		JMP	L_XSCS
;----------------------------------------------------------------------------
L_S11:
		CMP	AL,10			;**޸213L.BAT**
		JNZ	L_S11A
		JMP	L_BAT
L_S11A:
		JMP	L_S00

;==ܼ================================================================
D_PV		DB	'2.13L ܼ',0
D_PV1		DB	'         ',0
D_PV0		DB	'CTRL+F7   1-/ʾ',0
		DB	'ALT+F1    2-λ     ',0
		DB	'ALT+F2    3-β     ',0
		DB	'ALT+F3    4-ƴ     ',0
		DB	'ALT+F4    5-˫ƴ     ',0
		DB	'CTRL+F9   6-/ȡ',0
		DB	'ALT+F6    7-ASCII    ',0
		DB	'ALT+F5    8-   ',0
		DB	'ALT+F10   9-籨     ',0
		DB	'F12      10-Ԥѡ     ',0
		DB	'F11      11-       ',0
		DB	'CTRL+F5  12-ϵͳ       ',0
		DB	'ALT+F9   13-˫ƴ   ',0
		DB	'CTRL+F10 14-ôӡ   ',0,0

D_GNJTS 	DB	'54H-SHIFT+F1   5EH-CTRL+F1    68H-ALT+F1    ',0
		DB	'55H-SHIFT+F2   5FH-CTRL+F2    69H-ALT+F2    ',0
		DB	'56H-SHIFT+F3   60H-CTRL+F3    6AH-ALT+F3    ',0
		DB	'57H-SHIFT+F4   61H-CTRL+F4    6BH-ALT+F4    ',0
		DB	'58H-SHIFT+F5   62H-CTRL+F5    6CH-ALT+F5    ',0
		DB	'59H-SHIFT+F6   63H-CTRL+F6    6DH-ALT+F6    ',0
		DB	'5AH-SHIFT+F7   64H-CTRL+F7    6EH-ALT+F7    ',0
		DB	'5BH-SHIFT+F8   65H-CTRL+F8    6FH-ALT+F8    ',0
		DB	'5CH-SHIFT+F9   66H-CTRL+F9    70H-ALT+F9    ',0
		DB	'5DH-SHIFT+F10  67H-CTRL+F10   71H-ALT+F10   ',0
D_GNJTS1	DB	'85H-F11        86H-F12        87H-SHIFT+F11 ',0
		DB	'88H-SHIFT+F12  89H-CTRL+F11   8AH-CTRL+F12  ',0
		DB	'8BH-ALT+F11    8CH-ALT+F12    8DH-CTRL+   ',0
		DB	'               (չASCII-ܼ)     ',0,0

D_PVB1		DB	'лַʽķʽʾ,ʾģ黹.',0,0
D_PVB2		DB	'λλ뺺,Ҳɼٴո,λ˳ʾѡ.',0,0
D_PVB3		DB	'β뺺.',0,0
D_PVB4		DB	'ȫƴ롢ƴ(zh-VͬCCDOS)˫ƴ뺺.',0,0
D_PVB5		DB	'˫ƴ˫ƴӲ뺺,ļֱϴ.',0
		DB	'  ͨ߿ɴӿ캺ٶ.֣Ƽ뷨!',0,0
D_PVB6		DB	'ķʽ,ַõӦͼη.',0,0
D_PVB7		DB	'ȡк뷨,ָӢ.',0
		DB	'  ʾʾ,ʾ.',0,0
D_PVB8		DB	'ͷʽ뺺ֺʹ.밲װWBXģ',0,0
D_PVB9		DB	'õ籨뺺.',0,0
D_PVB10 	DB	'ԤѡһֻͼηŹѡ.ôдĸ.',0
		DB	'  ϵͳṩгþƱ÷šֵҳԤѡ.',0,0
D_PVB11 	DB	'ִ,ṩϵͳϢ.',0
		DB	'  DOSִLHELP',0,0
D_PVB12 	DB	'ʾв˵ʽϵͳп.οREADMEй˵.',0,0
D_PVB13 	DB	'ֱֳӶ˫ƴ,ʹ.',0
		DB	'  Ҫ,ӦDOSִCSP˫ƴ.',0,0
D_PVB14 	DB	'´ӡ:͡оࡢַࡢ߿աп˫ӡ.',0
		DB	'  ɹرջָӡܡرջִָӡģ.',0,0

D_PVZ1		DW	OFFSET D_PVB1
D_PVZ2		DW	OFFSET D_PVB2
D_PVZ3		DW	OFFSET D_PVB3
D_PVZ4		DW	OFFSET D_PVB4
D_PVZ5		DW	OFFSET D_PVB5
D_PVZ6		DW	OFFSET D_PVB6
D_PVZ7		DW	OFFSET D_PVB7
D_PVZ8		DW	OFFSET D_PVB8
D_PVZ9		DW	OFFSET D_PVB9
D_PVZ10 	DW	OFFSET D_PVB10
D_PVZ11 	DW	OFFSET D_PVB11
D_PVZ12 	DW	OFFSET D_PVB12
D_PVZ13 	DW	OFFSET D_PVB13
D_PVZ14 	DW	OFFSET D_PVB14

L_JPCS:
		CALL	S_CLS			;
		PUSH	CS
		POP	ES
L_S81:
		MOV	BP,OFFSET D_PV0 	;ʾ
		MOV	SI,OFFSET C_KEY 	;ַܼ
		MOV	CX,14			;
L_S811:
		LODSB				;ȡܼ
		CALL	S_SET
		ADD	BP,28
		LOOP	L_S811

		MOV	DX,D_9A
		MOV	BX,C_9A
		MOV	CX,A_9A
		CALL	S_XSCK
		MOV	SI,OFFSET D_PV1 	;'ܼ'
		ADD	DX,0EH			;λ
		MOV	BL,4EH			;ɫ
		CALL	S_XSZFC 		;ʾ
		MOV	SI,OFFSET D_GNJTS	;ܼ
		MOV	BX,C_9A 		;ɫ
		MOV	DX,D_9A
		ADD	DX,101H
		CALL	S_CKXS			;ʾ

		MOV	DX,D_9
		MOV	BX,C_9
		MOV	CX,A_9
		CALL	S_XSCK
		MOV	SI,OFFSET D_PV		;'ܼ'
		ADD	DX,7			;λ
		MOV	BL,4EH			;ɫ
		CALL	S_XSZFC 		;ʾ
L_S82:
		MOV	SI,OFFSET D_PV0 	;ǰ
		MOV	BX,C_9			;ɫ
		MOV	DX,D_9
		ADD	DX,101H 		;λ
		CALL	S_CKXS			;ʾ
		MOV	SI,OFFSET D_PV0 	;˵
		MOV	BP,OFFSET D_PVZ1	;ָ
		MOV	BH,28			;
		MOV	CH,13			;-1
		MOV	CL,D_YH 		;ĬϺ
		CALL	S_CDKZ			;˵
		CMP	AL,1BH			;<ESC>˵
		JNZ	L_S821
		JMP	L_S0
L_S821:
		CMP	BYTE PTR DS:[DI],' '    ;з³ǹܼ?
		JNZ	L_S83
		MOV	AX,0E07H
		INT	10H
		JMP	SHORT L_S82
L_S83:
		CBW
		ADD	AX,OFFSET C_KEY 	;ѡַ
		MOV	DI,AX
		MOV	AL,[DI] 		;ȡֵ
		XOR	AH,AH
		CMP	AL,85H
		JB	L_S831
		MOV	CH,10
		SUB	AL,85H
		MOV	CL,3
		DIV	CL
		ADD	CH,AL
		MOV	CL,AH
		JMP	SHORT L_S832
L_S831:
		MOV	CH,10
		SUB	AL,54H
		DIV	CH
		MOV	CX,AX
L_S832:
		MOV	D_YW,CX 		;ܼCH=,CL=
		CALL	S_CD1			;Ժװʾ
L_S84:
		XOR	AH,AH			;ѡ
		INT	16H
		OR	AL,AL			;йܼ?
		JNZ	L_S88
		CMP	AH,48H			;
		JNZ	L_S85
		OR	CH,CH
		JNZ	L_S841
		MOV	CH,15
		JMP	SHORT L_S842
L_S841:
		DEC	CH
L_S842:
		CALL	S_CD
		JMP	SHORT L_S84
L_S85:
		CMP	AH,50H			;
		JNZ	L_S86
		CMP	CH,15
		JNZ	L_S851
		XOR	CH,CH
		JMP	SHORT L_S842
L_S851:
		INC	CH
		JMP	SHORT L_S842
L_S86:
		CMP	AH,4BH			;
		JNZ	L_S87
		OR	CL,CL
		JNZ	L_S861
		OR	CH,CH
		JZ	L_S862
		DEC	CH
		MOV	CL,2
		JMP	SHORT L_S842
L_S861:
		DEC	CL
		JMP	SHORT L_S842
L_S862:
		MOV	CX,0F02H
		JMP	SHORT L_S842
L_S87:
		CMP	AH,4DH			;
		JNZ	L_S883
		CMP	CL,2
		JNZ	L_S871
		CMP	CH,15
		JZ	L_S872
		INC	CH
		XOR	CL,CL
		JMP	SHORT L_S842
L_S871:
		INC	CL
		JMP	SHORT L_S842
L_S872:
		XOR	CX,CX
		JMP	SHORT L_S842
L_S88:
		CMP	AL,0DH			;سѡ?
		JNZ	L_S89
		MOV	DX,D_YW
		MOV	BX,C_9A
		CALL	S_CD2
		CMP	CH,10
		JB	L_S881
		MOV	DL,85H
		SUB	CH,10
		MOV	AL,3
		MUL	CH
		ADD	AL,CL
		JMP	SHORT L_S882
L_S881:
		MOV	DL,54H
		MOV	AL,10
		MUL	CL
		ADD	AL,CH
L_S882:
		ADD	AL,DL
		MOV	[DI],AL 		;д
L_S883:
		JMP	L_S81
L_S89:
		CMP	AL,1BH			;<ESC>˵
		JNZ	L_S883
		JMP	L_S0
;----------------------------------------------------------------------------
D_YW		DW	0
;ӳ:ʾ˵
S_CD		PROC	NEAR
		MOV	DX,D_YW 		;ԭλ
		MOV	BX,C_9A
		CALL	S_CD2			;ָ
S_CD1:
		MOV	DX,CX			;λ
		MOV	D_YW,DX
		MOV	BL,70H			;׻
S_CD2:
		MOV	AL,3
		MUL	DH
		ADD	AL,DL			;˳
		MOV	AH,15
		MUL	AH
		ADD	AX,OFFSET D_GNJTS
		MOV	BP,AX			;ʾַ
		MOV	AL,15
		MUL	DL
		MOV	DL,AL
		ADD	DX,D_9A
		ADD	DX,101H
		PUSH	CX
		MOV	CX,15
		CALL	S_XSZFI 		;ʾ
		POP	CX
		RET
;ӳ:ʾַDS:BP,CX=,DX=λ,BL=
S_XSZFI:
		MOV	BH,DS:[BP]		;ȡַ
		INC	BP
		CALL	S_XSZF
		LOOP	S_XSZFI
		RET
S_CD		ENDP
;----------------------------------------------------------------------------
;ӳ:д빦ܼ
S_SET		PROC	NEAR
		PUSH	SI
		CMP	AL,0F0H 		;³Ǽ?
		JB	L_SET3
		MOV	AL,9			;
		JMP	SHORT L_SET4
L_SET3:
		CMP	AL,85H			;F11,F12
		JB	L_SET5
		SUB	AL,85H
L_SET4:
		MOV	SI,OFFSET D_GNJTS1
		JMP	SHORT L_SET6
L_SET5:
		SUB	AL,54H			;SHIFTF1~ALTF10
		CBW
		MOV	DL,10
		DIV	DL
		MOV	DL,AL
		MOV	AL,3
		MUL	AH
		ADD	AL,DL
		MOV	SI,OFFSET D_GNJTS
L_SET6:
		MOV	AH,15
		MUL	AH
		ADD	SI,AX
		ADD	SI,4
		MOV	DI,BP
		PUSH	CX
		MOV	CX,9
		REP	MOVSB			;д
		POP	CX
		POP	SI
		RET
S_SET		ENDP

;==ʾģ==============================================================
D_XS0		DB	'2.13L ʾģ',0
D_XS1		DB	'ʹչַ(YN) N',0
D_XS2		DB	'ֱ֧д(YN) Y',0
D_XS3		DB	'ʾʽ>5ʾ N',0
D_XS4		DB	'ʾйɫ(09) 9',0
D_XS5		DB	'ʾϵͳϢ(YN) Y',0
D_XS6		DB	'ƣߣ(YN) N',0
D_XS7		DB	'CGAɫ忪?(YN) N',0
D_XS8		DB	'ȡĻָ(YN) N',0
D_XS9		DB	'ʾʾ(YN) Y',0
D_XS10		DB	'ɱ̶(YN) Y',0
D_XS11		DB	'ʼԼĴ(YN) Y',0
D_XS12		DB	'ͼηʽB8(YN) N',0
D_XS13		DB	'ʾжϵBIOS(YN) N',0
D_XS14		DB	'ʾݣɫ  1E',0
D_XS15		DB	'ʾݣɫ  1A',0
D_XS16		DB	'ʾб⣱ɫ  4E',0
D_XS17		DB	'ʾб⣲ɫ  4A',0,0

D_GDS		DB	'ʾйɫ(0-9):',0,0
D_AL1		DB	0

D_XSB1		DB	'Yʹӵչַ(ʾַ.Ҫռڴ4K).',0
		DB	'NֱʹVGAϵַ.',0,0
D_XSB2		DB	'ֱ֧д,ַ躺ʹú.',0
		DB	'  ֧VGAEGAHGA(˫Ƶ).',0,0
D_XSB3		DB	'Y-ʾʽŴ5ʱͿʾ(Ҫں).',0
		DB	'N-ʲôʾʽͿɽʾʽ.ֱмг.',0,0
D_XSB4		DB	'TVGA֮ݵʾʹVGAģʱ,ʾ½ж.',0
		DB	'  ܿô˹ɫ,Χ0-9.Ϊ0ʱȡ.',0,0
D_XSB5		DB	'ɴ򿪻رϵͳʱʾϵͳϢ.',0,0
D_XSB6		DB	'ʹVGAģʱ,ɽʾм.',0,0
D_XSB7		DB	'ʾжINT10HAH=0BHCGAɫ崦:BIOSֱӷ.',0
		DB	'  һӦΪN.',0,0
D_XSB8		DB	'ĳЩSVGAʾĻֱдʾ,ɴ򿪴˹һ.',0,0
D_XSB9		DB	'ɱʾд״̬,ʱ˽⵱ǰ״̬.',0
		DB	'  ʾд,ʱرʾ,ͼͼʱرҪ.',0,0
D_XSB10 	DB	'ĬϹС(Y),DOSºEDITPE༭в޸״̬.',0
		DB	'  Ҳóɹ̶Ϊ2(N)',0,0
D_XSB11 	DB	'ڽINT10жʱʼԼĴ,ɱַ֤ʽʾ.',0,0
D_XSB12 	DB	'ͼʾʽ(VGAΪ12H,EGAΪ10H)B800H.',0
		DB	'  VGAEGAʹʾװ˫ƴ.',0,0
D_XSB13 	DB	'Y-ʾжʾַ͹ĻֱӵBIOS.CPASCALLISTȹ.',0
		DB	'N-ɱϵͳʾģ鴦(װĬ״̬)',0,0
D_XSB14 	DB	'ݾʾʾֻ(ֱʹʵ).',0,0
D_XSB15 	DB	'ݾʾʾֻ(ʱֵ).',0,0
D_XSB16 	DB	'ʾʾĺ뷨(ʾΪͼʱ).',0,0
D_XSB17 	DB	'ʾʾĺ뷨(ʾΪַʱ).',0,0

D_XSZ1		DW	OFFSET D_XSB1
D_XSZ2		DW	OFFSET D_XSB2
D_XSZ3		DW	OFFSET D_XSB3
D_XSZ4		DW	OFFSET D_XSB4
D_XSZ5		DW	OFFSET D_XSB5
D_XSZ6		DW	OFFSET D_XSB6
D_XSZ7		DW	OFFSET D_XSB7
D_XSZ8		DW	OFFSET D_XSB8
D_XSZ9		DW	OFFSET D_XSB9
D_XSZ10 	DW	OFFSET D_XSB10
D_XSZ11 	DW	OFFSET D_XSB11
D_XSZ12 	DW	OFFSET D_XSB12
D_XSZ13 	DW	OFFSET D_XSB13
D_XSZ14 	DW	OFFSET D_XSB14
D_XSZ15 	DW	OFFSET D_XSB15
D_XSZ16 	DW	OFFSET D_XSB16
D_XSZ17 	DW	OFFSET D_XSB17

D_16		DB	'0123456789ABCDEF'
D_INPUT 	DB	':',0,0
D_INPBUF	DB	0,0,0

L_XSCS:
		MOV	SI,OFFSET C_DISP	;ʾģ
		LODSB
		MOV	AH,'Y'
		TEST	AL,1			;=1ʹչַ
		JNZ	L_XS1
		MOV	AH,'N'
L_XS1:
		MOV	D_XS1+21,AH
		MOV	AH,'Y'
		TEST	AL,2			;=1رʾ
		JNZ	L_XS1A
		MOV	AH,'N'
L_XS1A:
		MOV	D_XS9+21,AH
		MOV	AH,'Y'
		TEST	AL,8			;=1ʾϵͳϢ
		JZ	L_XS2
		MOV	AH,'N'
L_XS2:
		MOV	D_XS5+21,AH

		LODSB
		MOV	AH,'Y'
		TEST	AL,1			;=1ֱ֧д
		JNZ	L_XS3
		MOV	AH,'N'
L_XS3:
		MOV	D_XS2+21,AH		;10.24
		MOV	AH,'Y'
		TEST	AL,2			;=1ͼηʽB8
		JNZ	L_XS3A
		MOV	AH,'N'
L_XS3A:
		MOV	D_XS12+21,AH
		MOV	AH,'Y'
		TEST	AL,4			;=1ʾжϵBIOS
		JNZ	L_XS3B
		MOV	AH,'N'
L_XS3B:
		MOV	D_XS13+21,AH
		MOV	AH,'Y'
		TEST	AL,8			;=12
		JNZ	L_XS4
		MOV	AH,'N'
L_XS4:
		MOV	D_XS6+21,AH

		LODSB
		MOV	AH,'Y'
		TEST	AL,1			;=1ʾʽ>5
		JZ	L_XS5
		MOV	AH,'N'
L_XS5:
		MOV	D_XS3+21,AH
		MOV	AH,'Y'
		TEST	AL,2			;=1ɱ
		JZ	L_XS5A
		MOV	AH,'N'
L_XS5A:
		MOV	D_XS10+21,AH
		MOV	AH,'Y'
		TEST	AL,4			;=1ʼԼĴ
		JNZ	L_XS5B
		MOV	AH,'N'
L_XS5B:
		MOV	D_XS11+21,AH
		MOV	AH,'Y'
		TEST	AL,8			;=1CGAɫBIOS
		JNZ	L_XS6
		MOV	AH,'N'
L_XS6:
		MOV	D_XS7+21,AH

		LODSB
		CMP	AL,'0'
		JB	L_XS7
		CMP	AL,'9'                  ;ʾйɫ
		JA	L_XS7
		MOV	D_XS4+21,AL
		JMP	SHORT L_XS8
L_XS7:
		MOV	D_XS4+21,' '
L_XS8:
		MOV	AH,'Y'
		CMP	AL,'9'                  ;ȡĻָ
		JA	L_XS9
		MOV	AH,'N'
L_XS9:
		MOV	D_XS8+21,AH

		MOV	SI,OFFSET C_TUXN1	;ʾɫ
		MOV	DI,OFFSET D_XS14+20	;дλ
		MOV	CX,4
L_XS9A:
		LODSB
		CALL	S_16
		MOV	WORD PTR DS:[DI],AX	;д
		ADD	DI,23
		LOOP	L_XS9A

		MOV	DX,D_14 		;
		MOV	BX,C_14
		MOV	CX,A_14
		CALL	S_XSCK
		MOV	SI,OFFSET D_XS0 	;ʾ
		ADD	DX,102H 		;λ
		MOV	BL,4EH			;ɫ
		CALL	S_XSZFC 		;ʾ˵
		MOV	SI,OFFSET D_XS1 	;ʾ˵
		MOV	DX,D_14
		ADD	DX,302H 		;λ
		MOV	BX,C_14 		;ɫ
		CALL	S_CKXS			;ʾ˵

		MOV	SI,OFFSET D_XS1 	;˵
		MOV	BP,OFFSET D_XSZ1	;ָ
		MOV	BH,23			;
		MOV	CH,16			;-1
		MOV	CL,D_AL1		;ʼ
		CALL	S_CDKZ			;˵
		CMP	AL,1BH			;<ESC>˵
		JNZ	L_XS10
		MOV	DX,D_14 		;
		MOV	BX,11H
		MOV	CX,A_14
		CALL	S_XSCK
		JMP	L_S00
L_XS10:
		MOV	D_AL1,AL		;ѡ

		CMP	AL,0			;<ʹչַ>
		JNZ	L_XS20
		XOR	C_DISP,1
		JMP	L_XSCS
L_XS20:
		CMP	AL,1			;<ֱ֧д>
		JNZ	L_XS30
		XOR	C_DISP2,1
		JMP	L_XSCS
L_XS30:
		CMP	AL,2			;<ʾʽ>5>
		JNZ	L_XS40
		XOR	C_DISP3,1
		MOV	AL,14
		TEST	C_DISP3,1
		JZ	L_XS33
		MOV	AL,15
L_XS33:
		MOV	AH,18H			;ִ
		INT	10H
		JMP	L_XSCS
L_XS40:
		CMP	AL,3			;<ʾйɫ>
		JNZ	L_XS50
		MOV	SI,OFFSET D_GDS 	;'ʾйɫ(0-9):'
		CALL	S_INKEY 		;ʾַ
		CMP	AL,'0'
		JB	L_XS41
		CMP	AL,'9'
		JA	L_XS41
		MOV	C_DISP4,AL		;д
		MOV	BL,AL
		MOV	AX,1405H		;ִ
		INT	10H
L_XS41:
		JMP	L_XSCS
L_XS50:
		CMP	AL,4			;<ʾϵͳϢ>
		JNZ	L_XS60
		XOR	C_DISP,8
		JMP	L_XSCS
L_XS60:
		CMP	AL,5			;<2>
		JNZ	L_XS70
		XOR	C_DISP2,8
		JMP	L_XSCS
L_XS70:
		CMP	AL,6			;<CGAɫ>
		JNZ	L_XS80
		XOR	C_DISP3,8
		JMP	L_XSCS
L_XS80:
		CMP	AL,7			;<ȡĻָ>
		JNZ	L_XS90
		MOV	AL,C_DISP4
		CMP	AL,'9'
		JA	L_XS82
		MOV	AL,'A'
		JMP	SHORT L_XS84
L_XS82:
		MOV	AL,' '
L_XS84:
		MOV	C_DISP4,AL
		JMP	L_XSCS
L_XS90:
		CMP	AL,8			;<رʾ>
		JNZ	L_XS95
		XOR	C_DISP,2
		JMP	L_XSCS
L_XS95:
		CMP	AL,9			;<ɱ̶>
		JNZ	L_XS100
		XOR	C_DISP3,2
		MOV	BH,1
		TEST	C_DISP3,2
		JZ	L_XS96
		MOV	BX,2
L_XS96:
		MOV	AX,180DH		;ִ
		INT	10H
		JMP	L_XSCS
L_XS100:
		CMP	AL,10			;<INT10ʼԼĴ>
		JNZ	L_XS110
		XOR	C_DISP3,4
		JMP	L_XSCS
L_XS110:
		CMP	AL,11			;<ͼηʽB8>
		JNZ	L_XS120
		XOR	C_DISP2,2
		JMP	L_XSCS
L_XS120:
		CMP	AL,12			;<ʾжϵBIOS>
		JNZ	L_XS130
		XOR	C_DISP2,4
L_XS130:
		CMP	AL,13			;<ʾ1ɫ>
		JNZ	L_XS140
		CALL	S_INCOLOR		;ʮɫֵ
		JB	L_XS133
		MOV	C_TUXN1,AL
L_XS133:
		JMP	L_XSCS
L_XS140:
		CMP	AL,14			;<ʾ2ɫ>
		JNZ	L_XS150
		CALL	S_INCOLOR		;ʮɫֵ
		JB	L_XS144
		MOV	C_TUXN2,AL
L_XS144:
		JMP	L_XSCS
L_XS150:
		CMP	AL,15			;<ʾб1ɫ>
		JNZ	L_XS160
		CALL	S_INCOLOR		;ʮɫֵ
		JB	L_XS155
		MOV	C_TUXB1,AL
L_XS155:
		JMP	L_XSCS
L_XS160:
		CMP	AL,16			;<ʾб2ɫ>
		JNZ	L_XS170
		CALL	S_INCOLOR		;ʮɫֵ
		JB	L_XS166
		MOV	C_TUXB2,AL
L_XS166:
		JMP	L_XSCS
L_XS170:
		JMP	L_XSCS

;==޸213L.BAT==============================================================
D_XGBAT 	DB	'޸213L.BAT',0
D_XG1		DB	'ѡģ(K,V,0):  ',0
D_XG2		DB	'ѡӡģ  (N,H):  ',0
D_XG3		DB	'ѡHPֵ֧Ĵӡ  ',0
D_XG4		DB	'ѡNTֵ֧Ĵӡ  ',0
D_XG5		DB	'ӡֿⷽʽ(n,W):  ',0
D_XG6		DB	':ļ 213L.BAT  ',0,0

D_XGB1		DB	'ѡK(INT10K)V(INT10V).ѡ0פģ.',0,0
D_XGB2		DB	'سѡӡ:N-PRNT,H-PRTH.',0
		DB	'    ѡҪѡӡ.',0,0
D_XGB3		DB	'Ѿѡּ֧īӡPRTHٴѡӡ.',0,0
D_XGB4		DB	'Ѿѡ֧24ӡPRNTٴѡӡ.',0,0
D_XGB5		DB	'n-ֿģREAD24,READ32,READ40READSLʹINT13жֱӶֿ.',0
		DB	'W-ģļʽֿ(ѹ̡̻)',0,0
D_XGB6		DB	'޸ĵĽ浽ļ C:\213L.BAT.',0,0

D_XGZ1		DW	OFFSET D_XGB1
D_XGZ2		DW	OFFSET D_XGB2
D_XGZ3		DW	OFFSET D_XGB3
D_XGZ4		DW	OFFSET D_XGB4
D_XGZ5		DW	OFFSET D_XGB5
D_XGZ6		DW	OFFSET D_XGB6

D_PRTH		DB	'PRTH ӡѡ',0
D_PRTHB 	DB	'10 : HP-2            ',0
		DB	'11 : HP-3            ',0
		DB	'13 : PECAN 300DPI    ',0
		DB	'14 : PECAN 400DPI    ',0
		DB	'16 : HP JET 500      ',0
		DB	'19 :  LBP-8II    ',0
		DB	'20 : ѷHP400DPI',0
		DB	'21 : XP-11-B4 400Dpi ',0
		DB	'22 : XP-11-A4 400DPI ',0
		DB	'23 :  BJ-10ex    ',0,0

D_PRTHB1	DB	'ùѡӡ,سѡ',0,0

D_PRTHZ1	DW	OFFSET D_PRTHB1
D_PRTHZ2	DW	OFFSET D_PRTHB1
D_PRTHZ3	DW	OFFSET D_PRTHB1
D_PRTHZ4	DW	OFFSET D_PRTHB1
D_PRTHZ5	DW	OFFSET D_PRTHB1
D_PRTHZ6	DW	OFFSET D_PRTHB1
D_PRTHZ7	DW	OFFSET D_PRTHB1
D_PRTHZ8	DW	OFFSET D_PRTHB1
D_PRTHZ9	DW	OFFSET D_PRTHB1
D_PRTHZ10	DW	OFFSET D_PRTHB1

D_PRNT1 	DB	'PRNT ӡѡ',0
D_PRNTB 	DB	'0 - AR3240       ',0
		DB	'1 - P1351        ',0
		DB	'2 - M2024(M1724) ',0
		DB	'3 - TH3070(3080) ',0
		DB	'4 - AR2463       ',0
		DB	'5 - LQ1500(NECP7)',0
		DB	'6 - OKI8320,8330 ',0
		DB	'7 - M1570        ',0
		DB	'8 - NEC3824      ',0
		DB	'9 - NM9400       ',0,0

D_PRNTB1	DB	'AR3240: CR32403200ӡ.',0,0
D_PRNTB2	DB	'P1351: P1351P350ɫӡ.',0,0
D_PRNTB3	DB	'M2024: M1724M1924ӡ.',0,0
D_PRNTB4	DB	'TH3070: KC3070Ͻ30703080ϵдӡ.',0,0
D_PRNTB5	DB	'AR2463',0,0
D_PRNTB6	DB	'LQ1500: LQϵСNEC P7VP8624ԼEPSONݵĴӡ.',0,0
D_PRNTB7	DB	'OKI8320: OKIϵ24ӡ.',0,0
D_PRNTB8	DB	'M1570',0,0
D_PRNTB9	DB	'NEC3824: NEC P5ӡ.',0,0
D_PRNTB10	DB	'NM9400',0,0

D_PRNTZ1	DW	OFFSET D_PRNTB1
D_PRNTZ2	DW	OFFSET D_PRNTB2
D_PRNTZ3	DW	OFFSET D_PRNTB3
D_PRNTZ4	DW	OFFSET D_PRNTB4
D_PRNTZ5	DW	OFFSET D_PRNTB5
D_PRNTZ6	DW	OFFSET D_PRNTB6
D_PRNTZ7	DW	OFFSET D_PRNTB7
D_PRNTZ8	DW	OFFSET D_PRNTB8
D_PRNTZ9	DW	OFFSET D_PRNTB9
D_PRNTZ10	DW	OFFSET D_PRNTB10

D_BAT		DB	'C:\213L.BAT',0
H_BAT		DW	0			;HANDLE
D_END		DW	0			;ļβַ
NO213L		DB	'δҵļC:\213L.BAT!',0
NOCKB		DB	'ļC:\213L.BAT޼ģ!',0
NOCCDISP	DB	'ļC:\213L.BATCCDISP',0
NOPRTH		DB	'ļC:\213L.BATPRTH',0
D_SELE15	DB	0
D_SELEPR	DB	0
F_R16		DB	3,'R16'
F_CKB		DB	3,'CKB'
F_CCDISP	DB	6,'CCDISP'
F_INT10 	DB	5,'INT10?',13,10
F_READ16	DB	6,'READ16'
F_READ24	DB	6,'READ24'
F_READ32	DB	6,'READ32'
F_READ40	DB	6,'READ40'
F_READSL	DB	6,'READSL'
F_PR		DB	3,'PR 00',13,10
F_PRNT		DB	4,'PRNT',13,10
F_PRTH		DB	4,'PRTH',13,10
K_INT10 	DB	'ѡ(K,V,0):',0
K_READ24	DB	'ѡ(1-9,W):',0
;----------------------------------------------------------------------------
L_BAT:
		MOV	DX,OFFSET D_BAT 	;'C:\213L.BAT'
		MOV	AX,3D02H		;ļ
		INT	21H
		JNB	L_BAT1
		MOV	SI,OFFSET NO213L
L_BAT2B:
		MOV	DX,D_15
		ADD	DX,102H
		MOV	BL,4EH
		CALL	S_XSZFC 		;ʾַ
		MOV	AX,0E07H		;
		INT	10H
		XOR	AH,AH			;
		INT	16H
		JMP	L_S0
L_BAT1:
		MOV	BX,AX
		MOV	H_BAT,AX
		MOV	DX,OFFSET B_BUF
		MOV	SI,DX
		MOV	CX,-1
		MOV	AH,3FH			;ļ
		INT	21H
		ADD	SI,AX
		CMP	BYTE PTR [SI-1],1AH	;ıļ־
		JZ	L_BAT2
		MOV	BYTE PTR [SI],1AH	;ñ־
		INC	SI
L_BAT2:
		MOV	D_END,SI		;ļβ
L_BAT2A:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_INT10	;'INT10'
		CALL	S_SCAN			;
		MOV	AL,' '
		JB	L_BAT4
		MOV	AL,[BX+5]		;'INT10'ַ
L_BAT4:
		MOV	D_XG1+21,AL

		MOV	D_XG2+21,' '
		MOV	WORD PTR D_XG3+20,'  '
		MOV	D_XG4+21,' '
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PR		;'PR '
		CALL	S_SCAN			;
		JB	L_BAT7
		MOV	D_XG2+21,'H'
		MOV	AX,[BX+3]		;ӡ
		CMP	AH,0DH
		JNZ	L_BAT6
		MOV	AH,' '
L_BAT6:
		MOV	WORD PTR D_XG3+20,AX
		JMP	SHORT L_BAT8
L_BAT7:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PRNT	;'PRNT'
		CALL	S_SCAN			;
		MOV	AL,' '
		JB	L_BAT8
		MOV	D_XG2+21,'N'
		MOV	AL,[BX+5]		;ӡ
		MOV	D_XG4+21,AL
L_BAT8:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_READ24	;'READ24'
		CALL	S_SCAN			;
		JB	L_BAT9
		MOV	AL,[BX+7]		;READ24ַ
		MOV	D_XG5+21,AL
L_BAT9:
		MOV	DX,D_15
		MOV	BX,C_15
		MOV	CX,A_15
		CALL	S_XSCK			;ʾմ
		MOV	SI,OFFSET D_XGBAT
		ADD	DX,107H
		MOV	BL,4EH
		CALL	S_XSZFC 		;ʾ
L_BAT10:
		MOV	SI,OFFSET D_XG1
		MOV	DX,D_15
		ADD	DX,302H
		MOV	BX,C_15
		CALL	S_CKXS			;ʾ

		MOV	SI,OFFSET D_XG1 	;˵
		MOV	BP,OFFSET D_XGZ1	;ָ
		MOV	BH,23			;
		MOV	CH,5			;-1
		MOV	CL,D_SELE15		;
		CALL	S_CDKZ			;˵

		CMP	AL,1BH			;<ESC>?
		JNZ	L_BAT12
		MOV	BX,H_BAT
		MOV	AH,3EH
		INT	21H
L_BAT11:
		MOV	DX,D_15
		MOV	BX,11H
		MOV	CX,A_15
		CALL	S_XSCK			;崰
		JMP	L_S00
L_BAT12:
		MOV	D_SELE15,AL		;ѡ

		CMP	AL,0			;<INT10?>
		JNZ	L_BAT30
		MOV	SI,OFFSET K_INT10
		CALL	S_INKEY 		;ַ
		CMP	AL,'0'
		JB	L_BAT22
		JZ	L_BAT21
		AND	AL,5FH
L_BAT21:
		MOV	DL,AL

		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_INT10	;'INT10'
		CALL	S_SCAN			;
		JB	L_BAT24
		CMP	DL,'0'                  ;?
		JZ	L_BAT23
		CMP	DL,[BX+5]		;?
		JZ	L_BAT22
		MOV	[BX+5],DL		;д
L_BAT22:
		JMP	L_BAT2A
L_BAT23:
		MOV	DI,BX
		MOV	CX,8
		CMP	BYTE PTR [DI-1],' '     ;ǰпո(LH)
		JNZ	L_BAT23A
		SUB	DI,3
		ADD	CX,3
L_BAT23A:
		CALL	S_DELBAT		;
		JMP	L_BAT2A
L_BAT24:
		CMP	DL,'0'                  ;?
		JZ	L_BAT22
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_CCDISP	;'CCDISP'
		CALL	S_SCAN			;
		JNB	L_BAT24A
		MOV	SI,OFFSET NOCCDISP
		JMP	L_BAT2B
L_BAT24A:
		MOV	SI,BX
L_BAT25:
		LODSB
		CMP	AL,0DH			;β?
		JZ	L_BAT26
		CMP	AL,0AH
		JNZ	L_BAT25
L_BAT26:
		LODSB				;

		MOV	DI,OFFSET F_INT10+1
		MOV	[DI+5],DL
		MOV	CX,8
		CALL	S_INBUF 		;дһ
		JMP	L_BAT2A
L_BAT30:
		CMP	AL,1			;<PRT>
		JZ	L_BAT31
		JMP	L_BAT60
L_BAT31:
		MOV	AL,'N'
		CMP	D_XG3+21,AL
		JNZ	L_BAT32
		MOV	AL,'H'
L_BAT32:
		MOV	D_XG3+21,AL
		MOV	DL,AL

		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PRTH	;'PRTH'---------------------
		CALL	S_SCAN			;
		JB	L_BAT50
		CMP	DL,'N'                  ;PRNT?
		JNZ	L_BAT49
		MOV	WORD PTR [BX+2],'TN'    ;'NT'
		MOV	SI,BX
		ADD	SI,4
		MOV	DI,OFFSET D_PRNTB+14
		MOV	CX,2
		CALL	S_INBUF 		;д'  '
		CALL	S_PRNT			;PRNTѡӡ
L_BAT47:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PR		;3,'PR '
		CALL	S_SCAN			;
		JB	L_BAT49
		MOV	CX,7
		CMP	BYTE PTR [BX+4],0DH
		JNZ	L_BAT48
		MOV	CL,6
L_BAT48:
		MOV	DI,BX
		CALL	S_DELBAT		;ɾPR
L_BAT49:
		JMP	L_BAT2A
L_BAT50:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PRNT	;'PRNT'----------------------
		CALL	S_SCAN			;
		JB	L_BAT64
		CMP	DL,'H'                  ;PRTH?
		JNZ	L_BAT54
		MOV	DI,BX
		ADD	DI,4
		MOV	CX,2
		CALL	S_DELBAT		;ɾӡ
		MOV	WORD PTR [BX+2],'HT'    ;'TH'
		CALL	S_INPR			;PR
L_BAT54:
		JMP	L_BAT2A
L_BAT60:
		CMP	AL,2			;<PRѡӡ>
		JNZ	L_BAT66
		CMP	D_XG3+21,'H'
		JNZ	L_BAT64
		CALL	S_PR
		JMP	L_BAT2A
L_BAT64:
		MOV	AX,0E07H
		INT	10H
		JMP	L_BAT2A
L_BAT66:
		CMP	AL,3			;<PRNTѡӡ>
		JNZ	L_BAT80
		CMP	D_XG3+21,'N'
		JNZ	L_BAT64
		CALL	S_PRNT
L_BAT69:
		JMP	L_BAT2A
L_BAT70:
		CMP	AL,5			;<>
		JNZ	L_BAT69
		MOV	BX,H_BAT		;ļ
		XOR	CX,CX
		XOR	DX,DX
		MOV	AX,4200H		;ļͷ
		INT	21H
		MOV	DX,OFFSET B_BUF
		MOV	CX,D_END
		SUB	CX,DX
		MOV	AH,40H			;д
		INT	21H
		MOV	AH,3EH			;ر
		INT	21H
		JMP	L_BAT11 		;شڷ˵
L_BAT80:
		CMP	AL,4			;<READ24ѡW>
		JNZ	L_BAT70
		MOV	SI,OFFSET K_READ24
		CALL	S_INKEY 		;ַ
		CMP	AL,'w'
		JNZ	L_BAT81
		AND	AL,5FH
L_BAT81:
		CMP	AL,'W'
		JZ	L_BAT82
		CMP	AL,'1'
		JB	L_BAT86
		CMP	AL,'9'
		JA	L_BAT86
L_BAT82:
		MOV	DL,AL

		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_READ24	;'READ24'
		CALL	S_SCAN			;
		JB	L_BAT83
		CALL	S_24W
L_BAT83:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_READ32	;'READ32'
		CALL	S_SCAN			;
		JB	L_BAT84
		CALL	S_24W
L_BAT84:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_READ40	;'READ40'
		CALL	S_SCAN			;
		JB	L_BAT85
		CALL	S_24W
L_BAT85:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_READSL	;'READSL'
		CALL	S_SCAN			;
		JB	L_BAT86
		CALL	S_24W
L_BAT86:
		JMP	L_BAT2A

;ӳ:READ24W
S_24W		PROC	NEAR
		CMP	BYTE PTR [BX+6],0DH	;޲?
		JZ	L_24W2
		CMP	DL,[BX+7]
		JZ	L_24W1
		MOV	[BX+7],DL
L_24W1:
		RET
L_24W2:
		LEA	SI,[BX+6]
		MOV	DI,OFFSET D_XG5+20
		MOV	[DI+1],DL
		MOV	CX,2
		JMP	S_INBUF
S_24W		ENDP

;ӳ:ѡPR
S_PR		PROC	NEAR
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PR		;'PR '
		CALL	S_SCAN			;
		JNB	L_PR1
		RET
L_PR1:
		MOV	AX,[BX+3]		;ӡ
		MOV	SI,OFFSET D_PRTHB	;	
		XOR	CX,CX
L_PR2:
		CMP	AH,0DH
		JZ	L_PR2A
		CMP	AX,[SI]
		JZ	L_PR3
		JMP	SHORT L_PR2B
L_PR2A:
		CMP	AL,[SI] 		;?
		JZ	L_PR3
L_PR2B:
		ADD	SI,22			;һ
		INC	CX
		JMP	SHORT L_PR2
L_PR3:
		MOV	D_SELEPR,CL		;ԭ
		JMP	SHORT L_INPR1

;ӳ:PR
S_INPR:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PRTH	;'PRTH'
		CALL	S_SCAN			;
		JNB	L_INPR0
		MOV	SI,OFFSET NOPRTH
		JMP	L_BAT2B
L_INPR0:
		MOV	SI,BX
		MOV	DI,OFFSET F_PR+1
		MOV	CX,7
		CALL	S_INBUF 		;һ:PR 00
L_INPR1:
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PR		;3,'PR '
		CALL	S_SCAN			;
		CMP	BYTE PTR [BX+4],0DH	;PRһλ?
		JNZ	L_INPR2
		MOV	DI,OFFSET D_PRTHB+2	;ո
		MOV	CX,1
		LEA	SI,[BX+3]
		CALL	S_INBUF 		;дַ
L_INPR2:
		PUSH	BX
		CALL	S_SELEPR		;ѡӡAL
		POP	BX
		JB	L_INPR3
		MOV	AX,WORD PTR D_PRTHB[SI]
		MOV	[BX+3],AX
L_INPR3:
		MOV	DX,D_PR
		MOV	BX,0FF11H
		MOV	CX,A_PR
		CALL	S_XSCK			;PR
		RET
S_SELEPR:
		MOV	DX,D_PR
		MOV	BX,C_PR
		MOV	CX,A_PR
		CALL	S_XSCK			;ʾPR
		MOV	SI,OFFSET D_PRTH
		ADD	DX,3
		MOV	BH,4EH
		CALL	S_XSZFC 		;ʾ
		MOV	SI,OFFSET D_PRTHB
		MOV	DX,D_PR
		ADD	DX,101H
		MOV	BX,C_PR
		CALL	S_CKXS			;ʾ

		MOV	SI,OFFSET D_PRTHB
		MOV	BP,OFFSET D_PRTHZ1	;ָ
		MOV	BH,22			;
		MOV	CH,9			;-1
		MOV	CL,D_SELEPR		;
		CALL	S_CDKZ			;˵
		CMP	AL,1BH			;ESC
		JZ	L_SELEPR1
		MUL	BH
		MOV	SI,AX
		CLC
		RET
L_SELEPR1:
		STC
		RET
S_PR		ENDP

;ӳ:PRNTѡӡ
S_PRNT		PROC	NEAR
		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PRNT	;'PRNT '
		CALL	S_SCAN			;
		JNB	L_PRNT1
		RET
L_PRNT1:
		XOR	CX,CX
		MOV	AL,[BX+5]		;ӡ
		CMP	AL,' '
		JZ	L_PRNT4
		MOV	SI,OFFSET D_PRNTB	;	
L_PRNT2:
		CMP	AL,[SI]
		JZ	L_PRNT5
		ADD	SI,18			;һ
		INC	CX
		JMP	SHORT L_PRNT2
L_PRNT4:
		MOV	CL,5
L_PRNT5:
		MOV	D_SELEPR,CL		;ԭ

		MOV	SI,OFFSET B_BUF
		MOV	DI,OFFSET F_PRNT	;5,'PRNT '
		CALL	S_SCAN			;
		CMP	BYTE PTR [BX+6],0DH	;PRNTһλ?
		JZ	L_PRNT6
		MOV	DI,BX
		ADD	DI,6
		MOV	CX,1
		CALL	S_DELBAT		;
L_PRNT6:
		PUSH	BX
		CALL	S_SELEPRNT		;ѡӡAL
		POP	BX
		JB	L_PRNT7
		MOV	AL,D_PRNTB[SI]
		MOV	[BX+5],AL
L_PRNT7:
		MOV	DX,D_PRNT
		MOV	BX,0FF11H
		MOV	CX,A_PRNT
		CALL	S_XSCK			;PR
		RET
S_SELEPRNT:
		MOV	DX,D_PRNT
		MOV	BX,C_PRNT
		MOV	CX,A_PRNT
		CALL	S_XSCK			;ʾPR
		MOV	SI,OFFSET D_PRNT1
		ADD	DX,2
		MOV	BH,4EH
		CALL	S_XSZFC 		;ʾ
		MOV	SI,OFFSET D_PRNTB
		MOV	DX,D_PRNT
		ADD	DX,101H
		MOV	BX,C_PRNT
		CALL	S_CKXS			;ʾ

		MOV	SI,OFFSET D_PRNTB
		MOV	BP,OFFSET D_PRNTZ1	;ָ
		MOV	BH,18			;
		MOV	CH,9			;-1
		MOV	CL,D_SELEPR		;
		CALL	S_CDKZ			;˵
		CMP	AL,1BH			;ESC
		JZ	L_SELEPRNT1
		MUL	BH
		MOV	SI,AX
		CLC
		RET
L_SELEPRNT1:
		STC
		RET
S_PRNT		ENDP

;ӳ:ַ DS:SI-ʼַ,ES:DI-ַ,CX-
S_SCAN		PROC	NEAR
		PUSH	SI
		MOV	CL,ES:[DI]
		XOR	CH,CH
		INC	DI
L_SC1:
		PUSH	SI
		PUSH	DI
		PUSH	CX
		REP	CMPSB			;
		POP	CX
		POP	DI
		POP	SI
		JZ	L_SC2
		INC	SI
		CMP	BYTE PTR [SI],1AH	;ļβ
		JNZ	L_SC1
		POP	SI
		STC
		RET
L_SC2:
		MOV	BX,SI
		POP	SI
		CLC
		RET
S_SCAN		ENDP

;ӳ:дַDI,CX-,SI-д
S_INBUF 	PROC	NEAR
		PUSH	BX
		PUSH	DI
		MOV	BX,CX
		MOV	DI,D_END
L_IB1:
		DEC	DI
		MOV	AL,[DI]
		MOV	[BX+DI],AL
		CMP	SI,DI
		JNZ	L_IB1
		POP	SI
		REP	MOVSB
		ADD	D_END,BX
		POP	BX
		RET
S_INBUF 	ENDP

;ӳ:ɾַDI,CX-
S_DELBAT	PROC	NEAR
		PUSH	BX
		PUSH	DI
		MOV	BX,CX
L_DB1:
		MOV	AL,[BX+DI]
		MOV	[DI],AL
		INC	DI
		CMP	AL,1AH
		JNZ	L_DB1
		SUB	D_END,BX
		POP	DI
		POP	BX
		RET
S_DELBAT	ENDP

;ͨӳ******************************************************************
D_YH		DB	0			;ĬϺ
D_YS		DB	0			;ԭ˵ɫ
D_CD		DW	0			;˵Ͻλ
;ӳ:˵ SI=˵,BH=,BL=˵ɫ,CH=-1,CL=ĬϺ,BP=˵ָ
;		 :AL=ѡк(=1BH:˳)
S_CDKZ		PROC	NEAR
		MOV	D_YH,CL
		MOV	D_YS,BL
		MOV	D_CD,DX
		CALL	S_XSCD1 		;ʾ
L_CDKZ1:
		XOR	AH,AH			;ѡ
		INT	16H
		CMP	AL,1BH			;<ESC>
		JZ	L_CDKZ2
		CMP	AL,0DH			;سѡ?
		JNZ	L_CDKZ3
		MOV	AL,CL
L_CDKZ2:
		RET
L_CDKZ3:
		CMP	AH,48H			;
		JNZ	L_CDKZ6
		CMP	CL,0
		JNZ	L_CDKZ4
		MOV	CL,CH
		JMP	SHORT L_CDKZ5
L_CDKZ4:
		DEC	CL
L_CDKZ5:
		CALL	S_XSCD
		JMP	SHORT L_CDKZ1
L_CDKZ6:
		CMP	AH,50H			;
		JNZ	L_CDKZ1
		CMP	CL,CH
		JNZ	L_CDKZ7
		XOR	CL,CL
		JMP	SHORT L_CDKZ5
L_CDKZ7:
		INC	CL
		JMP	SHORT L_CDKZ5
S_CDKZ		ENDP

S_XSCD		PROC	NEAR
		MOV	DH,D_YH 		;ԭ
		MOV	BL,D_YS 		;˵ɫ
		CALL	S_XSCD2 		;ָ
S_XSCD1:
		PUSH	SI
		PUSH	BX
		PUSH	CX
		MOV	DX,D_HELP
		MOV	BX,C_HELP
		MOV	CX,A_HELP
		CALL	S_XSCK			;ʾ
		POP	CX
		PUSH	CX
		XOR	CH,CH
		SHL	CX,1			;*2
		MOV	SI,BP
		ADD	SI,CX			;ָ
		INC	CX
		MOV	SI,DS:[SI]		;
		ADD	DX,102H 		;ʾλ
		CALL	S_CKXS			;ʾ
		POP	CX
		POP	BX
		POP	SI

		MOV	DH,CL
		MOV	BL,70H
S_XSCD2:
		PUSH	BP
		PUSH	CX
		MOV	AL,BH			;
		MUL	DH			;*
		ADD	AX,SI			;+
		MOV	BP,AX			;ʾ
		MOV	DI,AX
		XOR	DL,DL			;
		ADD	DX,D_CD
		MOV	CL,BH			;
		XOR	CH,CH
		DEC	CX			;-1(ȥ0)
		PUSH	BX
		CALL	S_XSZFI 		;ʾ
		POP	BX
		POP	CX
		POP	BP
		MOV	D_YH,CL 		;ǰ
		RET
S_XSCD		ENDP
;----------------------------------------------------------------------------
;ӳ:
S_CLS		PROC	NEAR
		MOV	AL,D_MODE		;ʾʽ
		CMP	D_ZJXP,1		;ֱд
		JNZ	L_CLS0
		MOV	AL,3
L_CLS0:
		CBW
		INT	10H			;ʾʽ

		CALL	S_GGB			;ع

		MOV	BX,0FF11H		;BH=-1:Ӱ,BL=11H	2.19
		MOV	CX,1950H		;CH=25,CL=80
		XOR	DX,DX			;ĻϽ
		CALL	S_XSCK			;ʾ
		RET
S_CLS		ENDP
;----------------------------------------------------------------------------
D_K		DW	0			;
D_G		DW	0			;
D_YY		DB	0
;ӳ:ʾմ DX=Ͻ,CH=,CL=,BL=ɫ,BH=-1Ӱ
S_XSCK		PROC	NEAR
		MOV	D_YY,BH
		PUSH	DX
		PUSH	CX
		PUSH	SI
		PUSH	BP
		SUB	CX,202H
		MOV	AL,CH
		CBW
		MOV	D_G,AX			;ڸ
		MOV	AL,CL
		MOV	D_K,AX			;      

		XOR	CX,CX
		MOV	SI,OFFSET D_B1		;Ϻ
		CALL	S_XSYH

		MOV	SI,OFFSET D_B2		;м
		MOV	DI,D_G
L_CK1:
		INC	DH
		CALL	S_XSYH
		DEC	DI
		JNZ	L_CK1
		INC	DH
		CMP	DH,18H
		JA	L_CK3
		MOV	SI,OFFSET D_B3		;º
		CALL	S_XSYH

		CMP	D_YY,-1
		JZ	L_CK3
		ADD	DX,101H
		CMP	D_MODE,9		;е?
		JBE	L_CK3
		CMP	DH,18H			;?
		JA	L_CK3
		PUSH	BX
		MOV	BH,' '                  ;Ӱ
		CMP	BL,11H
		JZ	L_CK1A
		XOR	BL,BL
L_CK1A:
		MOV	DI,D_K
		ADD	DI,2
L_CK2:
		CALL	S_XSZF
		DEC	DI
		JNZ	L_CK2
		POP	BX
L_CK3:
		POP	BP
		POP	SI
		POP	CX
		POP	DX
		RET
;ӳ:ʾһ:
S_XSYH:
		PUSH	DX
		MOV	BH,[SI] 		;
		CALL	S_XSZF
		MOV	BH,[SI+1]		;м
		MOV	BP,D_K
L_YH1:
		CALL	S_XSZF
		DEC	BP
		JNZ	L_YH1
		MOV	BH,[SI+2]		;ұ
		CALL	S_XSZF

		CMP	D_YY,-1
		JZ	L_YH2
		CMP	D_MODE,9		;е?
		JBE	L_YH2
		CMP	SI,OFFSET D_B1		;Ϻ?
		JZ	L_YH2
		CMP	DL,80			;еұ?
		JZ	L_YH2
		PUSH	BX
		MOV	BH,' '                  ;ұӰ
		CMP	BL,11H
		JZ	L_YH1A
		XOR	BL,BL
L_YH1A:
		CALL	S_XSZF
		POP	BX
L_YH2:
		POP	DX
		RET
S_XSCK		ENDP
;----------------------------------------------------------------------------
;ӳ:ʾSI(ÿβ0,ټ0),DX=λ,BL=
S_CKXS		PROC	NEAR
		PUSH	DX
L_CKXS1:
		CMP	BYTE PTR [SI],0 	;?
		JZ	L_CKXS2
		PUSH	DX
		CALL	S_XSZFC 		;ʾһ
		POP	DX
		INC	DH
		JMP	SHORT L_CKXS1
L_CKXS2:
		POP	DX
		RET
S_CKXS		ENDP
;----------------------------------------------------------------------------
;ӳ:ʾַBH,λDX(ʾ+1) CX=0ַʾ,>0ʾ
S_XSZF		PROC	NEAR
		PUSH	BX
		CMP	D_MODE,9		;е?
		JA	L_XF1
		CMP	BL,70H			;з?
		JZ	L_XF1
		MOV	BL,7
L_XF1:
		MOV	AX,1409H		;ʾ
		INT	10H
		INC	DX			;+1
		POP	BX
		RET
S_XSZF		ENDP
;----------------------------------------------------------------------------
;ӳ:ʾַSI,β0,BL=
S_XSZFC 	PROC	NEAR
		LODSB
		OR	AL,AL			;н?
		JZ	L_X1
		MOV	BH,AL
		CALL	S_XSZF			;ʾַ
		JMP	SHORT S_XSZFC
L_X1:
		RET
S_XSZFC 	ENDP
;----------------------------------------------------------------------------
;ӳ:رչ
S_GGB		PROC	NEAR
		PUSH	AX
		MOV	CX,2000H
		MOV	AH,1
		INT	10H
		POP	AX
		RET
S_GGB		ENDP
;----------------------------------------------------------------------------
;ӳ:
S_KGB		PROC	NEAR
		MOV	CX,0E0FH
		MOV	AH,1			;
		INT	10H
		RET
S_KGB		ENDP
;----------------------------------------------------------------------------
;ӳ:ʾ봰 DS:SI-ʾϢ
S_XSIN		PROC	NEAR
		MOV	DX,D_IN
		MOV	BX,C_IN
		MOV	CX,A_IN
		CALL	S_XSCK			;ʾմ
		ADD	DX,102H
		RET
S_XSIN		ENDP
;----------------------------------------------------------------------------
;ӳ:ַ DS:SI-ʾϢ
S_INKEY 	PROC	NEAR
		CALL	S_XSIN			;ʾ봰
		CALL	S_XSZFC 		;ʾʾϢ
		XOR	AH,AH			;
		INT	16H
		PUSH	AX
		MOV	DX,D_IN
		MOV	BX,0FF11H
		MOV	CX,A_IN
		CALL	S_XSCK			;崰
		POP	AX
		RET
S_INKEY 	ENDP
;----------------------------------------------------------------------------
D_NUM		DW	0
;ӳ:16 CX:ֽ,D_NUM
S_IN16		PROC	NEAR
		MOV	BP,16
		JMP	SHORT L_IN0
;ӳ:10
S_IN10:
		MOV	BP,10
L_IN0:
		PUSH	CX
		CALL	S_XSIN
		CALL	S_XSZFC
		POP	CX
		MOV	SI,OFFSET D_INPBUF	;뻺
		MOV	DI,SI
		ADD	DI,CX
		MOV	D_NUM,0
L_IN1:
		XOR	BH,BH
		MOV	AH,2
		INT	10H
		XOR	AH,AH			;
		INT	16H
		CMP	AL,80H
		JA	L_IN1
		CMP	AL,0DH			;س?
		JB	L_IN1
		JZ	L_IN6
		CMP	AL,1BH			;<ESC>
		JZ	L_IN9A
		CMP	AL,8			;˸?
		JNZ	L_IN5
		CMP	SI,OFFSET D_INPBUF	;ָ?
		JA	L_IN3
L_IN2:
		MOV	AX,0E07H
		INT	10H
		JMP	SHORT L_IN1
L_IN3:
		DEC	SI			;λ-1
L_IN4:
		CALL	S_GGB
		DEC	DX
		MOV	BH,' '
		CALL	S_XSZF			;ʾո
		DEC	DX
		CALL	S_KGB
		JMP	SHORT L_IN1
L_IN9A:
		CALL	L_IN9
		STC
		RET
L_IN5:
		CMP	AL,'0'                  ;?
		JB	L_IN1
		CMP	AL,'9'
		JBE	L_IN5A
		CMP	BP,10
		JZ	L_IN1
		AND	AL,5FH
		CMP	AL,'A'
		JB	L_IN1
		CMP	AL,'F'
		JA	L_IN1
L_IN5A:
		CMP	SI,DI			;?
		JZ	L_IN2
		MOV	[SI],AL 		;д
		INC	SI
		MOV	BH,AL
		CALL	S_GGB
		CALL	S_XSZF
		CALL	S_KGB
		JMP	SHORT L_IN1
L_IN6:
		CMP	SI,OFFSET D_INPBUF
		JZ	L_IN9A
		MOV	BYTE PTR [SI],0
		MOV	SI,OFFSET D_INPBUF	;
L_IN7:
		LODSB				;ȡ
		OR	AL,AL
		JZ	L_IN9
		SUB	AL,'0'
		CMP	AL,9
		JBE	L_IN8
		SUB	AL,7
L_IN8:
		CBW
		PUSH	AX
		MOV	AX,BP
		MUL	D_NUM
		MOV	D_NUM,AX
		POP	AX
		ADD	D_NUM,AX
		JMP	SHORT L_IN7
L_IN9:
		PUSH	AX
		CALL	S_GGB
		MOV	DX,D_IN
		MOV	BX,0FF11H
		MOV	CX,A_IN
		CALL	S_XSCK
		POP	AX
		CLC
		RET
S_INCOLOR:	;ʮɫֵ
		MOV	SI,OFFSET D_INPUT
		MOV	CX,2			;2λ
		CALL	S_IN16			;ʮ
		JB	L_INCO
		MOV	AX,D_NUM
		CLC
L_INCO:
		RET
S_IN16		ENDP

;ӳ:ȡINIһ->AL
S_GETB		PROC	NEAR
		PUSH	CX
		LODSB				;ȡһֽ
		CALL	S_TO10			;תʮ
		CMP	BYTE PTR [SI],' '       ;һֽΪո?
		JZ	L_GETB1
		MOV	CL,4
		SHL	AL,CL			;*16
		MOV	CL,AL
		LODSB				;ȡһֽ
		CALL	S_TO10			;תʮ
		ADD	AL,CL			;+
L_GETB1:
		PUSH	AX
L_GETB2:
		LODSB
		CMP	AL,0AH
		JNZ	L_GETB2
		POP	AX
		POP	CX
		RET
S_TO10: ;תʮ
		CMP	AL,'9'                  ;?
		JBE	L_T1
		AND	AL,5FH			;Сдд
L_T1:
		SUB	AL,'0'
		CMP	AL,9
		JBE	L_T2
		SUB	AL,7
L_T2:
		RET
S_GETB		ENDP

;ӳ:д AL
S_SETB		PROC	NEAR
		PUSH	CX
		CALL	S_TO16
		MOV	[DI],AH
		MOV	[DI+1],AL
L_SETB1:
		INC	DI
		CMP	BYTE PTR [DI],0AH
		JNZ	L_SETB1
		INC	DI
		POP	CX
		RET
S_TO16:
		MOV	CH,AL
		MOV	CL,4
		SHR	AL,CL
		CALL	S_GET16
		MOV	AH,AL
		MOV	AL,CH
		AND	AL,0FH
S_GET16:
		MOV	BX,OFFSET D_16
		XLAT
		RET
S_SETB		ENDP

;ӳ:AL->16AX---------------------------------------------------------
S_16		PROC	NEAR
		MOV	BX,OFFSET D_16
		PUSH	AX
		AND	AL,0FH
		XLAT
		MOV	DL,AL
		POP	AX
		SHR	AL,1
		SHR	AL,1
		SHR	AL,1
		SHR	AL,1
		XLAT
		MOV	AH,DL
		RET
S_16		ENDP

;ӳ:
S_MOVE		PROC	NEAR
		LODSB
		STOSB
		OR	AL,AL
		JNZ	S_MOVE
		RET
S_MOVE		ENDP

D_FILE		EQU	$
B_BUF		EQU	$+40H

SEG_A		ENDS
		END    START
